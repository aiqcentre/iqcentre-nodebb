(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[46862,16028,16922,28306],{46862:(A,k,h)=>{"use strict";var m,c;m=[h(7237),h(85233),h(63281),h(7927),h(44882),h(74344),h(47720),h(77564)],c=function(a,i,r,g,u,I,L,E){const o={};o.sendMessage=async function(e,t){let d=t.val();if(!d.trim().length)return;const p=t.parents(`[component="chat/messages"][data-roomid="${e}"]`);t.val("").trigger("input"),o.updateRemainingLength(t.parent()),o.updateTextAreaHeight(p);const f={roomId:e,message:d};({roomId:e,message:d}=await i.fire("filter:chat.send",f));const v=t.parents('[component="chat/composer"]').find('[component="chat/composer/replying-to"]'),C=v.attr("data-tomid");I.post(`/chats/${e}`,{message:d,toMid:C}).then(()=>{i.fire("action:chat.sent",{roomId:e,message:d}),v.addClass("hidden"),v.attr("data-tomid","")}).catch(w=>{if(t.val(d).trigger("input"),o.updateRemainingLength(t.parent()),o.updateTextAreaHeight(p),w.message==="[[error:email-not-confirmed-chat]]")return u.showEmailConfirmWarning(w.message);g.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:w.message,type:"danger",timeout:1e4})})},o.updateRemainingLength=function(e){const t=e.find('[component="chat/input"]');e.find('[component="chat/message/length"]').text(t.val().length),e.find('[component="chat/message/remaining"]').text(config.maximumChatMessageLength-t.val().length),i.fire("action:chat.updateRemainingLength",{parent:e})},o.updateTextAreaHeight=function(e){const t=e.find('[component="chat/input"]');t.css({height:o.calcAutoTextAreaHeight(t)+"px"})},o.calcAutoTextAreaHeight=function(e){const t=e.prop("scrollHeight"),d=parseFloat(e.css("border-top-width"),10)||0,p=parseFloat(e.css("border-bottom-width"),10)||0;return t+d+p};function s(e){e.css({height:o.calcAutoTextAreaHeight(e)+"px"}),e.on("input",function(){e.css({height:0}),e.css({height:o.calcAutoTextAreaHeight(e)+"px"})})}o.appendChatMessage=function(e,t){const d=e.find(".chat-message").last(),p=parseInt(d.attr("data-uid"),10),f=parseInt(d.attr("data-timestamp"),10);Array.isArray(t)||(t.newSet=t.toMid||p!==parseInt(t.fromuid,10)||parseInt(t.timestamp,10)>parseInt(f,10)+1e3*60*3),o.parseMessage(t,function(v){n(e,v,t)})};function n(e,t,d){const p=$(t),f=o.isAtBottom(e);if(p.appendTo(e),o.onMessagesAddedToDom(p),f||d.self){o.scrollToBottomAfterImageLoad(e);const v=e.find("[data-mid]");if(v.length>150){const C=v.length-150;v.slice(0,C).remove()}}i.fire("action:chat.received",{messageEl:p})}o.onMessagesAddedToDom=function(e){e.find(".timeago").timeago(),e.find("img:not(.not-responsive)").addClass("img-fluid"),e.find("img:not(.emoji)").each(function(){L.wrapImageInLink($(this))})},o.parseMessage=function(e,t){const d={messages:e,isAdminOrGlobalMod:app.user.isAdmin||app.user.isGlobalMod};Array.isArray(e)?app.parseAndTranslate("partials/chats/messages",d).then(t):app.parseAndTranslate("partials/chats/"+(e.system?"system-message":"message"),d).then(t)},o.isAtBottom=function(e,t){if(e.length)return e[0].scrollHeight-(e.outerHeight()+e.scrollTop())<(t||100)},o.scrollToBottomAfterImageLoad=function(e){if(e&&e.length){const t=e[0].querySelectorAll('[component="chat/message/body"]');E(t,()=>{o.scrollToBottom(e)})}},o.scrollToBottom=function(e){e&&e.length&&(e.scrollTop(e[0].scrollHeight-e.height()),e.parent().find('[component="chat/messages/scroll-up-alert"]').addClass("hidden"))},o.wrapImagesInLinks=function(e){e.find('[component="chat/message/body"] img:not(.emoji)').each(function(){L.wrapImageInLink($(this))})},o.toggleScrollUpAlert=function(e){const t=o.isAtBottom(e,300);e.parent().find('[component="chat/messages/scroll-up-alert"]').toggleClass("hidden",t)},o.prepReplyTo=async function(e,t){const d=e.parents(`[component="chat/messages"][data-roomid="${t}"]`),p=d.find('[component="chat/message/content"]'),f=d.find('[component="chat/composer"]'),v=e.attr("data-mid"),C=f.find('[component="chat/composer/replying-to"]');C.attr("data-tomid",v).find('[component="chat/composer/replying-to-text"]').translateText(`[[modules:chat.replying-to, ${e.attr("data-username")}]]`),C.removeClass("hidden"),C.find('[component="chat/composer/replying-to-cancel"]').off("click").on("click",()=>{C.attr("data-tomid",""),C.addClass("hidden")}),p.length&&o.isAtBottom(p)&&o.scrollToBottom(p),f.find('[component="chat/input"]').trigger("focus")},o.prepEdit=async function(e,t,d){const p=await socket.emit("modules.chats.getRaw",{mid:t,roomId:d}),f=await app.parseAndTranslate("partials/chats/edit-message",{rawContent:p}),v=e.find('[component="chat/message/body"]'),C=e.find('[component="chat/message/controls"]'),w=v.parents('[component="chat/message/content"]');v.addClass("hidden"),C.addClass("hidden"),f.insertAfter(v);const T=f.find("textarea");T.focus().putCursorAtEnd(),s(T),w.length&&o.isAtBottom(w)&&o.scrollToBottom(w);const _=(await app.require("forum/chats")).createAutoComplete(0,T,{placement:"bottom"});function M(){v.removeClass("hidden"),C.removeClass("hidden"),f.remove(),_&&_.destroy()}T.on("keyup",x=>{x.key==="Escape"&&M()}),f.find('[data-action="cancel"]').on("click",M),f.find('[data-action="save"]').on("click",function(){const x=T.val();x.trim().length&&I.put(`/chats/${d}/messages/${t}`,{message:x}).then(()=>{M(),i.fire("action:chat.edited",{roomId:d,message:x,mid:t})}).catch(B=>{T.val(x).trigger("input"),g.error(B)})}),i.fire("action:chat.prepEdit",{msgEl:e,messageId:t,roomId:d,editEl:f,messageBody:v})},o.addSocketListeners=function(){socket.removeListener("event:chats.edit",l),socket.on("event:chats.edit",l),socket.removeListener("event:chats.delete",y),socket.on("event:chats.delete",y),socket.removeListener("event:chats.restore",b),socket.on("event:chats.restore",b)};function l(e){e.messages.forEach(function(t){const d=parseInt(t.fromuid,10)===parseInt(app.user.uid,10);t.self=d?1:0,o.parseMessage(t,function(p){const f=a.get("chat/message",t.mid);f.length&&(f.replaceWith(p),o.onMessagesAddedToDom(a.get("chat/message",t.mid)));const v=$(`[component="chat/message/parent"][data-parent-mid="${t.mid}"]`);v.length&&(v.find('[component="chat/message/parent/content"]').html(p.find('[component="chat/message/body"]').html()),o.onMessagesAddedToDom($(`[component="chat/message/parent"][data-parent-mid="${t.mid}"]`)))})})}function y(e){const t=a.get("chat/message",e),d=$(`[component="chat/message/parent"][data-parent-mid="${e}"]`),p=parseInt(t.attr("data-uid"),10)===app.user.uid,f=parseInt(d.attr("data-uid"),10)===app.user.uid;t.toggleClass("deleted",!0),d.toggleClass("deleted",!0),p||t.find('[component="chat/message/body"]').translateHtml("<p>[[modules:chat.message-deleted]]</p>"),f||d.find('[component="chat/message/parent/content"]').translateHtml("<p>[[modules:chat.message-deleted]]</p>")}function b(e){const t=a.get("chat/message",e.messageId),d=$(`[component="chat/message/parent"][data-parent-mid="${e.messageId}"]`),p=parseInt(t.attr("data-uid"),10)===app.user.uid,f=parseInt(d.attr("data-uid"),10)===app.user.uid;t.toggleClass("deleted",!1),d.toggleClass("deleted",!1),p||(t.find('[component="chat/message/body"]').translateHtml(e.content),o.onMessagesAddedToDom(a.get("chat/message",e.messageId))),!f&&d.length&&(d.find('[component="chat/message/parent/content"]').translateHtml(e.content),o.onMessagesAddedToDom($(`[component="chat/message/parent"][data-parent-mid="${e.messageId}"]`)))}return o.delete=function(e,t){r.confirm("[[modules:chat.delete_message_confirm]]",function(d){d&&I.del(`/chats/${t}/messages/${e}`,{}).then(()=>{a.get("chat/message",e).toggleClass("deleted",!0)}).catch(g.error)})},o.restore=function(e,t){I.post(`/chats/${t}/messages/${e}`,{}).then(()=>{a.get("chat/message",e).toggleClass("deleted",!1)}).catch(g.error)},o}.apply(k,m),c!==void 0&&(A.exports=c)},47720:(A,k)=>{"use strict";var h,m;h=[],m=function(){const c={},a=/-resized(\.[\w]+)?$/;return c.wrapImagesInLinks=function(i){i.find('[component="post/content"] img:not(.emoji)').each(function(){c.wrapImageInLink($(this))})},c.wrapImageInLink=function(i){let r=i.attr("src")||"";if(r!=="about:blank"&&!i.parent().is("a")){utils.isRelativeUrl(r)&&a.test(r)&&(r=r.replace(a,"$1"));const g=i.attr("alt")||"",u=r.split(".").slice(1).pop(),I=g.split("/").pop(),L=I.split(".").slice(1).pop();i.wrap('<a href="'+r+'" '+(!u&&L?' download="'+utils.escapeHTML(I)+'" ':"")+' target="_blank" rel="noopener">')}},c}.apply(k,h),m!==void 0&&(A.exports=m)},44882:(A,k,h)=>{"use strict";var m,c;m=[h(63281),h(32230),h(66603),h(7927),h(85233)],c=function(a,i,r,g,u){const I={};let L,E;I.show=function(){u.one("action:ajaxify.end",()=>{s(),o(),I.showEmailConfirmWarning()})},I.showEmailConfirmWarning=function(n){if(!config.emailPrompt||!app.user.uid||parseInt(r.getItem("email-confirm-dismiss"),10)===1)return;const l={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{r.setItem("email-confirm-dismiss",1)}};!app.user.email&&!app.user.isEmailConfirmSent?(l.message="[[error:no-email-to-confirm]]",l.clickfn=function(){g.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},g.alert(l)):!app.user["email:confirmed"]&&!app.user.isEmailConfirmSent?(l.message=n||"[[error:email-not-confirmed]]",l.clickfn=function(){g.remove("email_confirm"),ajaxify.go("/me/edit/email")},g.alert(l)):!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(l.message="[[error:email-not-confirmed-email-sent]]",g.alert(l))};function o(){!config.cookies.enabled||!navigator.cookieEnabled||app.inAdmin||r.getItem("cookieconsent")==="1"||(config.cookies.message=i.unescape(config.cookies.message),config.cookies.dismiss=i.unescape(config.cookies.dismiss),config.cookies.link=i.unescape(config.cookies.link),config.cookies.link_url=i.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,function(n){$(document.body).append(n),$(document.body).addClass("cookie-consent-open");const l=$(".cookie-consent");l.find("button").on("click",function(){r.setItem("cookieconsent","1"),l.remove(),$(document.body).removeClass("cookie-consent-open")})}))}function s(){const n=utils.params({full:!0});L=n.has("loggedin"),E=n.get("register"),L&&(g.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),n.delete("loggedin")),E&&(a.alert({message:utils.escapeHTML(decodeURIComponent(E))}),n.delete("register")),n.has("lang")&&n.get("lang")===config.defaultLang&&(console.info(`The "lang" parameter was passed in to set the language to "${n.get("lang")}", but that is already the forum default language.`),n.delete("lang"));const l=n.toString();ajaxify.updateHistory(ajaxify.currentPage+(l?`?${l}`:"")+document.location.hash,!0)}return I.showInvalidSession=function(){a.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},I.showSessionMismatch=function(){a.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},I}.apply(k,m),c!==void 0&&(A.exports=c)},66603:(A,k,h)=>{"use strict";var m;m=function(){function c(){this._store={},this._keys=[]}c.prototype.isMock=!0,c.prototype.setItem=function(r,g){r=String(r),this._keys.indexOf(r)===-1&&this._keys.push(r),this._store[r]=g},c.prototype.getItem=function(r){return r=String(r),this._keys.indexOf(r)===-1?null:this._store[r]},c.prototype.removeItem=function(r){r=String(r),this._keys=this._keys.filter(function(g){return g!==r}),this._store[r]=null},c.prototype.clear=function(){this._keys=[],this._store={}},c.prototype.key=function(r){return r=parseInt(r,10)||0,this._keys[r]},Object.defineProperty&&Object.defineProperty(c.prototype,"length",{get:function(){return this._keys.length}});let a;const i=Date.now().toString();try{if(a=window.localStorage,a.setItem(i,i),a.getItem(i)!==i)throw Error("localStorage behaved unexpectedly");return a.removeItem(i),a}catch(r){console.warn(r),console.warn("localStorage failed, falling back on sessionStorage");try{if(a=window.sessionStorage,a.setItem(i,i),a.getItem(i)!==i)throw Error("sessionStorage behaved unexpectedly");return a.removeItem(i),a}catch(g){return console.warn(g),console.warn("sessionStorage failed, falling back on memory storage"),new c}}}.call(k,h,k,A),m!==void 0&&(A.exports=m)},7158:function(A){(function(k,h){A.exports?A.exports=h():k.EvEmitter=h()})(typeof window<"u"?window:this,function(){function k(){}let h=k.prototype;return h.on=function(m,c){if(!m||!c)return this;let a=this._events=this._events||{},i=a[m]=a[m]||[];return i.includes(c)||i.push(c),this},h.once=function(m,c){if(!m||!c)return this;this.on(m,c);let a=this._onceEvents=this._onceEvents||{},i=a[m]=a[m]||{};return i[c]=!0,this},h.off=function(m,c){let a=this._events&&this._events[m];if(!a||!a.length)return this;let i=a.indexOf(c);return i!=-1&&a.splice(i,1),this},h.emitEvent=function(m,c){let a=this._events&&this._events[m];if(!a||!a.length)return this;a=a.slice(0),c=c||[];let i=this._onceEvents&&this._onceEvents[m];for(let r of a)i&&i[r]&&(this.off(m,r),delete i[r]),r.apply(this,c);return this},h.allOff=function(){return delete this._events,delete this._onceEvents,this},k})},77564:function(A,k,h){/*!
 * imagesLoaded v5.0.0
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */(function(m,c){A.exports?A.exports=c(m,h(7158)):m.imagesLoaded=c(m,m.EvEmitter)})(typeof window<"u"?window:this,function(c,a){let i=c.jQuery,r=c.console;function g(s){return Array.isArray(s)?s:typeof s=="object"&&typeof s.length=="number"?[...s]:[s]}function u(s,n,l){if(!(this instanceof u))return new u(s,n,l);let y=s;if(typeof s=="string"&&(y=document.querySelectorAll(s)),!y){r.error(`Bad element for imagesLoaded ${y||s}`);return}this.elements=g(y),this.options={},typeof n=="function"?l=n:Object.assign(this.options,n),l&&this.on("always",l),this.getImages(),i&&(this.jqDeferred=new i.Deferred),setTimeout(this.check.bind(this))}u.prototype=Object.create(a.prototype),u.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)};const I=[1,9,11];u.prototype.addElementImages=function(s){s.nodeName==="IMG"&&this.addImage(s),this.options.background===!0&&this.addElementBackgroundImages(s);let{nodeType:n}=s;if(!n||!I.includes(n))return;let l=s.querySelectorAll("img");for(let y of l)this.addImage(y);if(typeof this.options.background=="string"){let y=s.querySelectorAll(this.options.background);for(let b of y)this.addElementBackgroundImages(b)}};const L=/url\((['"])?(.*?)\1\)/gi;u.prototype.addElementBackgroundImages=function(s){let n=getComputedStyle(s);if(!n)return;let l=L.exec(n.backgroundImage);for(;l!==null;){let y=l&&l[2];y&&this.addBackground(y,s),l=L.exec(n.backgroundImage)}},u.prototype.addImage=function(s){let n=new E(s);this.images.push(n)},u.prototype.addBackground=function(s,n){let l=new o(s,n);this.images.push(l)},u.prototype.check=function(){if(this.progressedCount=0,this.hasAnyBroken=!1,!this.images.length){this.complete();return}let s=(n,l,y)=>{setTimeout(()=>{this.progress(n,l,y)})};this.images.forEach(function(n){n.once("progress",s),n.check()})},u.prototype.progress=function(s,n,l){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!s.isLoaded,this.emitEvent("progress",[this,s,n]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,s),this.progressedCount===this.images.length&&this.complete(),this.options.debug&&r&&r.log(`progress: ${l}`,s,n)},u.prototype.complete=function(){let s=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(s,[this]),this.emitEvent("always",[this]),this.jqDeferred){let n=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[n](this)}};function E(s){this.img=s}E.prototype=Object.create(a.prototype),E.prototype.check=function(){if(this.getIsImageComplete()){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}this.proxyImage=new Image,this.img.crossOrigin&&(this.proxyImage.crossOrigin=this.img.crossOrigin),this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.currentSrc||this.img.src},E.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},E.prototype.confirm=function(s,n){this.isLoaded=s;let{parentNode:l}=this.img,y=l.nodeName==="PICTURE"?l:this.img;this.emitEvent("progress",[this,y,n])},E.prototype.handleEvent=function(s){let n="on"+s.type;this[n]&&this[n](s)},E.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},E.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},E.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)};function o(s,n){this.url=s,this.element=n,this.img=new Image}return o.prototype=Object.create(E.prototype),o.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(this.img.naturalWidth!==0,"naturalWidth"),this.unbindEvents())},o.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},o.prototype.confirm=function(s,n){this.isLoaded=s,this.emitEvent("progress",[this,this.element,n])},u.makeJQueryPlugin=function(s){s=s||c.jQuery,s&&(i=s,i.fn.imagesLoaded=function(n,l){return new u(this,n,l).jqDeferred.promise(i(this))})},u.makeJQueryPlugin(),u})}}]);
