"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[82586,53375,16922],{25142:(b,D,p)=>{var I,m;I=[p(85233),p(7927)],m=function(_,h){const l={};let A,w=0,s=!1,E,j=0;l.init=function(i,y){const c=$("body");typeof i=="function"?(A=i,E=c):(A=y,E=i||c),w=$(window).scrollTop(),$(window).off("scroll",F).on("scroll",F),c.height()<=$(window).height()&&A(1)};function F(){j&&clearTimeout(j),j=setTimeout(function(){j=0,r()},60)}function r(){const i=utils.findBootstrapEnvironment(),y=(i==="xs"||i==="sm")&&$("html").hasClass("composing");if(s||y||app.flags._glance)return;const c=$(window).scrollTop(),g=$(window).height(),u=E.height()-g,N=E.offset()?E.offset().top:0,M=100*(c-N)/(u<=0?g:u),R=15,B=85,C=c>w?1:-1;(M<R&&c<w||M>B&&c>w||M<0&&C>0&&u<0)&&A(C),w=c}return l.loadMore=function(i,y,c){if(s)return;s=!0;const g={method:i,data:y};_.fire("action:infinitescroll.loadmore",g),socket.emit(g.method,g.data,function(u,N){if(u)return s=!1,h.error(u);c(N,function(){s=!1})})},l.loadMoreXhr=function(i,y){if(s)return;s=!0;const c=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),g={url:c,data:i};_.fire("action:infinitescroll.loadmore.xhr",g),$.get(c,i,function(u){y(u,function(){s=!1})}).fail(function(u){s=!1,h.error(String(u.responseJSON||"[[error:no-connection]]"))})},l.removeExtra=function(i,y,c){let g=$();if(i.length<=c)return g;const u=i.length-c;if(y>0){const N=$(document).height(),M=$(window).scrollTop();g=i.slice(0,u).remove(),$(window).scrollTop(M+($(document).height()-N))}else g=i.slice(i.length-u).remove();return g},l}.apply(D,I),m!==void 0&&(b.exports=m)},47720:(b,D)=>{var p,I;p=[],I=function(){const m={},_=/-resized(\.[\w]+)?$/;return m.wrapImagesInLinks=function(h){h.find('[component="post/content"] img:not(.emoji)').each(function(){m.wrapImageInLink($(this))})},m.wrapImageInLink=function(h){let l=h.attr("src")||"";if(l!=="about:blank"&&!h.parent().is("a")){utils.isRelativeUrl(l)&&_.test(l)&&(l=l.replace(_,"$1"));const A=h.attr("alt")||"",w=l.split(".").slice(1).pop(),s=A.split("/").pop(),E=s.split(".").slice(1).pop();h.wrap('<a href="'+l+'" '+(!w&&E?' download="'+utils.escapeHTML(s)+'" ':"")+' target="_blank" rel="noopener">')}},m}.apply(D,p),I!==void 0&&(b.exports=I)},60447:(b,D,p)=>{var I,m;I=[p(78989),p(25142),p(54939),p(47720),p(42840),p(7237),p(32230),p(85233),p(59265)],m=function(_,h,l,A,w,s,E,j,F){const r={};r.signaturesShown={};const i=$(window);r.onNewPost=function(t){!t||!t.posts||!t.posts.length||parseInt(t.posts[0].tid,10)!==parseInt(ajaxify.data.tid,10)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),r.modifyPostsByPrivileges(t.posts),c(t.posts),y(t.posts[0]),g(t.posts),ajaxify.data.postcount+=1,l.updatePostCount(ajaxify.data.postcount),config.usePagination?u(t):M(t),p.e(21352).then(function(){var o=[p(21352)];(function(e){e.onNewPost(t)}).apply(null,o)}).catch(p.oe))};function y(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}r.modifyPostsByPrivileges=function(t){t.forEach(function(o){o.selfPost=!!app.user.uid&&parseInt(o.uid,10)===parseInt(app.user.uid,10),o.topicOwnerPost=parseInt(o.uid,10)===parseInt(ajaxify.data.uid,10),o.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_moderator_tools=o.display_edit_tools||o.display_delete_tools,o.display_move_tools=ajaxify.data.privileges.isAdminOrMod,o.display_post_menu=ajaxify.data.privileges.isAdminOrMod||o.selfPost&&!ajaxify.data.locked&&!o.deleted||o.selfPost&&o.deleted&&parseInt(o.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!o.deleted})};function c(t){for(let o=0;o<t.length;o+=1){const e=s.get("user/postcount",t[o].uid);e.html(F.formattedNumber(parseInt(e.attr("data-postcount"),10)+1))}}function g(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,s.get("post").not("[data-index=0]").each(function(){const o=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",o)}))}function u(t){function o(){R(t.posts[0])}const e=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(e[0].topic.postcount/config.postsPerPage));const n=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&n===1||ajaxify.data.pagination.currentPage===1&&n===-1){const x=$('[component="post"]:not([data-index=0]), [component="topic/event"]');B(t,x,n,!1,o)}else ajaxify.data.scrollToMyPost&&parseInt(e[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){_.loadPage(ajaxify.data.pagination.pageCount,o)},250):N()}function N(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(o){$('[component="pagination"]').after(o).remove()})})}function M(t){const o=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,e=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!e&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!e&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const n=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');B(t,n,o,!1,function(a){a&&a.addClass("new"),R(t.posts[0])})}function R(t){t.selfPost&&ajaxify.data.scrollToMyPost&&w.scrollBottom(t.index)}function B(t,o,e,n,a){if(a=a||function(){},!t||t.posts&&!t.posts.length)return a();function x(){const d=$('[component="post"].new');if(d.length===t.posts.length){let v=!0;if(d.each(function(P,T){parseInt($(T).attr("data-pid"),10)!==parseInt(t.posts[P].pid,10)&&(v=!1)}),v){d.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}d.length&&t.posts.length>1&&t.posts.forEach(function(v){const P=s.get("post","pid",v.pid);P.hasClass("new")&&P.remove()}),t.posts=t.posts.filter(function(v){return v.index===-1||$('[component="post"][data-pid="'+v.pid+'"]').length===0})}if(x(),!t.posts.length)return a();let f,S;e>0&&o.length?f=o.last():e<0&&o.length&&(S=o.first()),j.fire("action:posts.loading",{posts:t.posts,after:f,before:S}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(d){d=d.filter(function(){const P=$(this),T=P.attr("data-pid"),K=parseInt(P.attr("data-index"),10);return!P.is('[component="post"]')||K===-1||T&&$('[component="post"][data-pid="'+T+'"]').length===0});const v=h.removeExtra($('[component="post"]'),e,Math.max(20,config.postsPerPage*2));if(f)d.insertAfter(f);else if(S){const P=$(document).height(),T=i.scrollTop();d.insertBefore(S),(n||T>0)&&i.scrollTop(T+($(document).height()-P))}else s.get("topic").append(d);await r.onNewPostsAddedToDom(d),L(v),j.fire("action:posts.loaded",{posts:t.posts}),a(d)})}r.loadMorePosts=function(t){if(!s.get("topic").length||w.scrollActive)return;const o=s.get("topic").find(s.get("post").not("[data-index=0]").not(".new")),e=t>0?o.last():o.first(),n=parseInt(e.attr("data-index"),10)||0,a=ajaxify.data.tid;if(!utils.isNumber(a)||!utils.isNumber(n)||t<0&&s.get("post","index",0).length)return;const x=$(".loading-indicator");x.is(":animated")||x.fadeIn(),h.loadMore("topics.loadMore",{tid:a,after:n+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(f,S){if(x.fadeOut(),f&&f.posts&&f.posts.length){const d=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');B(f,d,t,!0,S)}else w.update(),S()})},r.onTopicPageLoad=async function(t){W(t),A.wrapImagesInLinks(t),O(t),r.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),r.addBlockquoteEllipses(t),U(t),await C()},r.addTopicEvents=function(t){if(config.topicPostSort==="most_votes")return;const o=t[0];app.parseAndTranslate("partials/topic/event",o).then(function(e){if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(e);else if(config.topicPostSort==="newest_to_oldest"){const n=$('[component="topic"] [component="post"][data-index="0"]');n.length?$(e).insertAfter(n):$('[component="topic"]').prepend(e)}$('[component="topic/event"] .timeago').timeago()})};async function C(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const o=i.scrollTop(),e=$('[component="post"]').toArray();await Promise.all(e.map(async function(n){n=$(n);const a=n.prev('[component="post"]');if(n.is(":has(.necro-post)")||!a.length||config.topicPostSort==="newest_to_oldest"&&parseInt(a.attr("data-index"),10)===0)return;const x=n.attr("data-timestamp")-a.attr("data-timestamp");if(Math.abs(x)>=t){const f=$.timeago.settings.strings.suffixAgo,S=$.timeago.settings.strings.prefixAgo,d=$.timeago.settings.strings.suffixFromNow,v=$.timeago.settings.strings.prefixFromNow;$.timeago.settings.strings.suffixAgo="",$.timeago.settings.strings.prefixAgo="",$.timeago.settings.strings.suffixFromNow="",$.timeago.settings.strings.prefixFromNow="";const P=(x>0?"[[topic:timeago_later,":"[[topic:timeago_earlier,")+$.timeago.inWords(x)+"]]";$.timeago.settings.strings.suffixAgo=f,$.timeago.settings.strings.prefixAgo=S,$.timeago.settings.strings.suffixFromNow=d,$.timeago.settings.strings.prefixFromNow=v;const T=await app.parseAndTranslate("partials/topic/necro-post",{text:P});T.attr("data-necro-post-index",a.attr("data-index")),T.insertBefore(n)}})),o>0&&i.scrollTop()<o&&i.scrollTop(o)}function O(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((o,e)=>{const n=$(e).find('[component="post/signature"]'),a=n.attr("data-uid");r.signaturesShown[a]?n.addClass("hidden"):r.signaturesShown[a]=!0})}function L(t){t.each((o,e)=>{$(`[data-necro-post-index="${$(e).attr("data-index")}"]`).remove()})}function W(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const o=document.createElement("a");o.className="login-required",o.href=config.relative_path+"/login",E.translate("[[topic:login-to-view]]",function(e){o.appendChild(document.createTextNode(e)),t.each(function(n,a){$(a).find('[component="post/content"] img').each(function(x,f){f=$(f),f.attr("src").startsWith(config.relative_path+config.upload_url)&&f.replaceWith(o.cloneNode(!0))})})})}r.onNewPostsAddedToDom=async function(t){await r.onTopicPageLoad(t),t.find(".timeago").timeago()},r.showBottomPostBar=function(){const t=s.get("post","index",0),o=$(".post-bar-placeholder"),e=$('[component="post"]');t.length&&e.length>1&&$(".post-bar").length<2&&o.length?($(".post-bar").clone().insertAfter(o),o.remove()):t.length&&e.length<2&&t.find(".post-bar").remove()};function U(t){t.each(function(){$(this).hasClass("deleted")&&l.toggle($(this).attr("data-pid"),!0)})}return r.addBlockquoteEllipses=function(t){t.find('[component="post/content"] > blockquote > blockquote').each(function(){const e=$(this);e.find(":hidden:not(br)").length&&!e.find(".toggle").length&&e.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},r}.apply(D,I),m!==void 0&&(b.exports=m)}}]);
