"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[56753,70565,21710,1897,83014,99617,74344],{45561:(D,b,o)=>{var m,h;m=[o(7237),o(32230),o(59006),o(56351),o(997),o(74344),o(63281),o(7927)],h=function(p,A,E,r,l,n,u,i){const s={};s.init=function(){$("#state").val(ajaxify.data.state).removeAttr("disabled"),$("#assignee").val(ajaxify.data.assignee).removeAttr("disabled"),$("#content > div").on("click","[data-action]",function(){const f=this.getAttribute("data-action"),t=$(this).parents("[data-uid]").attr("data-uid"),e=document.getElementById("note");switch(f){case"assign":$("#assignee").val(app.user.uid);case"update":{const a=$("#attributes").serializeArray().reduce((c,d)=>(c[d.name]=d.value,c),{});n.put(`/flags/${ajaxify.data.flagId}`,a).then(({history:c})=>{i.success("[[flags:updated]]"),s.reloadHistory(c)}).catch(i.error);break}case"addEditNote":{const a=this.closest('[component="flag/note"]');let c,d;if(a){c=a.getAttribute("data-datetime");const y=a.getAttribute("data-index");d=ajaxify.data.notes[y].content}u.prompt({title:`[[flags:${c?"edit":"add"}-note]]`,inputType:"textarea",rows:3,value:d,callback:y=>{y&&n.post(`/flags/${ajaxify.data.flagId}/notes`,{note:y,datetime:c}).then(x=>{i.success("[[flags:note-added]]"),s.reloadNotes(x.notes),s.reloadHistory(x.history)}).catch(i.error)},onShown:y=>{console.log(y)}});break}case"appendNote":n.post(`/flags/${ajaxify.data.flagId}/notes`,{note:e.value,datetime:parseInt(e.getAttribute("data-datetime"),10)}).then(a=>{i.success("[[flags:note-added]]"),s.reloadNotes(a.notes),s.reloadHistory(a.history),e.removeAttribute("data-datetime")}).catch(i.error);break;case"delete-note":{const a=parseInt(this.closest("[data-datetime]").getAttribute("data-datetime"),10);u.confirm("[[flags:delete-note-confirm]]",function(c){c&&n.del(`/flags/${ajaxify.data.flagId}/notes/${a}`,{}).then(d=>{i.success("[[flags:note-deleted]]"),s.reloadNotes(d.notes),s.reloadHistory(d.history)}).catch(i.error)});break}case"chat":o.e(93216).then(function(){var a=[o(93216)];(function(c){c.newChat(t)}).apply(null,a)}).catch(o.oe);break;case"ban":r.banAccount(t,ajaxify.refresh);break;case"unban":r.unbanAccount(t);break;case"mute":r.muteAccount(t,ajaxify.refresh);break;case"unmute":r.unmuteAccount(t);break;case"delete-account":l.account(t,ajaxify.refresh);break;case"delete-content":l.content(t,ajaxify.refresh);break;case"delete-all":l.purge(t,ajaxify.refresh);break;case"delete-post":g("delete",n.del,`/posts/${ajaxify.data.target.pid}/state`);break;case"purge-post":g("purge",n.del,`/posts/${ajaxify.data.target.pid}`);break;case"restore-post":g("restore",n.put,`/posts/${ajaxify.data.target.pid}/state`);break;case"delete-flag":{u.confirm("[[flags:delete-flag-confirm]]",function(a){a&&n.del(`/flags/${ajaxify.data.flagId}`,{}).then(()=>{i.success("[[flags:flag-deleted]]"),ajaxify.go("flags")}).catch(i.error)});break}}})};function g(f,t,e){A.translate("[[topic:post_"+f+"_confirm]]",function(a){u.confirm(a,function(c){c&&t(e).then(ajaxify.refresh).catch(i.error)})})}return s.reloadNotes=function(f){ajaxify.data.notes=f,E.render("flags/detail",{notes:f},"notes").then(function(t){const e=p.get("flag/notes");e.empty(),e.html(t),e.find("span.timeago").timeago()})},s.reloadHistory=function(f){app.parseAndTranslate("flags/detail","history",{history:f},function(t){const e=p.get("flag/history");e.empty(),e.html(t),e.find("span.timeago").timeago()})},s}.apply(b,m),h!==void 0&&(D.exports=h)},997:(D,b,o)=>{var m,h;m=[o(74344),o(63281),o(7927)],h=function(p,A,E){const r={};r.account=function(n,u){l(n,"[[user:delete_this_account_confirm]]","/account","[[user:account-deleted]]",u)},r.content=function(n,u){l(n,"[[user:delete_account_content_confirm]]","/content","[[user:account-content-deleted]]",u)},r.purge=function(n,u){l(n,"[[user:delete_all_confirm]]","","[[user:account-deleted]]",u)};function l(n,u,i,s,g){A.confirm(u,function(f){f&&p.del(`/users/${n}${i}`,{}).then(()=>{if(E.success(s),typeof g=="function")return g()}).catch(E.error)})}return r}.apply(b,m),h!==void 0&&(D.exports=h)},56351:(D,b,o)=>{var m,h;m=[o(59006),o(74344),o(63281),o(7927)],h=function(p,A,E,r){const l={};return l.banAccount=function(n,u){n=n||ajaxify.data.theirid,p.render("modals/temporary-ban",{}).then(function(i){E.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:i,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban_account]]",callback:function(){const s=$(".ban-modal form").serializeArray().reduce(function(f,t){return f[t.name]=t.value,f},{}),g=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;A.put("/users/"+n+"/ban",{until:g,reason:s.reason||""}).then(()=>{if(typeof u=="function")return u();ajaxify.refresh()}).catch(r.error)}}}})})},l.unbanAccount=function(n){A.del("/users/"+n+"/ban").then(()=>{ajaxify.refresh()}).catch(r.error)},l.muteAccount=function(n,u){n=n||ajaxify.data.theirid,p.render("modals/temporary-mute",{}).then(function(i){E.dialog({className:"mute-modal",title:"[[user:mute_account]]",message:i,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute_account]]",callback:function(){const s=$(".mute-modal form").serializeArray().reduce(function(f,t){return f[t.name]=t.value,f},{}),g=s.length>0?Date.now()+s.length*1e3*60*60*(parseInt(s.unit,10)?24:1):0;A.put("/users/"+n+"/mute",{until:g,reason:s.reason||""}).then(()=>{if(typeof u=="function")return u();ajaxify.refresh()}).catch(r.error)}}}})})},l.unmuteAccount=function(n){A.del("/users/"+n+"/mute").then(()=>{ajaxify.refresh()}).catch(r.error)},l}.apply(b,m),h!==void 0&&(D.exports=h)},74344:(D,b,o)=>{o.r(b),o.d(b,{del:()=>f,get:()=>n,head:()=>u,patch:()=>s,post:()=>i,put:()=>g});var m=o(85233),h=o.n(m),p=o(63281),A=o.n(p);const E=config.relative_path+"/api/v3";function r(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:E+t.url,typeof e=="function"){l(t,e);return}return new Promise((a,c)=>{l(t,function(d,y){if(d)return d.message==="A valid login session was not found. Please log in and try again."?(0,p.confirm)("[[error:api.reauth-required]]",x=>{x&&ajaxify.go("login")}):c(d);a(y)})})}async function l(t,e){const{url:a}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,m.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const c=await fetch(a,t),{headers:d}=c,y=d.get("content-type"),x=y&&y.startsWith("application/json");let j;if(x?j=await c.json():j=await c.text(),!c.ok)return e(new Error(x?j.status.message:j));e(null,x&&j.hasOwnProperty("status")&&j.hasOwnProperty("response")?j.response:j)}function n(t,e,a){return r({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},a)}function u(t,e,a){return r({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},a)}function i(t,e,a){return r({url:t,method:"post",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}function s(t,e,a){return r({url:t,method:"patch",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}function g(t,e,a){return r({url:t,method:"put",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}function f(t,e,a){return r({url:t,method:"delete",data:e,headers:{"x-csrf-token":config.csrf_token}},a)}}}]);
