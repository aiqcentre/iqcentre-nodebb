"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[20797,70565,76956,83014,28253,99617,74344,86193],{20363:(w,A,l)=>{var y,p;y=[l(74344),l(7927),l(32230),l(86193),l(75208)],p=function(h,f,r,g,x){const d={};d.init=function(n,c){let t;c.on("click",async function(){let a=[];app.user.isAdmin&&(a=await socket.emit("groups.getChatGroups",{}),Array.isArray(ajaxify.data.groups)&&a.forEach(u=>{u.selected=ajaxify.data.groups.includes(u.name)}));const i=await app.parseAndTranslate("modals/manage-room",{groups:a,user:app.user,room:ajaxify.data});t=bootbox.dialog({title:"[[modules:chat.manage-room]]",message:i,onEscape:!0}),t.attr("component","chat/manage-modal"),s(n,t),o(n,t),e(n,t);const m=t.find('[component="chat/manage/user/list"]'),E=t.find('[component="chat/manage/user/list/search"]');x.addSearchHandler(n,E,async u=>{E.val()?m.html(await app.parseAndTranslate("partials/chats/manage-room-users",u)):s(n,t)}),x.addInfiniteScrollHandler(n,m,async(u,k)=>{u.append(await app.parseAndTranslate("partials/chats/manage-room-users",k))});const b=t.find('[component="chat/manage/user/add/search"]'),_=t.find(".text-danger");g.user(b,function(u,k){_.text(""),h.post(`/chats/${n}/users`,{uids:[k.item.user.uid]}).then(v=>{s(n,t,v),b.val("")}).catch(v=>{r.translate(v.message,function(D){_.text(D)})})}),t.find('[component="chat/manage/save"]').on("click",()=>{const u=t.find('[component="chat/room/notification/setting"]');h.put(`/chats/${n}`,{groups:t.find('[component="chat/room/groups"]').val(),notificationSetting:u.val()}).then(k=>{ajaxify.data.groups=k.groups,ajaxify.data.notificationSetting=k.notificationSetting;const v=k.notificationOptions[0];$('[component="chat/notification/setting"] [data-icon]').first().attr("data-icon",v.icon),$('[component="chat/notification/setting/sub-label"]').translateText(v.subLabel),v.selected&&$('[component="chat/notification/setting/icon"]').attr("class",`fa ${v.icon}`),t.modal("hide")}).catch(f.error)})})};function o(n,c){c.on("click",'[data-action="kick"]',function(){const t=parseInt(this.getAttribute("data-uid"),10);h.del(`/chats/${n}/users/${t}`,{}).then(a=>{s(n,c,a)}).catch(f.error)})}function e(n,c){c.on("click",'[data-action="toggleOwner"]',async function(){const t=parseInt(this.getAttribute("data-uid"),10),a=$(this);await socket.emit("modules.chats.toggleOwner",{roomId:n,uid:t}),a.parents("[data-uid]").find('[component="chat/manage/user/owner/icon"]').toggleClass("hidden")})}async function s(n,c,t){const a=c.find('[component="chat/manage/user/list"]');if(!t)try{t=await h.get(`/chats/${n}/users`,{})}catch{a.find("li").text(await r.translate("[[error:invalid-data]]"))}a.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),a.html(await app.parseAndTranslate("partials/chats/manage-room-users",t)),a.find('[data-bs-toggle="tooltip"]').tooltip()}return d}.apply(A,y),p!==void 0&&(w.exports=p)},75208:(w,A,l)=>{var y,p;y=[l(74344)],p=function(h){const f={};let r=0;f.init=function(o,e){const s=e.find('[component="chat/user/list"]');s.length&&(e.find('[component="chat/user/list/btn"]').on("click",()=>{s.toggleClass("hidden"),s.hasClass("hidden")?x():g(o,s)}),$(window).off("action:ajaxify.start",x).one("action:ajaxify.start",x),f.addInfiniteScrollHandler(o,s,async(n,c)=>{n.append(await app.parseAndTranslate("partials/chats/user-list","users",c))}))};function g(o,e){r=setInterval(()=>{d(o,e)},5e3)}function x(){r&&(clearInterval(r),r=0)}async function d(o,e){if(ajaxify.data.template.chats&&app.isFocused&&e.scrollTop()===0&&!e.hasClass("hidden")){const s=await h.get(`/chats/${o}/users`,{start:0});e.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),e.html(await app.parseAndTranslate("partials/chats/user-list","users",s)),e.find('[data-bs-toggle="tooltip"]').tooltip()}}return f.addInfiniteScrollHandler=function(o,e,s){e.on("scroll",utils.debounce(async()=>{const n=(e[0].scrollHeight-e.height())*.85;if(e.scrollTop()>n){const c=e.find("[data-index]").last().attr("data-index"),t=await h.get(`/chats/${o}/users`,{start:parseInt(c,10)+1});t&&t.users.length&&s(e,t)}},200))},f.addSearchHandler=function(o,e,s){e.on("keyup",utils.debounce(async()=>{const n=e.val(),c=await socket.emit("modules.chats.searchMembers",{username:n,roomId:o});s(c)},200))},f}.apply(A,y),p!==void 0&&(w.exports=p)},74344:(w,A,l)=>{l.r(A),l.d(A,{del:()=>c,get:()=>d,head:()=>o,patch:()=>s,post:()=>e,put:()=>n});var y=l(85233),p=l.n(y),h=l(63281),f=l.n(h);const r=config.relative_path+"/api/v3";function g(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:r+t.url,typeof a=="function"){x(t,a);return}return new Promise((i,m)=>{x(t,function(E,b){if(E)return E.message==="A valid login session was not found. Please log in and try again."?(0,h.confirm)("[[error:api.reauth-required]]",_=>{_&&ajaxify.go("login")}):m(E);i(b)})})}async function x(t,a){const{url:i}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,y.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const m=await fetch(i,t),{headers:E}=m,b=E.get("content-type"),_=b&&b.startsWith("application/json");let u;if(_?u=await m.json():u=await m.text(),!m.ok)return a(new Error(_?u.status.message:u));a(null,_&&u.hasOwnProperty("status")&&u.hasOwnProperty("response")?u.response:u)}function d(t,a,i){return g({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},i)}function o(t,a,i){return g({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},i)}function e(t,a,i){return g({url:t,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}function s(t,a,i){return g({url:t,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}function n(t,a,i){return g({url:t,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}function c(t,a,i){return g({url:t,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}},86193:(w,A,l)=>{var y,p;y=[l(74344),l(7927)],p=function(h,f){const r={},g={delay:200,appendTo:null};r.init=d=>{const o={...g,...d},{input:e,onSelect:s}=o;app.loadJQueryUI(function(){e.autocomplete({...o,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(n,c){x(e,s,n,c)}})})},r.user=function(d,o,e){typeof o=="function"&&(e=o,o={}),o=o||{},r.init({input:d,onSelect:e,source:(s,n)=>{o.query=s.term,h.get("/api/users",o,function(c,t){if(c)return f.error(c);if(t&&t.users){const a=t.users.map(function(i){const m=$("<div></div>").html(i.username).text();return i&&{label:m,value:m,user:{uid:i.uid,name:i.username,slug:i.userslug,username:i.username,userslug:i.userslug,picture:i.picture,banned:i.banned,"icon:text":i["icon:text"],"icon:bgColor":i["icon:bgColor"]}}});n(a)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.group=function(d,o){r.init({input:d,onSelect:o,source:(e,s)=>{socket.emit("groups.search",{query:e.term},function(n,c){if(n)return f.error(n);if(c&&c.length){const t=c.map(function(a){return a&&{label:a.name,value:a.name,group:a}});s(t)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.tag=function(d,o){r.init({input:d,onSelect:o,delay:100,source:(e,s)=>{socket.emit("topics.autocompleteTags",{query:e.term,cid:ajaxify.data.cid||0},function(n,c){if(n)return f.error(n);c&&s(c),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function x(d,o,e,s){o=o||function(){};const n=jQuery.Event("keypress");n.which=13,n.keyCode=13,setTimeout(function(){d.trigger(n)},100),o(e,s)}return r}.apply(A,y),p!==void 0&&(w.exports=p)}}]);
