"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[56108,70565,16922,83014,99617,74344,34654],{34654:(P,_,c)=>{var d,p;d=[c(74344),c(63281),c(7927),c(47720)],p=function(u,h,i){const s={},y={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};s.open=function(n){config.enablePostHistory&&u.get(`/posts/${n}/diffs`,{}).then(f=>{E(f).then(l=>{const r=h.dialog({title:"[[topic:diffs.title]]",message:l,size:"large",onEscape:!0,backdrop:!0});if(!f.timestamps.length)return;const a=r.find("select"),t=r.find('button[data-action="restore"]'),e=r.find('button[data-action="delete"]'),o=r.find("ul.posts-list"),m=r.find(".number-of-diffs strong");a.on("change",function(){s.load(n,this.value,o),t.prop("disabled",f.timestamps.indexOf(this.value)===0),e.prop("disabled",f.timestamps.indexOf(this.value)===0)}),t.on("click",function(){s.restore(n,a.val(),r)}),e.on("click",function(){s.delete(n,a.val(),a,m)}),r.on("shown.bs.modal",function(){s.load(n,a.val(),o),t.prop("disabled",!0),e.prop("disabled",!0)})})}).catch(i.error)},s.load=function(n,f,l){config.enablePostHistory&&u.get(`/posts/${n}/diffs/${f}`,{}).then(r=>{r.deleted=!!parseInt(r.deleted,10),app.parseAndTranslate("partials/posts_list","posts",{posts:[r]},function(a){l.empty().append(a),l.find(".timeago").timeago()})}).catch(i.error)},s.restore=function(n,f,l){config.enablePostHistory&&u.put(`/posts/${n}/diffs/${f}`,{}).then(()=>{l.modal("hide"),i.success("[[topic:diffs.post-restored]]")}).catch(i.error)},s.delete=function(n,f,l,r){u.del(`/posts/${n}/diffs/${f}`).then(a=>{E(a,"diffs").then(t=>{l.empty().append(t),l.trigger("change");const e=l.find("option").length;r.text(e),i.success("[[topic:diffs.deleted]]")})}).catch(i.error)};function E(n,f){return new Promise(l=>{const r=[{diffs:n.revisions.map(function(a){const t=parseInt(a.timestamp,10);return{username:a.username,timestamp:t,pretty:new Date(t).toLocaleString(config.userLang.replace("_","-"),y)}}),numDiffs:n.timestamps.length,editable:n.editable,deletable:n.deletable},function(a){l(a)}];f&&r.unshift(f),app.parseAndTranslate("modals/post-history",...r)})}return s}.apply(_,d),p!==void 0&&(P.exports=p)},47720:(P,_)=>{var c,d;c=[],d=function(){const p={},u=/-resized(\.[\w]+)?$/;return p.wrapImagesInLinks=function(h){h.find('[component="post/content"] img:not(.emoji)').each(function(){p.wrapImageInLink($(this))})},p.wrapImageInLink=function(h){let i=h.attr("src")||"";if(i!=="about:blank"&&!h.parent().is("a")){utils.isRelativeUrl(i)&&u.test(i)&&(i=i.replace(u,"$1"));const s=h.attr("alt")||"",y=i.split(".").slice(1).pop(),E=s.split("/").pop(),n=E.split(".").slice(1).pop();h.wrap('<a href="'+i+'" '+(!y&&n?' download="'+utils.escapeHTML(E)+'" ':"")+' target="_blank" rel="noopener">')}},p}.apply(_,c),d!==void 0&&(P.exports=d)},74344:(P,_,c)=>{c.r(_),c.d(_,{del:()=>a,get:()=>E,head:()=>n,patch:()=>l,post:()=>f,put:()=>r});var d=c(85233),p=c.n(d),u=c(63281),h=c.n(u);const i=config.relative_path+"/api/v3";function s(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:i+t.url,typeof e=="function"){y(t,e);return}return new Promise((o,m)=>{y(t,function(b,A){if(b)return b.message==="A valid login session was not found. Please log in and try again."?(0,u.confirm)("[[error:api.reauth-required]]",D=>{D&&ajaxify.go("login")}):m(b);o(A)})})}async function y(t,e){const{url:o}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,d.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const m=await fetch(o,t),{headers:b}=m,A=b.get("content-type"),D=A&&A.startsWith("application/json");let g;if(D?g=await m.json():g=await m.text(),!m.ok)return e(new Error(D?g.status.message:g));e(null,D&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g)}function E(t,e,o){return s({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},o)}function n(t,e,o){return s({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},o)}function f(t,e,o){return s({url:t,method:"post",data:e,headers:{"x-csrf-token":config.csrf_token}},o)}function l(t,e,o){return s({url:t,method:"patch",data:e,headers:{"x-csrf-token":config.csrf_token}},o)}function r(t,e,o){return s({url:t,method:"put",data:e,headers:{"x-csrf-token":config.csrf_token}},o)}function a(t,e,o){return s({url:t,method:"delete",data:e,headers:{"x-csrf-token":config.csrf_token}},o)}}}]);
