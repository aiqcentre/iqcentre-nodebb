"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[48724],{50395:(p,f,r)=>{var i,s;i=[r(7237),r(85233)],s=function(c,C){const h={};h.prepareDOM=function(){const t=$('[component="chat/dropdown"]');t.length&&(t.on("show.bs.dropdown",n=>{o("loadChatsDropdown",$(n.target).parent().find('[component="chat/list"]'))}),t.each((n,e)=>{const a=$(e).parent().find(".dropdown-menu");a.hasClass("show")&&o("loadChatsDropdown",a.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",u),socket.on("event:chats.receive",u),socket.removeListener("event:user_status_change",d),socket.on("event:user_status_change",d),socket.removeListener("event:chats.roomRename",l),socket.on("event:chats.roomRename",l),socket.on("event:unread.updateChatCount",async function(n){if(n){const[g,v]=await app.require(["chat","forum/chats"]);if(g.isFromBlockedUser(n.fromUid)||g.isLookingAtRoom(n.roomId)||app.user.uid===parseInt(n.fromUid,10))return;v.markChatPageElUnread(n)}let e=await socket.emit("modules.chats.getUnreadCount",{});const a=c.get("chat/icon");e=Math.max(0,e),a.toggleClass("fa-comment",e>0).toggleClass("fa-comment-o",e<=0);const m=e>99?"99+":e;c.get("chat/icon").toggleClass("unread-count",e>0).attr("data-content",m),c.get("chat/count").toggleClass("hidden",e<=0).text(m),C.fire("action:chat.updateCount",{count:e})}))};function u(t){o("onChatMessageReceived",t)}function d(t){o("onUserStatusChange",t)}function l(t){o("onRoomRename",t)}async function o(t,n){(await app.require("chat"))[t](n)}return h}.apply(f,i),s!==void 0&&(p.exports=s)}}]);
