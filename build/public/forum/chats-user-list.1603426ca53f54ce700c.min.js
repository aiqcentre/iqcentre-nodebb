"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[76956,70565,83014,99617,74344],{75208:(P,x,o)=>{var g,b;g=[o(74344)],b=function(_){const u={};let f=0;u.init=function(r,e){const s=e.find('[component="chat/user/list"]');s.length&&(e.find('[component="chat/user/list/btn"]').on("click",()=>{s.toggleClass("hidden"),s.hasClass("hidden")?h():i(r,s)}),$(window).off("action:ajaxify.start",h).one("action:ajaxify.start",h),u.addInfiniteScrollHandler(r,s,async(d,l)=>{d.append(await app.parseAndTranslate("partials/chats/user-list","users",l))}))};function i(r,e){f=setInterval(()=>{O(r,e)},5e3)}function h(){f&&(clearInterval(f),f=0)}async function O(r,e){if(ajaxify.data.template.chats&&app.isFocused&&e.scrollTop()===0&&!e.hasClass("hidden")){const s=await _.get(`/chats/${r}/users`,{start:0});e.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),e.html(await app.parseAndTranslate("partials/chats/user-list","users",s)),e.find('[data-bs-toggle="tooltip"]').tooltip()}}return u.addInfiniteScrollHandler=function(r,e,s){e.on("scroll",utils.debounce(async()=>{const d=(e[0].scrollHeight-e.height())*.85;if(e.scrollTop()>d){const l=e.find("[data-index]").last().attr("data-index"),t=await _.get(`/chats/${r}/users`,{start:parseInt(l,10)+1});t&&t.users.length&&s(e,t)}},200))},u.addSearchHandler=function(r,e,s){e.on("keyup",utils.debounce(async()=>{const d=e.val(),l=await socket.emit("modules.chats.searchMembers",{username:d,roomId:r});s(l)},200))},u}.apply(x,g),b!==void 0&&(P.exports=b)},74344:(P,x,o)=>{o.r(x),o.d(x,{del:()=>l,get:()=>O,head:()=>r,patch:()=>s,post:()=>e,put:()=>d});var g=o(85233),b=o.n(g),_=o(63281),u=o.n(_);const f=config.relative_path+"/api/v3";function i(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:f+t.url,typeof a=="function"){h(t,a);return}return new Promise((n,p)=>{h(t,function(m,k){if(m)return m.message==="A valid login session was not found. Please log in and try again."?(0,_.confirm)("[[error:api.reauth-required]]",y=>{y&&ajaxify.go("login")}):p(m);n(k)})})}async function h(t,a){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,g.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const p=await fetch(n,t),{headers:m}=p,k=m.get("content-type"),y=k&&k.startsWith("application/json");let c;if(y?c=await p.json():c=await p.text(),!p.ok)return a(new Error(y?c.status.message:c));a(null,y&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c)}function O(t,a,n){return i({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},n)}function r(t,a,n){return i({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},n)}function e(t,a,n){return i({url:t,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function s(t,a,n){return i({url:t,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function d(t,a,n){return i({url:t,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function l(t,a,n){return i({url:t,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
