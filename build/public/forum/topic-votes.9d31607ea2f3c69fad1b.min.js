"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[40549,70565,83014,99617,74344],{13578:(O,m,a)=>{var d,E;d=[a(7237),a(32230),a(74344),a(85233),a(63281),a(7927),a(73138)],E=function(p,P,y,l,v,h,g){const u={};let f={};u.addVoteHandler=function(){f={},p.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',D),p.get("topic").on("mouseleave",'[data-pid] [component="post/vote-count"]',T)};function T(){const e=$(this),n=e.parents("[data-pid]").attr("data-pid"),s=g.Tooltip.getInstance(this);s&&(s.dispose(),e.attr("title","")),f[n]=!1}function D(){const e=$(this),s=e.parent().parents("[data-pid]").attr("data-pid");f[s]=!0;const o=g.Tooltip.getInstance(this);o&&(o.dispose(),e.attr("title","")),socket.emit("posts.getUpvoters",[s],function(r,i){if(r)return h.error(r);f[s]&&i.length&&t(e,i[0])})}function t(e,n){function s(r){e.attr("title",r),new g.Tooltip(e,{container:"#content",html:!0}).show()}let o=n.usernames.filter(r=>r!=="[[global:former_user]]");o.length&&(o.length+n.otherCount>n.cutoff?(o=o.join(", ").replace(/,/g,"|"),P.translate("[[topic:users_and_others, "+o+", "+n.otherCount+"]]",function(r){r=r.replace(/\|/g,","),s(r)})):(o=o.join(", "),s(o)))}return u.toggleVote=function(e,n,s){const o=e.closest("[data-pid]"),i=o.find(n).length?"del":"put",c=o.attr("data-pid");return y[i](`/posts/${c}/vote`,{delta:s},function(A){if(A){if(!app.user.uid){ajaxify.go("login");return}return h.error(A)}l.fire("action:post.toggleVote",{pid:c,delta:s,unvote:i==="del"})}),!1},u.showVotes=function(e){socket.emit("posts.getVoters",{pid:e,cid:ajaxify.data.cid},function(n,s){if(n)return n.message==="[[error:no-privileges]]"?void 0:h.error(n);app.parseAndTranslate("modals/votes",s,function(o){const r=v.dialog({title:"[[global:voters]]",message:o,className:"vote-modal",show:!0,onEscape:!0,backdrop:!0});r.on("click",function(){r.modal("hide")})})})},u}.apply(m,d),E!==void 0&&(O.exports=E)},74344:(O,m,a)=>{a.r(m),a.d(m,{del:()=>D,get:()=>h,head:()=>g,patch:()=>f,post:()=>u,put:()=>T});var d=a(85233),E=a.n(d),p=a(63281),P=a.n(p);const y=config.relative_path+"/api/v3";function l(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:y+t.url,typeof e=="function"){v(t,e);return}return new Promise((n,s)=>{v(t,function(o,r){if(o)return o.message==="A valid login session was not found. Please log in and try again."?(0,p.confirm)("[[error:api.reauth-required]]",i=>{i&&ajaxify.go("login")}):s(o);n(r)})})}async function v(t,e){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,d.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const s=await fetch(n,t),{headers:o}=s,r=o.get("content-type"),i=r&&r.startsWith("application/json");let c;if(i?c=await s.json():c=await s.text(),!s.ok)return e(new Error(i?c.status.message:c));e(null,i&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c)}function h(t,e,n){return l({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},n)}function g(t,e,n){return l({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},n)}function u(t,e,n){return l({url:t,method:"post",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function f(t,e,n){return l({url:t,method:"patch",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function T(t,e,n){return l({url:t,method:"put",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function D(t,e,n){return l({url:t,method:"delete",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
