"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[5517,70565,21710,1897,83014,52256,66623,49286,99617,74344],{2525:(j,v,d)=>{var y,h;y=[d(39941),d(50548),d(74344),d(7927),d(63281),d(56351),d(997)],h=function(A,x,b,s,o,e,n){const a={};a.init=function(){$('[data-bs-toggle="tooltip"]').tooltip(),A.init($('[component="category/dropdown"]'),{privilege:"moderate"}),t(),g(),u('[data-action="editContent"]',".post-content-editable","textarea",".post-content"),u('[data-action="editTitle"]',".topic-title-editable","input",".topic-title"),$(".posts-list").on("click",".topic-category[data-editable]",function(l){r(this),l.stopPropagation(),l.preventDefault()}),$('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid")};function c(l){return new Promise(m=>{o.confirm(l,m)})}function u(l,m,p,E){$(".posts-list").on("click",l,function(){const f=$(this),C=f.parents("[data-id]").find(m),w=f.parents("[data-id]").find(E);C.length&&(w.addClass("hidden"),C.removeClass("hidden").find(p).focus())}),$(".posts-list").on("blur",m+" "+p,function(){const f=$(this),C=f.parent().parent().find(E),w=f.parents("[data-id]").attr("data-id"),D=l==='[data-action="editTitle"]';socket.emit("posts.editQueuedContent",{id:w,title:D?f.val():void 0,content:D?void 0:f.val()},function(P,S){if(P)return s.error(P);D?C.find(".title-text").text(S.postData.title):C.html(S.postData.content),f.parent().addClass("hidden"),C.removeClass("hidden")})})}function r(l){const m=$(l),p=m.parents("[data-id]").attr("data-id");return x.modal({onSubmit:function(E){Promise.all([b.get(`/categories/${E.cid}`,{}),socket.emit("posts.editQueuedContent",{id:p,cid:E.cid})]).then(function(f){const C=f[0];app.parseAndTranslate("post-queue","posts",{posts:[{category:C}]},function(w){m.find(".category-text").length?m.find(".category-text").text(w.find(".topic-category .category-text").text()):m.replaceWith(w.find(".topic-category"))})}).catch(s.error)}}),!1}function t(){const l=document.querySelector(".posts-list");l&&l.addEventListener("click",m=>{const p=m.target.closest("[data-action]");if(p){const E=p.getAttribute("data-action"),f=p.closest("[data-uid]").getAttribute("data-uid");switch(E){case"editCategory":{const C=m.target.closest("[data-id]").querySelector(".topic-category");r(C);break}case"ban":e.banAccount(f,ajaxify.refresh);break;case"unban":e.unbanAccount(f);break;case"mute":e.muteAccount(f,ajaxify.refresh);break;case"unmute":e.unmuteAccount(f);break;case"delete-account":n.account(f,ajaxify.go.bind(null,"post-queue"));break;case"delete-content":n.content(f,ajaxify.go.bind(null,"post-queue"));break;case"delete-all":n.purge(f,ajaxify.go.bind(null,"post-queue"));break;default:i.call(m.target);break}}})}async function i(){function l(){return new Promise(C=>{const w=o.dialog({title:"[[post-queue:notify-user]]",message:'<textarea class="form-control"></textarea>',buttons:{OK:{label:"[[modules:bootbox.send]]",callback:function(){const D=w.find("textarea").val();D&&C(D)}}}})})}const m=$(this).parents("[data-id]"),p=$(this).attr("data-action"),E=m.attr("data-id"),f=m.get(0).parentNode;if(!(!["accept","reject","notify"].includes(p)||p==="reject"&&!await c(ajaxify.data.canAccept?"[[post-queue:confirm-reject]]":"[[post-queue:confirm-remove]]")))return socket.emit("posts."+p,{id:E,message:p==="notify"?await l():void 0},function(C){if(C)return s.error(C);(p==="accept"||p==="reject")&&m.remove(),f.childElementCount===0&&(ajaxify.data.singlePost?ajaxify.go("/post-queue"+window.location.search):ajaxify.refresh())}),!1}function g(){$('[component="post-queue/bulk-actions"]').on("click","[data-action]",async function(){const l=$(this).attr("data-action");let m=$(".posts-list [data-id]");(l==="accept-selected"||l==="reject-selected")&&(m=m.filter((D,P)=>$(P).find('input[type="checkbox"]').is(":checked")));const p=m.map((D,P)=>$(P).attr("data-id")).get(),E=l==="reject-all"||l==="reject-selected",f=ajaxify.data.canAccept?`${l}-confirm`:`${l.replace(/^reject/,"remove")}-confirm`;if(!p.length||E&&!await c(`[[post-queue:${f}, ${p.length}]]`))return;const C=l.split("-")[0],w=p.map(D=>socket.emit("posts."+C,{id:D}));Promise.allSettled(w).then(function(D){const P=D.filter(k=>k.status==="fulfilled").length,S=D.filter(k=>k.status==="rejected");P&&(s.success(`[[post-queue:bulk-${C}-success, ${P}]]`),ajaxify.refresh()),S.forEach(k=>s.error(k.reason))})})}return a}.apply(v,y),h!==void 0&&(j.exports=h)},997:(j,v,d)=>{var y,h;y=[d(74344),d(63281),d(7927)],h=function(A,x,b){const s={};s.account=function(e,n){o(e,"[[user:delete_this_account_confirm]]","/account","[[user:account-deleted]]",n)},s.content=function(e,n){o(e,"[[user:delete_account_content_confirm]]","/content","[[user:account-content-deleted]]",n)},s.purge=function(e,n){o(e,"[[user:delete_all_confirm]]","","[[user:account-deleted]]",n)};function o(e,n,a,c,u){x.confirm(n,function(r){r&&A.del(`/users/${e}${a}`,{}).then(()=>{if(b.success(c),typeof u=="function")return u()}).catch(b.error)})}return s}.apply(v,y),h!==void 0&&(j.exports=h)},56351:(j,v,d)=>{var y,h;y=[d(59006),d(74344),d(63281),d(7927)],h=function(A,x,b,s){const o={};return o.banAccount=function(e,n){e=e||ajaxify.data.theirid,A.render("modals/temporary-ban",{}).then(function(a){b.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:a,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban_account]]",callback:function(){const c=$(".ban-modal form").serializeArray().reduce(function(r,t){return r[t.name]=t.value,r},{}),u=c.length>0?Date.now()+c.length*1e3*60*60*(parseInt(c.unit,10)?24:1):0;x.put("/users/"+e+"/ban",{until:u,reason:c.reason||""}).then(()=>{if(typeof n=="function")return n();ajaxify.refresh()}).catch(s.error)}}}})})},o.unbanAccount=function(e){x.del("/users/"+e+"/ban").then(()=>{ajaxify.refresh()}).catch(s.error)},o.muteAccount=function(e,n){e=e||ajaxify.data.theirid,A.render("modals/temporary-mute",{}).then(function(a){b.dialog({className:"mute-modal",title:"[[user:mute_account]]",message:a,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute_account]]",callback:function(){const c=$(".mute-modal form").serializeArray().reduce(function(r,t){return r[t.name]=t.value,r},{}),u=c.length>0?Date.now()+c.length*1e3*60*60*(parseInt(c.unit,10)?24:1):0;x.put("/users/"+e+"/mute",{until:u,reason:c.reason||""}).then(()=>{if(typeof n=="function")return n();ajaxify.refresh()}).catch(s.error)}}}})})},o.unmuteAccount=function(e){x.del("/users/"+e+"/mute").then(()=>{ajaxify.refresh()}).catch(s.error)},o}.apply(v,y),h!==void 0&&(j.exports=h)},74344:(j,v,d)=>{d.r(v),d.d(v,{del:()=>r,get:()=>e,head:()=>n,patch:()=>c,post:()=>a,put:()=>u});var y=d(85233),h=d.n(y),A=d(63281),x=d.n(A);const b=config.relative_path+"/api/v3";function s(t,i){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:b+t.url,typeof i=="function"){o(t,i);return}return new Promise((g,l)=>{o(t,function(m,p){if(m)return m.message==="A valid login session was not found. Please log in and try again."?(0,A.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go("login")}):l(m);g(p)})})}async function o(t,i){const{url:g}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,y.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const l=await fetch(g,t),{headers:m}=l,p=m.get("content-type"),E=p&&p.startsWith("application/json");let f;if(E?f=await l.json():f=await l.text(),!l.ok)return i(new Error(E?f.status.message:f));i(null,E&&f.hasOwnProperty("status")&&f.hasOwnProperty("response")?f.response:f)}function e(t,i,g){return s({url:t+(i&&Object.keys(i).length?"?"+$.param(i):"")},g)}function n(t,i,g){return s({url:t+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"head"},g)}function a(t,i,g){return s({url:t,method:"post",data:i,headers:{"x-csrf-token":config.csrf_token}},g)}function c(t,i,g){return s({url:t,method:"patch",data:i,headers:{"x-csrf-token":config.csrf_token}},g)}function u(t,i,g){return s({url:t,method:"put",data:i,headers:{"x-csrf-token":config.csrf_token}},g)}function r(t,i,g){return s({url:t,method:"delete",data:i,headers:{"x-csrf-token":config.csrf_token}},g)}},39941:(j,v,d)=>{var y,h;y=[d(22905),d(74344),d(85233)],h=function(A,x,b){const s={};s.init=function(e,n){if(!e||!e.length)return;n=n||{},n.states=n.states||["watching","notwatching","ignoring"],n.template=n.template||"partials/category/filter-dropdown-left",b.fire("action:category.filter.options",{el:e,options:n}),A.init(e,n);let a=[],c=[];Array.isArray(n.selectedCids)?a=n.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(a=ajaxify.data.selectedCids.map(String)),c=a.slice(),e.on("hidden.bs.dropdown",function(){let u=c.length!==a.length;if(c.forEach(function(r,t){r!==a[t]&&(u=!0)}),c=a.slice(),u&&(n.updateButton?n.updateButton({el:e,changed:u,selectedCids:a.slice()}):n.updateButton!==!1&&o(e,a)),n.onHidden){n.onHidden({changed:u,selectedCids:a.slice()});return}if(u){let r=window.location.pathname;const t=utils.params();a.length?t.cid=a:delete t.cid,delete t.page,Object.keys(t).length&&(r+="?"+decodeURIComponent($.param(t))),ajaxify.go(r)}}),e.on("click",'[component="category/list"] [data-cid]',function(){const u=e.find('[component="category/list"]'),r=$(this),t=r.find("a").attr("href");if(t&&t!=="#"&&t.length)return;const i=r.attr("data-cid"),g=r.find('[component="category/select/icon"]');return i!=="all"?(a.includes(i)?a.splice(a.indexOf(i),1):a.push(i),a.sort(function(l,m){return l-m}),g.toggleClass("invisible"),u.find('[data-cid="all"] i').toggleClass("invisible",!!a.length)):(e.find('[component="category/select/icon"]').addClass("invisible"),u.find('[data-cid="all"] i').removeClass("invisible"),a=[]),n.selectedCids=a,n.onSelect&&n.onSelect({cid:i,selectedCids:a.slice()}),!1})};function o(e,n){n.length>1?a({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?x.get(`/categories/${n[0]}`,{}).then(a):a();function a(c){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:c},function(u){e.find("button").replaceWith($("<div/>").html(u).find("button"))})}}return s}.apply(v,y),h!==void 0&&(j.exports=h)},22905:(j,v,d)=>{var y,h;y=[d(7927),d(73138)],h=function(A,x){const b={};return b.init=function(s,o){let e=null;o=o||{},o.privilege=o.privilege||"topics:read",o.states=o.states||["watching","notwatching","ignoring"],o.cacheList=o.hasOwnProperty("cacheList")?o.cacheList:!0;let n=[];Array.isArray(o.localCategories)&&(n=o.localCategories.map(t=>({...t}))),o.selectedCids=o.selectedCids||ajaxify.data.selectedCids||[];const a=s.find('[component="category-selector-search"]');if(!a.length)return;const c=a.parent('[component="category/dropdown"]').length>0||a.parent('[component="category-selector"]').length>0;s.on("show.bs.dropdown",function(){c&&(s.find(".dropdown-toggle").css({visibility:"hidden"}),a.removeClass("hidden"),a.css({"z-index":s.find(".dropdown-toggle").css("z-index")+1}));function t(){const i=a.find("input").val();i.length>1||!i&&!e?u(i,function(g){e=o.cacheList&&(e||g),r(g)}):!i&&e&&r(e)}a.on("click",function(i){i.preventDefault(),i.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),s.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||a.find("input").focus()}),s.on("hide.bs.dropdown",function(){c&&(s.find(".dropdown-toggle").css({visibility:"inherit"}),a.addClass("hidden")),a.off("click"),a.find("input").off("keyup")});function u(t,i){socket.emit("categories.categorySearch",{search:t,query:utils.params(),parentCid:o.parentCid||0,selectedCids:o.selectedCids,privilege:o.privilege,states:o.states,showLinks:o.showLinks},function(g,l){if(g)return A.error(g);i(n.concat(l))})}function r(t){const i=o.selectedCids.map(String);t.forEach(function(g){g.selected=i.includes(String(g.cid))}),app.parseAndTranslate(o.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(g){s.find('[component="category/list"]').html(g.find('[component="category/list"]').html()),s.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const l=x.Dropdown.getInstance(s.find(".dropdown-toggle").get(0));l&&l.update()})}},b}.apply(v,y),h!==void 0&&(j.exports=h)},50548:(j,v,d)=>{var y,h;y=[d(22905),d(63281),d(85233),d(32230)],h=function(A,x,b,s){const o={};return o.init=function(e,n){if(!e||!e.length)return;n=n||{};const a=n.onSelect||function(){};n.states=n.states||["watching","notwatching","ignoring"],n.template=n.template||"partials/category/selector-dropdown-left",b.fire("action:category.selector.options",{el:e,options:n}),A.init(e,n);const c={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const r=$(this);return r.hasClass("disabled")?!1:(c.selectCategory(r.attr("data-cid")),a(c.selectedCategory))});let u=c.el.find('[component="category-selector-selected"]').html();return s.translate(u,r=>{u=r}),c.selectCategory=function(r){const t=c.el.find('[data-cid="'+r+'"]');c.selectedCategory={cid:r,name:t.attr("data-name")},t.length?c.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):c.el.find('[component="category-selector-selected"]').html(u)},c.getSelectedCategory=function(){return c.selectedCategory},c.getSelectedCid=function(){return c.selectedCategory?c.selectedCategory.cid:0},n.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(n.template,{selectedCategory:n.selectedCategory},function(r){c.el.find('[component="category-selector-selected"]').html(r.find('[component="category-selector-selected"]').html())}),c},o.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(n){const a=x.dialog({title:e.title||"[[modules:composer.select_category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),c=o.init(a.find('[component="category-selector"]'),e);function u(r){return r.preventDefault(),c.selectedCategory&&(e.onSubmit(c.selectedCategory),a.modal("hide")),!1}e.openOnLoad&&a.on("shown.bs.modal",function(){a.find(".dropdown-toggle").dropdown("toggle")}),a.find("form").on("submit",u)})},o}.apply(v,y),h!==void 0&&(j.exports=h)}}]);
