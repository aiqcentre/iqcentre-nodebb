"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[49397,70565,84745,83014,99617,74344],{98900:(C,g,s)=>{var l,d;l=[s(7237),s(74344),s(7927),s(85925)],d=function(h,D,f,c){const i={};i.init=function(){h.get("chat/create").on("click",y)};async function y(){let E=[];app.user.isAdmin&&(E=await socket.emit("groups.getChatGroups",{}));const v=await app.parseAndTranslate("modals/create-room",{user:app.user,groups:E}),o=bootbox.dialog({title:"[[modules:chat.create-room]]",message:v,onEscape:!0,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:function(){const a=o.find('[component="chat/room/name"]').val(),e=o.find('[component="chat/room/users"] [component="chat/user"]').find("[data-uid]").map((u,m)=>$(m).attr("data-uid")).get(),t=o.find('[component="chat/room/type"]').val(),r=o.find('[component="chat/room/groups"]').val();return t==="private"&&!e.length?(f.error("[[error:no-users-selected]]"),!1):t==="public"&&!r.length?(f.error("[[error:no-groups-selected]]"),!1):app.user.uid?(D.post("/chats",{roomName:a,uids:e,type:t,groups:r}).then(({roomId:u})=>{ajaxify.go("chats/"+u),o.modal("hide")}).catch(f.error),!1):(f.error("[[error:not-logged-in]]"),!1)}}}}),n=o.find('[component="chat/room/users"]');c.init({onSelect:async function(a){const e=await app.parseAndTranslate("modals/create-room","selectedUsers",{selectedUsers:[a]});n.append(e)}}),n.on("click",'[component="chat/room/users/remove"]',function(){$(this).parents("[data-uid]").remove()}),o.find('[component="chat/room/type"]').on("change",function(){const a=$(this).val();o.find('[component="chat/room/public/options"]').toggleClass("hidden",a==="private")})}return i}.apply(g,l),d!==void 0&&(C.exports=d)},85925:(C,g,s)=>{var l,d;l=[s(7237),s(74344),s(7927)],d=function(h,D,f){const c={};let i=[];c.init=function(n){n=n||{},i.length=0,h.get("chat/search").on("keyup",utils.debounce(E,250));const a=$('[component="chat/search/list"]');a.on("click","[data-uid]",function(){n.onSelect&&n.onSelect(i.find(e=>parseInt(e.uid,10)===parseInt($(this).attr("data-uid"),10))),y(a)})};function y(n){h.get("chat/search").val(""),v(n),n.find('[component="chat/search/no-users"]').addClass("hidden"),n.find('[component="chat/search/start-typing"]').removeClass("hidden")}function E(){const n=$('[component="chat/search/list"]'),a=h.get("chat/search").val();if(!a)return y(n);n.find('[component="chat/search/start-typing"]').addClass("hidden"),D.get("/api/users",{query:a,searchBy:"username",paginate:!1}).then(o).catch(f.error)}function v(n){i.length=0,n.find("[data-uid]").remove()}async function o(n){const a=$('[component="chat/search/list"]');if(v(a),n.users=n.users.filter(function(t){return parseInt(t.uid,10)!==parseInt(app.user.uid,10)}),i=n.users,!n.users.length)return a.find('[component="chat/search/no-users"]').removeClass("hidden");a.find('[component="chat/search/no-users"]').addClass("hidden");const e=await app.parseAndTranslate("modals/create-room","searchUsers",{searchUsers:n.users});a.append(e),a.parent().toggleClass("show",!0)}return c}.apply(g,l),d!==void 0&&(C.exports=d)},74344:(C,g,s)=>{s.r(g),s.d(g,{del:()=>a,get:()=>y,head:()=>E,patch:()=>o,post:()=>v,put:()=>n});var l=s(85233),d=s.n(l),h=s(63281),D=s.n(h);const f=config.relative_path+"/api/v3";function c(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:f+e.url,typeof t=="function"){i(e,t);return}return new Promise((r,u)=>{i(e,function(m,P){if(m)return m.message==="A valid login session was not found. Please log in and try again."?(0,h.confirm)("[[error:api.reauth-required]]",A=>{A&&ajaxify.go("login")}):u(m);r(P)})})}async function i(e,t){const{url:r}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,l.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const u=await fetch(r,e),{headers:m}=u,P=m.get("content-type"),A=P&&P.startsWith("application/json");let p;if(A?p=await u.json():p=await u.text(),!u.ok)return t(new Error(A?p.status.message:p));t(null,A&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p)}function y(e,t,r){return c({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function E(e,t,r){return c({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},r)}function v(e,t,r){return c({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function o(e,t,r){return c({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function n(e,t,r){return c({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function a(e,t,r){return c({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}}}]);
