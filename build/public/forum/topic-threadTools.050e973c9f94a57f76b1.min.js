"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[41375,53375,16922,82586,83892],{25142:(B,b,s)=>{var C,A;C=[s(85233),s(7927)],A=function(f,h){const v={};let I,u=0,g=!1,D,E=0;v.init=function(c,d){const x=$("body");typeof c=="function"?(I=c,D=x):(I=d,D=c||x),u=$(window).scrollTop(),$(window).off("scroll",w).on("scroll",w),x.height()<=$(window).height()&&I(1)};function w(){E&&clearTimeout(E),E=setTimeout(function(){E=0,a()},60)}function a(){const c=utils.findBootstrapEnvironment(),d=(c==="xs"||c==="sm")&&$("html").hasClass("composing");if(g||d||app.flags._glance)return;const x=$(window).scrollTop(),o=$(window).height(),n=D.height()-o,l=D.offset()?D.offset().top:0,i=100*(x-l)/(n<=0?o:n),r=15,P=85,T=x>u?1:-1;(i<r&&x<u||i>P&&x>u||i<0&&T>0&&n<0)&&I(T),u=x}return v.loadMore=function(c,d,x){if(g)return;g=!0;const o={method:c,data:d};f.fire("action:infinitescroll.loadmore",o),socket.emit(o.method,o.data,function(n,l){if(n)return g=!1,h.error(n);x(l,function(){g=!1})})},v.loadMoreXhr=function(c,d){if(g)return;g=!0;const x=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),o={url:x,data:c};f.fire("action:infinitescroll.loadmore.xhr",o),$.get(x,c,function(n){d(n,function(){g=!1})}).fail(function(n){g=!1,h.error(String(n.responseJSON||"[[error:no-connection]]"))})},v.removeExtra=function(c,d,x){let o=$();if(c.length<=x)return o;const n=c.length-x;if(d>0){const l=$(document).height(),i=$(window).scrollTop();o=c.slice(0,n).remove(),$(window).scrollTop(i+($(document).height()-l))}else o=c.slice(c.length-n).remove();return o},v}.apply(b,C),A!==void 0&&(B.exports=A)},47720:(B,b)=>{var s,C;s=[],C=function(){const A={},f=/-resized(\.[\w]+)?$/;return A.wrapImagesInLinks=function(h){h.find('[component="post/content"] img:not(.emoji)').each(function(){A.wrapImageInLink($(this))})},A.wrapImageInLink=function(h){let v=h.attr("src")||"";if(v!=="about:blank"&&!h.parent().is("a")){utils.isRelativeUrl(v)&&f.test(v)&&(v=v.replace(f,"$1"));const I=h.attr("alt")||"",u=v.split(".").slice(1).pop(),g=I.split("/").pop(),D=g.split(".").slice(1).pop();h.wrap('<a href="'+v+'" '+(!u&&D?' download="'+utils.escapeHTML(g)+'" ':"")+' target="_blank" rel="noopener">')}},A}.apply(b,s),C!==void 0&&(B.exports=C)},60447:(B,b,s)=>{var C,A;C=[s(78989),s(25142),s(54939),s(47720),s(42840),s(7237),s(32230),s(85233),s(59265)],A=function(f,h,v,I,u,g,D,E,w){const a={};a.signaturesShown={};const c=$(window);a.onNewPost=function(t){!t||!t.posts||!t.posts.length||parseInt(t.posts[0].tid,10)!==parseInt(ajaxify.data.tid,10)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),a.modifyPostsByPrivileges(t.posts),x(t.posts),d(t.posts[0]),o(t.posts),ajaxify.data.postcount+=1,v.updatePostCount(ajaxify.data.postcount),config.usePagination?n(t):i(t),s.e(21352).then(function(){var e=[s(21352)];(function(p){p.onNewPost(t)}).apply(null,e)}).catch(s.oe))};function d(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}a.modifyPostsByPrivileges=function(t){t.forEach(function(e){e.selfPost=!!app.user.uid&&parseInt(e.uid,10)===parseInt(app.user.uid,10),e.topicOwnerPost=parseInt(e.uid,10)===parseInt(ajaxify.data.uid,10),e.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&e.selfPost||ajaxify.data.privileges.isAdminOrMod,e.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&e.selfPost||ajaxify.data.privileges.isAdminOrMod,e.display_moderator_tools=e.display_edit_tools||e.display_delete_tools,e.display_move_tools=ajaxify.data.privileges.isAdminOrMod,e.display_post_menu=ajaxify.data.privileges.isAdminOrMod||e.selfPost&&!ajaxify.data.locked&&!e.deleted||e.selfPost&&e.deleted&&parseInt(e.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!e.deleted})};function x(t){for(let e=0;e<t.length;e+=1){const p=g.get("user/postcount",t[e].uid);p.html(w.formattedNumber(parseInt(p.attr("data-postcount"),10)+1))}}function o(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,g.get("post").not("[data-index=0]").each(function(){const e=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",e)}))}function n(t){function e(){r(t.posts[0])}const p=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(p[0].topic.postcount/config.postsPerPage));const m=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&m===1||ajaxify.data.pagination.currentPage===1&&m===-1){const M=$('[component="post"]:not([data-index=0]), [component="topic/event"]');P(t,M,m,!1,e)}else ajaxify.data.scrollToMyPost&&parseInt(p[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){f.loadPage(ajaxify.data.pagination.pageCount,e)},250):l()}function l(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(e){$('[component="pagination"]').after(e).remove()})})}function i(t){const e=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,p=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!p&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!p&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const m=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');P(t,m,e,!1,function(y){y&&y.addClass("new"),r(t.posts[0])})}function r(t){t.selfPost&&ajaxify.data.scrollToMyPost&&u.scrollBottom(t.index)}function P(t,e,p,m,y){if(y=y||function(){},!t||t.posts&&!t.posts.length)return y();function M(){const j=$('[component="post"].new');if(j.length===t.posts.length){let R=!0;if(j.each(function(S,N){parseInt($(N).attr("data-pid"),10)!==parseInt(t.posts[S].pid,10)&&(R=!1)}),R){j.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}j.length&&t.posts.length>1&&t.posts.forEach(function(R){const S=g.get("post","pid",R.pid);S.hasClass("new")&&S.remove()}),t.posts=t.posts.filter(function(R){return R.index===-1||$('[component="post"][data-pid="'+R.pid+'"]').length===0})}if(M(),!t.posts.length)return y();let k,L;p>0&&e.length?k=e.last():p<0&&e.length&&(L=e.first()),E.fire("action:posts.loading",{posts:t.posts,after:k,before:L}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(j){j=j.filter(function(){const S=$(this),N=S.attr("data-pid"),K=parseInt(S.attr("data-index"),10);return!S.is('[component="post"]')||K===-1||N&&$('[component="post"][data-pid="'+N+'"]').length===0});const R=h.removeExtra($('[component="post"]'),p,Math.max(20,config.postsPerPage*2));if(k)j.insertAfter(k);else if(L){const S=$(document).height(),N=c.scrollTop();j.insertBefore(L),(m||N>0)&&c.scrollTop(N+($(document).height()-S))}else g.get("topic").append(j);await a.onNewPostsAddedToDom(j),F(R),E.fire("action:posts.loaded",{posts:t.posts}),y(j)})}a.loadMorePosts=function(t){if(!g.get("topic").length||u.scrollActive)return;const e=g.get("topic").find(g.get("post").not("[data-index=0]").not(".new")),p=t>0?e.last():e.first(),m=parseInt(p.attr("data-index"),10)||0,y=ajaxify.data.tid;if(!utils.isNumber(y)||!utils.isNumber(m)||t<0&&g.get("post","index",0).length)return;const M=$(".loading-indicator");M.is(":animated")||M.fadeIn(),h.loadMore("topics.loadMore",{tid:y,after:m+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(k,L){if(M.fadeOut(),k&&k.posts&&k.posts.length){const j=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');P(k,j,t,!0,L)}else u.update(),L()})},a.onTopicPageLoad=async function(t){O(t),I.wrapImagesInLinks(t),W(t),a.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),a.addBlockquoteEllipses(t),U(t),await T()},a.addTopicEvents=function(t){if(config.topicPostSort==="most_votes")return;const e=t[0];app.parseAndTranslate("partials/topic/event",e).then(function(p){if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(p);else if(config.topicPostSort==="newest_to_oldest"){const m=$('[component="topic"] [component="post"][data-index="0"]');m.length?$(p).insertAfter(m):$('[component="topic"]').prepend(p)}$('[component="topic/event"] .timeago').timeago()})};async function T(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const e=c.scrollTop(),p=$('[component="post"]').toArray();await Promise.all(p.map(async function(m){m=$(m);const y=m.prev('[component="post"]');if(m.is(":has(.necro-post)")||!y.length||config.topicPostSort==="newest_to_oldest"&&parseInt(y.attr("data-index"),10)===0)return;const M=m.attr("data-timestamp")-y.attr("data-timestamp");if(Math.abs(M)>=t){const k=$.timeago.settings.strings.suffixAgo,L=$.timeago.settings.strings.prefixAgo,j=$.timeago.settings.strings.suffixFromNow,R=$.timeago.settings.strings.prefixFromNow;$.timeago.settings.strings.suffixAgo="",$.timeago.settings.strings.prefixAgo="",$.timeago.settings.strings.suffixFromNow="",$.timeago.settings.strings.prefixFromNow="";const S=(M>0?"[[topic:timeago_later,":"[[topic:timeago_earlier,")+$.timeago.inWords(M)+"]]";$.timeago.settings.strings.suffixAgo=k,$.timeago.settings.strings.prefixAgo=L,$.timeago.settings.strings.suffixFromNow=j,$.timeago.settings.strings.prefixFromNow=R;const N=await app.parseAndTranslate("partials/topic/necro-post",{text:S});N.attr("data-necro-post-index",y.attr("data-index")),N.insertBefore(m)}})),e>0&&c.scrollTop()<e&&c.scrollTop(e)}function W(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((e,p)=>{const m=$(p).find('[component="post/signature"]'),y=m.attr("data-uid");a.signaturesShown[y]?m.addClass("hidden"):a.signaturesShown[y]=!0})}function F(t){t.each((e,p)=>{$(`[data-necro-post-index="${$(p).attr("data-index")}"]`).remove()})}function O(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const e=document.createElement("a");e.className="login-required",e.href=config.relative_path+"/login",D.translate("[[topic:login-to-view]]",function(p){e.appendChild(document.createTextNode(p)),t.each(function(m,y){$(y).find('[component="post/content"] img').each(function(M,k){k=$(k),k.attr("src").startsWith(config.relative_path+config.upload_url)&&k.replaceWith(e.cloneNode(!0))})})})}a.onNewPostsAddedToDom=async function(t){await a.onTopicPageLoad(t),t.find(".timeago").timeago()},a.showBottomPostBar=function(){const t=g.get("post","index",0),e=$(".post-bar-placeholder"),p=$('[component="post"]');t.length&&p.length>1&&$(".post-bar").length<2&&e.length?($(".post-bar").clone().insertAfter(e),e.remove()):t.length&&p.length<2&&t.find(".post-bar").remove()};function U(t){t.each(function(){$(this).hasClass("deleted")&&v.toggle($(this).attr("data-pid"),!0)})}return a.addBlockquoteEllipses=function(t){t.find('[component="post/content"] > blockquote > blockquote').each(function(){const p=$(this);p.find(":hidden:not(br)").length&&!p.find(".toggle").length&&p.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},a}.apply(b,C),A!==void 0&&(B.exports=A)},60392:(B,b,s)=>{var C,A;C=[s(7237),s(32230),s(66044),s(60447),s(74344),s(85233),s(63281),s(7927),s(73138)],A=function(f,h,v,I,u,g,D,E,w){const a={};a.init=function(o,n){c(n),$(".topic-main-buttons [title]").tooltip({container:"#content",animation:!1}),a.observeTopicLabels($('[component="topic/labels"]')),n.on("click",'[component="topic/delete"]',function(){return d("del","/state","delete"),!1}),n.on("click",'[component="topic/restore"]',function(){return d("put","/state","restore"),!1}),n.on("click",'[component="topic/purge"]',function(){return d("del","","purge"),!1}),n.on("click",'[component="topic/lock"]',function(){return d("put","/lock","lock"),!1}),n.on("click",'[component="topic/unlock"]',function(){return d("del","/lock","unlock"),!1}),n.on("click",'[component="topic/pin"]',function(){return d("put","/pin","pin"),!1}),n.on("click",'[component="topic/unpin"]',function(){return d("del","/pin","unpin"),!1}),n.on("click",'[component="topic/mark-unread"]',function(){d("del","/read",void 0,()=>{app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,function(){v.onBackClicked(!0)}):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,v.onBackClicked),E.success("[[topic:mark_unread.success]]")})}),n.on("click",'[component="topic/mark-unread-for-all"]',function(){const i=$(this);d("put","/bump",void 0,()=>{E.success("[[topic:markAsUnreadForAll.success]]"),i.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")})}),n.on("click",'[component="topic/event/delete"]',function(){const i=$(this).attr("data-topic-event-id"),r=$(this).parents('[component="topic/event"]');D.confirm("[[topic:delete-event-confirm]]",P=>{P&&u.del(`/topics/${o}/events/${i}`,{}).then(function(){r.remove()}).catch(E.error)})}),n.on("click",'[component="topic/move"]',function(){return s.e(17434).then(function(){var i=[s(57378)];(function(r){r.init([o],ajaxify.data.cid)}).apply(null,i)}).catch(s.oe),!1}),n.on("click",'[component="topic/delete/posts"]',function(){s.e(55253).then(function(){var i=[s(55253)];(function(r){r.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/fork"]',function(){s.e(20670).then(function(){var i=[s(25636)];(function(r){r.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/merge"]',function(){s.e(90028).then(function(){var i=[s(90028)];(function(r){r.init(function(){r.addTopic(ajaxify.data.tid)})}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/tag"]',function(){s.e(62516).then(function(){var i=[s(62516)];(function(r){r.init([ajaxify.data],ajaxify.data.tagWhitelist)}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/move-posts"]',function(){s.e(53094).then(function(){var i=[s(53094)];(function(r){r.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/following"]',function(){l("follow")}),n.on("click",'[component="topic/not-following"]',function(){l("follow",0)}),n.on("click",'[component="topic/ignoring"]',function(){l("ignore")});function l(i,r=1){return u[r?"put":"del"](`/topics/${o}/${i}`,{},()=>{let T="";i==="follow"?T=r?"[[topic:following_topic.message]]":"[[topic:not_following_topic.message]]":i==="ignore"&&(T=r?"[[topic:ignoring_topic.message]]":"[[topic:not_following_topic.message]]"),r||(i="unfollow"),x(i),E.alert({alert_id:"follow_thread",message:T,type:"success",timeout:5e3}),g.fire("action:topics.changeWatching",{tid:o,type:i})},()=>{E.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})}),!1}},a.observeTopicLabels=function(o){const n=new MutationObserver(function(l){const i=l[0];if(i&&i.attributeName==="class"){const r=o.children().filter((P,T)=>!$(T).hasClass("hidden"));o.toggleClass("hidden",!r.length)}});o.children().each((l,i)=>{n.observe(i,{attributes:!0})})};function c(o){o=o.get(0),o&&o.querySelectorAll(".thread-tools").forEach(n=>{n.addEventListener("show.bs.dropdown",l=>{const i=l.target.nextElementSibling;i&&socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},function(r,P){if(r)return E.error(r);app.parseAndTranslate("partials/topic/topic-menu-list",P,function(T){$(i).html(T),g.fire("action:topic.tools.load",{element:$(i)})})})},{once:!0})})}function d(o,n,l,i){i||(i=function(){});const r=ajaxify.data.tid,P={},T=function(W){W&&u[o](`/topics/${r}${n}`,P).then(i).catch(E.error)};switch(l){case"delete":case"restore":case"purge":D.confirm(`[[topic:thread_tools.${l}_confirm]]`,T);break;case"pin":a.requestPinExpiry(P,T.bind(null,!0));break;default:T(!0);break}}a.requestPinExpiry=function(o,n){app.parseAndTranslate("modals/set-pin-expiry",{},function(l){const i=D.dialog({title:"[[topic:thread_tools.pin]]",message:l,onEscape:!0,size:"small",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){let P=i.get(0).querySelector("#expiry").value;if(P==="")return n();P=new Date(P),P&&P.getTime()>Date.now()?(o.expiry=P.getTime(),n()):E.error("[[error:invalid-date]]")}}}})})},a.setLockedState=function(o){const n=f.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;const l=o.isLocked&&!ajaxify.data.privileges.isAdminOrMod;f.get("topic/lock").toggleClass("hidden",o.isLocked).parent().attr("hidden",o.isLocked?"":null),f.get("topic/unlock").toggleClass("hidden",!o.isLocked).parent().attr("hidden",o.isLocked?null:"");const i=!!((o.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod);f.get("topic/reply/container").toggleClass("hidden",i),f.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!o.isLocked||ajaxify.data.deleted),n.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",i),n.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",l),n.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",l),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!o.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=o.isLocked,I.addTopicEvents(o.events)},a.setDeleteState=function(o){const n=f.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;f.get("topic/delete").toggleClass("hidden",o.isDelete).parent().attr("hidden",o.isDelete?"":null),f.get("topic/restore").toggleClass("hidden",!o.isDelete).parent().attr("hidden",o.isDelete?null:""),f.get("topic/purge").toggleClass("hidden",!o.isDelete).parent().attr("hidden",o.isDelete?null:""),f.get("topic/deleted/message").toggleClass("hidden",!o.isDelete),o.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:o.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},function(i){f.get("topic/deleted/message").replaceWith(i),i.find(".timeago").timeago()});const l=o.isDelete&&!ajaxify.data.privileges.isAdminOrMod;f.get("topic/reply/container").toggleClass("hidden",l),f.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||o.isDelete),n.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",l),n.toggleClass("deleted",o.isDelete),ajaxify.data.deleted=o.isDelete?1:0,I.addTopicEvents(o.events)},a.setPinnedState=function(o){const n=f.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;f.get("topic/pin").toggleClass("hidden",o.pinned).parent().attr("hidden",o.pinned?"":null),f.get("topic/unpin").toggleClass("hidden",!o.pinned).parent().attr("hidden",o.pinned?null:"");const l=$('[component="topic/labels"] [component="topic/pinned"]');l.toggleClass("hidden",!o.pinned),o.pinned&&l.translateAttr("title",o.pinExpiry&&o.pinExpiryISO?"[[topic:pinned-with-expiry, "+o.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=o.pinned,I.addTopicEvents(o.events)};function x(o){const n={follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"};h.translate(n[o],function(i){const r=w.Tooltip.getInstance('[component="topic/watch"]');r&&r.setContent({".tooltip-inner":i})});let l=f.get("topic/following/menu");l.toggleClass("hidden",o!=="follow"),f.get("topic/following/check").toggleClass("fa-check",o==="follow"),l=f.get("topic/not-following/menu"),l.toggleClass("hidden",o!=="unfollow"),f.get("topic/not-following/check").toggleClass("fa-check",o==="unfollow"),l=f.get("topic/ignoring/menu"),l.toggleClass("hidden",o!=="ignore"),f.get("topic/ignoring/check").toggleClass("fa-check",o==="ignore")}return a}.apply(b,C),A!==void 0&&(B.exports=A)},66044:(B,b,s)=>{var C,A;C=[s(7237),s(66603),s(42840),s(78989)],A=function(f,h,v,I){const u={};let g;u.init=function(w){g=w,D(),$(window).off("action:popstate",E).on("action:popstate",E)},u.onBackClicked=E;function D(){$('[component="category"]').on("click",'[component="topic/header"]',function(){const w=$(this).parents("[data-index]").attr("data-index"),a=$(window).scrollTop();$('[component="category/topic"]').each(function(c,d){if($(d).offset().top-a>0)return h.setItem("category:bookmark",$(d).attr("data-index")),h.setItem("category:bookmark:clicked",w),h.setItem("category:bookmark:offset",$(d).offset().top-a),!1})})}function E(w){const a=w&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||a){let c=h.getItem("category:bookmark"),d=h.getItem("category:bookmark:clicked");if(h.removeItem("category:bookmark"),h.removeItem("category:bookmark:clicked"),!utils.isNumber(c))return;if(c=Math.max(0,parseInt(c,10)||0),d=Math.max(0,parseInt(d,10)||0),config.usePagination){const x=Math.ceil((parseInt(c,10)+1)/config.topicsPerPage);parseInt(x,10)!==ajaxify.data.pagination.currentPage?I.loadPage(x,function(){u.scrollToTopic(c,d)}):u.scrollToTopic(c,d)}else{if(c===0){u.scrollToTopic(c,d);return}$('[component="category"]').empty(),g(Math.max(0,c-1)+1,function(){u.scrollToTopic(c,d)})}}}return u.highlightTopic=function(w){const a=f.get("category/topic","index",w);a.length&&!a.hasClass("highlight")&&(a.addClass("highlight"),setTimeout(function(){a.removeClass("highlight")},5e3))},u.scrollToTopic=function(w,a){if(!utils.isNumber(w))return;const c=f.get("category/topic","index",w);if(c.length){const d=h.getItem("category:bookmark:offset");h.removeItem("category:bookmark:offset"),$(window).scrollTop(c.offset().top-d),u.highlightTopic(a),v.update()}},u}.apply(b,C),A!==void 0&&(B.exports=A)}}]);
