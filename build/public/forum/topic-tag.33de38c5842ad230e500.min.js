"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[73579,70565,83014,28253,99617,74344,62516,86193],{62516:(P,x,f)=>{var y,E;y=[f(7927),f(86193),f(74344),f(59006)],E=function(A,_,p,m){const h={};let o,a,c,s;h.init=function(n,e,i){o||(c=n,s=e||[],app.parseAndTranslate("modals/tag-topic",{topics:c,tagWhitelist:s},function(l){o=l,a=o.find("#tag-topic-commit"),$("body").append(o),o.find("#tag-topic-cancel").on("click",t),a.on("click",async()=>{await r(),i&&i()}),o.find(".tags").each((d,T)=>{const g=$(T),O=g.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),D=O[0].$input;c[d].tags.forEach(v=>g.tagsinput("add",v.value)),g.on("itemAdded",function(v){s.length&&!s.includes(v.item)&&(g.tagsinput("remove",v.item),A.error("[[error:tag-not-allowed]]")),D.length&&D.autocomplete("close")}),u({input:D,container:O[0].$container})})}))};function u(n){_.init({input:n.input,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:n.container,source:async(e,i)=>{socket.emit("topics.autocompleteTags",{query:e.term},function(l,d){if(l)return A.error(l);d&&i(d)})}})}async function r(){await Promise.all(o.find(".tags").map(async(n,e)=>{const i=c[n],l=$(e);i.tags=await p.put(`/topics/${i.tid}/tags`,{tags:l.tagsinput("items")}),h.updateTopicTags([i])})),t()}h.updateTopicTags=function(n){n.forEach(e=>{const i=ajaxify.data.template.topic?"partials/topic/tags":"partials/category/tags";m.render(i,{tags:e.tags}).then(function(l){const d=$(`[data-tid="${e.tid}"][component="topic/tags"]`);d.fadeOut(250,function(){d.toggleClass("hidden",e.tags.length===0),d.html(l).fadeIn(250)})})})};function t(){o&&(o.remove(),o=null)}return h}.apply(x,y),E!==void 0&&(P.exports=E)},74344:(P,x,f)=>{f.r(x),f.d(x,{del:()=>r,get:()=>o,head:()=>a,patch:()=>s,post:()=>c,put:()=>u});var y=f(85233),E=f.n(y),A=f(63281),_=f.n(A);const p=config.relative_path+"/api/v3";function m(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:p+t.url,typeof n=="function"){h(t,n);return}return new Promise((e,i)=>{h(t,function(l,d){if(l)return l.message==="A valid login session was not found. Please log in and try again."?(0,A.confirm)("[[error:api.reauth-required]]",T=>{T&&ajaxify.go("login")}):i(l);e(d)})})}async function h(t,n){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,y.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const i=await fetch(e,t),{headers:l}=i,d=l.get("content-type"),T=d&&d.startsWith("application/json");let g;if(T?g=await i.json():g=await i.text(),!i.ok)return n(new Error(T?g.status.message:g));n(null,T&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g)}function o(t,n,e){return m({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function a(t,n,e){return m({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},e)}function c(t,n,e){return m({url:t,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function s(t,n,e){return m({url:t,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function u(t,n,e){return m({url:t,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function r(t,n,e){return m({url:t,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},86193:(P,x,f)=>{var y,E;y=[f(74344),f(7927)],E=function(A,_){const p={},m={delay:200,appendTo:null};p.init=o=>{const a={...m,...o},{input:c,onSelect:s}=a;app.loadJQueryUI(function(){c.autocomplete({...a,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(u,r){h(c,s,u,r)}})})},p.user=function(o,a,c){typeof a=="function"&&(c=a,a={}),a=a||{},p.init({input:o,onSelect:c,source:(s,u)=>{a.query=s.term,A.get("/api/users",a,function(r,t){if(r)return _.error(r);if(t&&t.users){const n=t.users.map(function(e){const i=$("<div></div>").html(e.username).text();return e&&{label:i,value:i,user:{uid:e.uid,name:e.username,slug:e.userslug,username:e.username,userslug:e.userslug,picture:e.picture,banned:e.banned,"icon:text":e["icon:text"],"icon:bgColor":e["icon:bgColor"]}}});u(n)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},p.group=function(o,a){p.init({input:o,onSelect:a,source:(c,s)=>{socket.emit("groups.search",{query:c.term},function(u,r){if(u)return _.error(u);if(r&&r.length){const t=r.map(function(n){return n&&{label:n.name,value:n.name,group:n}});s(t)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},p.tag=function(o,a){p.init({input:o,onSelect:a,delay:100,source:(c,s)=>{socket.emit("topics.autocompleteTags",{query:c.term,cid:ajaxify.data.cid||0},function(u,r){if(u)return _.error(u);r&&s(r),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function h(o,a,c,s){a=a||function(){};const u=jQuery.Event("keypress");u.which=13,u.keyCode=13,setTimeout(function(){o.trigger(u)},100),a(c,s)}return p}.apply(x,y),E!==void 0&&(P.exports=E)}}]);
