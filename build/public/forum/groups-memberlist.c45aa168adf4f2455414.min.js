"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[61762,70565,83014,99617,74344],{24987:(k,p,u)=>{var f,h;f=[u(74344),u(63281),u(7927)],h=function(m,x,d){const c={};let l,g;c.init=function(e){g=e||"groups/details",l=ajaxify.data.group.name,b(),E(),A()};function b(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(e){const o=[],n=x.dialog({title:"[[groups:details.add-member]]",message:e,buttons:{OK:{label:"[[groups:details.add-member]]",callback:function(){const s=[];n.find("[data-uid][data-selected]").each(function(a,i){s.push(o[$(i).attr("data-uid")])}),y(s,function(){n.modal("hide")})}}}});n.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),n.find("input").on("keyup",function(){m.get("/api/users",{query:$(this).val(),paginate:!1},function(s,a){if(s)return d.error(s);a.users.forEach(function(i){o[i.uid]=i}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:a.users},function(i){n.find("#search-result").html(i)})})})})})}function y(e,o){function n(){e=e.filter(function(a){return!$('[component="groups/members"] [data-uid="'+a.uid+'"]').length}),r(e,function(a){$('[component="groups/members"] tbody').prepend(a)}),o()}const s=e.map(function(a){return a.uid});l==="administrators"?socket.emit("admin.user.makeAdmins",s,function(a){if(a)return d.error(a);n()}):Promise.all(s.map(a=>m.put("/groups/"+ajaxify.data.group.slug+"/membership/"+a))).then(n).catch(d.error)}function E(){const e=$('[component="groups/members/search"]');e.on("keyup",utils.debounce(function(){const o=e.val();socket.emit("groups.searchMembers",{groupName:l,query:o},function(n,s){if(n)return d.error(n);r(s.users,function(a){$('[component="groups/members"] tbody').html(a),$('[component="groups/members"]').attr("data-nextstart",20)})})},250))}function A(){$('[component="groups/members"]').on("scroll",function(){const e=$(this),o=(e[0].scrollHeight-e.innerHeight())*.9;e.scrollTop()>o&&!$('[component="groups/members/search"]').val()&&M()})}function M(){const e=$('[component="groups/members"]');e.attr("loading")||(e.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:l,after:e.attr("data-nextstart")},function(o,n){if(o)return d.error(o);n&&n.users.length?t(n.users,function(){e.removeAttr("loading"),e.attr("data-nextstart",n.nextStart)}):e.removeAttr("loading")}))}function t(e,o){e=e.filter(function(n){return!$('[component="groups/members"] [data-uid="'+n.uid+'"]').length}),r(e,function(n){$('[component="groups/members"] tbody').append(n),o()})}function r(e,o){app.parseAndTranslate(g,"group.members",{group:{members:e,isOwner:ajaxify.data.group.isOwner}},o)}return c}.apply(p,f),h!==void 0&&(k.exports=h)},74344:(k,p,u)=>{u.r(p),u.d(p,{del:()=>M,get:()=>g,head:()=>b,patch:()=>E,post:()=>y,put:()=>A});var f=u(85233),h=u.n(f),m=u(63281),x=u.n(m);const d=config.relative_path+"/api/v3";function c(t,r){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:d+t.url,typeof r=="function"){l(t,r);return}return new Promise((e,o)=>{l(t,function(n,s){if(n)return n.message==="A valid login session was not found. Please log in and try again."?(0,m.confirm)("[[error:api.reauth-required]]",a=>{a&&ajaxify.go("login")}):o(n);e(s)})})}async function l(t,r){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,f.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const o=await fetch(e,t),{headers:n}=o,s=n.get("content-type"),a=s&&s.startsWith("application/json");let i;if(a?i=await o.json():i=await o.text(),!o.ok)return r(new Error(a?i.status.message:i));r(null,a&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i)}function g(t,r,e){return c({url:t+(r&&Object.keys(r).length?"?"+$.param(r):"")},e)}function b(t,r,e){return c({url:t+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"head"},e)}function y(t,r,e){return c({url:t,method:"post",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function E(t,r,e){return c({url:t,method:"patch",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function A(t,r,e){return c({url:t,method:"put",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}function M(t,r,e){return c({url:t,method:"delete",data:r,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
