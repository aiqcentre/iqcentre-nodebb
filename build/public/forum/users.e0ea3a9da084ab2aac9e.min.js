"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[70981,70565,22852,83014,99617,74344],{64819:(D,E,a)=>{var f,d;f=[a(59006),a(74344),a(7927),a(23884)],d=function(m,P,A,r){const i={};let u=0;i.init=function(){app.enterRoom("user_list");const e=utils.param("section")?"?section="+utils.param("section"):"",n=$('[component="user/list/menu"]');n.find("a").removeClass("active"),n.find('a[href="'+window.location.pathname+e+'"]').addClass("active"),i.handleSearch(),r.handle(),socket.removeListener("event:user_status_change",y),socket.on("event:user_status_change",y)},i.handleSearch=function(e){u=e&&e.resultCount,$("#search-user").on("keyup",utils.debounce(h,250)),$('.search select, .search input[type="checkbox"]').on("change",h)};function h(){if(!ajaxify.data.template.users)return;$('[component="user/search/icon"]').removeClass("fa-search").addClass("fa-spinner fa-spin");const e=$("#search-user").val(),n=s(),o={section:n,page:1};if(!e)return c(o);o.query=e,o.sortBy=g();const l=[];($(".search .online-only").is(":checked")||n==="online")&&l.push("online"),n==="banned"&&l.push("banned"),n==="flagged"&&l.push("flagged"),l.length&&(o.filters=l),c(o)}function g(){let e;const n=s();return n==="sort-posts"?e="postcount":n==="sort-reputation"?e="reputation":n==="users"&&(e="joindate"),e}function c(e){P.get("/api/users",e).then(v).catch(A.error)}function v(e){m.render("partials/paginator",{pagination:e.pagination}).then(function(n){$(".pagination-container").replaceWith(n)}),u&&(e.users=e.users.slice(0,u)),e.isAdminOrGlobalMod=app.user.isAdmin||app.user.isGlobalMod,app.parseAndTranslate("users","users",e,function(n){$("#users-container").html(n),n.find(".timeago").timeago(),$('[component="user/search/icon"]').addClass("fa-search").removeClass("fa-spinner fa-spin")})}function y(e){const n=s();(n.startsWith("online")||n.startsWith("users"))&&t(e)}function t(e){app.updateUserStatus($('#users-container [data-uid="'+e.uid+'"] [component="user/status"]'),e.status)}function s(){return utils.param("section")||""}return i}.apply(E,f),d!==void 0&&(D.exports=d)},23884:(D,E,a)=>{var f,d;f=[a(74344),a(59006),a(63281),a(7927)],d=function(m,P,A,r){const i={};function u(){return ajaxify.data.template.name.startsWith("admin/")}return i.handle=function(){$('[component="user/invite"]').on("click",function(h){h.preventDefault(),m.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(g=>{P.parse("modals/invite",{groups:g},function(c){A.dialog({message:c,title:`[[${u()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${u()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${u()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:i.send}}})})}).catch(r.error)})},i.send=function(){const h=$("#invite-modal-emails"),g=$("#invite-modal-groups"),c={emails:h.val().split(",").map(v=>v.trim()).filter(Boolean).filter((v,y,t)=>y===t.indexOf(v)).join(","),groupsToJoin:g.val()};c.emails&&m.post(`/users/${app.user.uid}/invites`,c).then(()=>{r.success(`[[${u()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${c.emails.replace(/,/g,"&#44; ")}]]`)}).catch(r.error)},i}.apply(E,f),d!==void 0&&(D.exports=d)},74344:(D,E,a)=>{a.r(E),a.d(E,{del:()=>y,get:()=>u,head:()=>h,patch:()=>c,post:()=>g,put:()=>v});var f=a(85233),d=a.n(f),m=a(63281),P=a.n(m);const A=config.relative_path+"/api/v3";function r(t,s){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:A+t.url,typeof s=="function"){i(t,s);return}return new Promise((e,n)=>{i(t,function(o,l){if(o)return o.message==="A valid login session was not found. Please log in and try again."?(0,m.confirm)("[[error:api.reauth-required]]",C=>{C&&ajaxify.go("login")}):n(o);e(l)})})}async function i(t,s){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,f.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(e,t),{headers:o}=n,l=o.get("content-type"),C=l&&l.startsWith("application/json");let p;if(C?p=await n.json():p=await n.text(),!n.ok)return s(new Error(C?p.status.message:p));s(null,C&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p)}function u(t,s,e){return r({url:t+(s&&Object.keys(s).length?"?"+$.param(s):"")},e)}function h(t,s,e){return r({url:t+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"head"},e)}function g(t,s,e){return r({url:t,method:"post",data:s,headers:{"x-csrf-token":config.csrf_token}},e)}function c(t,s,e){return r({url:t,method:"patch",data:s,headers:{"x-csrf-token":config.csrf_token}},e)}function v(t,s,e){return r({url:t,method:"put",data:s,headers:{"x-csrf-token":config.csrf_token}},e)}function y(t,s,e){return r({url:t,method:"delete",data:s,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
