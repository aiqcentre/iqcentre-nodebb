"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8798,70565,50232,83014,99617,74344,81018],{81018:(D,g,o)=>{var u,m;u=[o(7927),o(74344),o(93216)],m=function(p,R,P){const s={};s.init=function(){Promise.all([o.e(42441),o.e(61006),o.e(46862),o.e(54271)]).then(function(){var r=[o(30524)];(function(c){$('[component="chat/nav-wrapper"]').on("click",'[component="chat/recent/room"], [component="chat/public/room"]',function(e){e.stopPropagation(),e.preventDefault();const f=this.getAttribute("data-roomid");c.switchChat(f)}).on("click",".mark-read",function(e){e.stopPropagation();const f=this.closest("[data-roomid]");P.toggleReadState(f)}),$('[component="chat/recent"]').on("scroll",utils.debounce(function(){const e=$(this),f=(e[0].scrollHeight-e.height())*.9;e.scrollTop()>f&&E()},100))}).apply(null,r)}).catch(o.oe)};function E(){const r=$('[component="chat/recent"]');r.attr("loading")||(r.attr("loading",1),socket.emit("modules.chats.getRecentChats",{uid:ajaxify.data.uid,after:r.attr("data-nextstart")},function(c,e){if(c)return p.error(c);e&&e.rooms.length?y(e,function(){r.removeAttr("loading"),r.attr("data-nextstart",e.nextStart)}):r.removeAttr("loading")}))}function y(r,c){if(!r.rooms.length)return c();r.loadingMore=!0,app.parseAndTranslate("chats","rooms",r,function(e){$('[component="chat/recent"]').append(e),e.find(".timeago").timeago(),c()})}return s}.apply(g,u),m!==void 0&&(D.exports=m)},74344:(D,g,o)=>{o.r(g),o.d(g,{del:()=>v,get:()=>y,head:()=>r,patch:()=>e,post:()=>c,put:()=>f});var u=o(85233),m=o.n(u),p=o(63281),R=o.n(p);const P=config.relative_path+"/api/v3";function s(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:P+t.url,typeof n=="function"){E(t,n);return}return new Promise((a,l)=>{E(t,function(h,A){if(h)return h.message==="A valid login session was not found. Please log in and try again."?(0,p.confirm)("[[error:api.reauth-required]]",d=>{d&&ajaxify.go("login")}):l(h);a(A)})})}async function E(t,n){const{url:a}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,u.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const l=await fetch(a,t),{headers:h}=l,A=h.get("content-type"),d=A&&A.startsWith("application/json");let i;if(d?i=await l.json():i=await l.text(),!l.ok)return n(new Error(d?i.status.message:i));n(null,d&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i)}function y(t,n,a){return s({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},a)}function r(t,n,a){return s({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},a)}function c(t,n,a){return s({url:t,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}function e(t,n,a){return s({url:t,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}function f(t,n,a){return s({url:t,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}function v(t,n,a){return s({url:t,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}}}]);
