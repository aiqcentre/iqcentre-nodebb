"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[65962,70565,83014,99617,26721,28306,74344,90028],{90028:(_,C,h)=>{var v,p;v=[h(7073),h(7927),h(74344)],p=function(g,m,s){const d={};let c,f,x={};d.init=function(t){t=t||function(){},!c&&app.parseAndTranslate("modals/merge-topic",{},function(i){c=i,$("body").append(c),f=c.find("#merge_topics_confirm"),c.find("#merge_topics_cancel").on("click",e),$("#content").on("click",'[component="topic/select"]',k),a(),f.on("click",function(){n(f)}),g.enableQuickSearch({searchElements:{inputEl:c.find(".topic-search-input"),resultEl:c.find(".quick-search-container")},searchOptions:{in:"titles"}}),c.on("click","[data-tid]",function(){return $(this).attr("data-tid")&&d.addTopic($(this).attr("data-tid")),!1}),t()})},d.addTopic=function(t,i){i=i||function(){},s.get(`/topics/${t}`,{}).then(function(o){const l=o?o.title:"No title";x[t]?delete x[t]:x[t]=l,r(),a(),i()}).catch(m.error)};function k(t){if(!c)return;const i=$(this).parents('[component="category/topic"]').attr("data-tid");return d.addTopic(i),t.preventDefault(),t.stopPropagation(),!1}function n(t){t.attr("disabled",!0);const i=Object.keys(x),o={};c.find(".merge-main-topic-radio").is(":checked")?o.mainTid=c.find(".merge-main-topic-select").val():c.find(".merge-new-title-radio").is(":checked")&&(o.newTopicTitle=c.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:i,options:o},function(l,y){if(t.removeAttr("disabled"),l)return m.error(l);ajaxify.go("/topic/"+y),e()})}function a(){if(!c)return;const t=Object.keys(x);t.sort(function(o,l){return o-l});const i=t.map(function(o){return{tid:o,title:x[o]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:i},function(o){c.find(".topics-section").html(o.find(".topics-section").html()),c.find(".merge-main-topic-select").html(o.find(".merge-main-topic-select").html())}):c.find(".topics-section").translateHtml("[[error:no-topics-selected]]")}function r(){Object.keys(x).length?f.removeAttr("disabled"):f.attr("disabled",!0)}function e(){c&&(c.remove(),c=null),x={},$("#content").off("click",'[component="topic/select"]',k)}return d}.apply(C,v),p!==void 0&&(_.exports=p)},74344:(_,C,h)=>{h.r(C),h.d(C,{del:()=>r,get:()=>f,head:()=>x,patch:()=>n,post:()=>k,put:()=>a});var v=h(85233),p=h.n(v),g=h(63281),m=h.n(g);const s=config.relative_path+"/api/v3";function d(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:s+e.url,typeof t=="function"){c(e,t);return}return new Promise((i,o)=>{c(e,function(l,y){if(l)return l.message==="A valid login session was not found. Please log in and try again."?(0,g.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go("login")}):o(l);i(y)})})}async function c(e,t){const{url:i}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,v.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const o=await fetch(i,e),{headers:l}=o,y=l.get("content-type"),E=y&&y.startsWith("application/json");let u;if(E?u=await o.json():u=await o.text(),!o.ok)return t(new Error(E?u.status.message:u));t(null,E&&u.hasOwnProperty("status")&&u.hasOwnProperty("response")?u.response:u)}function f(e,t,i){return d({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},i)}function x(e,t,i){return d({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},i)}function k(e,t,i){return d({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function n(e,t,i){return d({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function a(e,t,i){return d({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function r(e,t,i){return d({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}},7073:(_,C,h)=>{var v,p;v=[h(32230),h(66603),h(85233),h(7927),h(73138)],p=function(g,m,s,d,c){const f={current:{}};f.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((r,e)=>{x($(e),n)})};function x(n,a){const r=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),i=e.find("#quick-search-container"),o=e.hasClass("hidden");n.find(".advanced-search-link").off("mousedown").on("mousedown",function(){ajaxify.go("/search")}),o&&t.off("blur").on("blur",function(){setTimeout(function(){t.is(":focus")||(e.addClass("hidden"),r.removeClass("hidden"))},200)}),t.off("focus");const l={inputEl:t,resultEl:i};f.enableQuickSearch({searchOptions:a,searchElements:l}),r.off("click").on("click",function(y){return!config.loggedIn&&!app.user.privileges["search:content"]?(d.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(y.stopPropagation(),f.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const y=$(this).find('input[name="query"]'),E=f.getSearchPreferences();return E.term=y.val(),E.in=a.in,s.fire("action:search.submit",{searchOptions:E,searchElements:l}),f.query(E,function(){y.val(""),t.trigger("blur")}),!1})}f.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const a=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),r=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const i=r.find(".filter-category");function o(){ajaxify.data.template.category&&ajaxify.data.cid&&g.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(u){const O=$("<div></div>").html(u).text();i.find(".name").text(O)}),i.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function l(){n.searchOptions=Object.assign({},a),n.searchOptions.term=e.val(),o(),ajaxify.data.template.category&&ajaxify.data.cid&&i.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(r.removeClass("hidden").find(".quick-search-results-container").html(""),r.find(".loading-indicator").removeClass("hidden")),s.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,f.api(n.searchOptions,function(u){if(r.find(".loading-indicator").addClass("hidden"),!u.posts||n.hideOnNoMatches&&!u.posts.length)return r.addClass("hidden").find(".quick-search-results-container").html("");u.posts.forEach(function(O){const w=$("<div>"+O.content+"</div>").text(),b=e.val().toLowerCase().replace(/^in:topic-\d+/,""),S=Math.max(0,w.toLowerCase().indexOf(b)-40);O.snippet=utils.escapeHTML((S>0?"...":"")+w.slice(S,S+80)+(w.length-S>80?"...":""))}),app.parseAndTranslate("partials/quick-search-results",u,function(O){O.length&&O.find(".timeago").timeago(),r.toggleClass("hidden",!O.length||!e.is(":focus")).find(".quick-search-results-container").html(O.length?O:"");const w=r.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");f.highlightMatches(n.searchOptions.term,w),s.fire("action:search.quick.complete",{data:u,options:n})})})}r.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),l()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){r.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return r.addClass("hidden");l()}},500));let y=!1;r.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){r.addClass("hidden")}),y=!0}),e.on("blur",function(){setTimeout(function(){!e.is(":focus")&&!y&&!r.hasClass("hidden")&&r.addClass("hidden")},200)});let E=!1;s.on("action:ajaxify.end",function(){ajaxify.isCold()||(E=!0)}),e.on("focus",function(){y=!1;const u=e.val();t=u,u&&r.find("#quick-search-results").children().length&&(o(),E?(l(),E=!1):r.removeClass("hidden"),e[0].setSelectionRange(u.startsWith("in:topic")?u.indexOf(" ")+1:0,u.length))}),e.off("refresh").on("refresh",function(){l()})},f.showAndFocusInput=function(n){const a=n.parents(".dropdown-menu");if(a.length){const r=a.siblings("[data-bs-toggle]"),e=c.Dropdown.getOrCreateInstance(r[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},f.query=function(n,a){a=a||function(){},ajaxify.go("search?"+k(n),a)},f.api=function(n,a){const r=config.relative_path+"/api/search?"+k(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+k(n);$.get(r,function(t){t.url=e,a(t)})};function k(n){const a=n.in||"titles";let r=n.term.replace(/^[ ?#]*/,"");try{r=encodeURIComponent(r)}catch{return d.error("[[error:invalid-search-term]]")}const e={...n,term:r,in:a};return s.fire("action:search.createQueryString",{query:e,data:n}),decodeURIComponent($.param(e))}return f.getSearchPreferences=function(){try{return JSON.parse(m.getItem("search-preferences")||"{}")}catch{return{}}},f.highlightMatches=function(n,a){if(!n||!a.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const r=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+r+")","gi");a.each(function(){const t=$(this),i=[];t.find("*").each(function(){$(this).after("<!-- "+i.length+" -->"),i.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(o,l){return'<strong class="search-match fw-bold text-decoration-underline">'+l+"</strong>"})),i.forEach(function(o,l){t.html(t.html().replace("<!-- "+l+" -->",function(){return o.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-fluid")},f}.apply(C,v),p!==void 0&&(_.exports=p)},66603:(_,C,h)=>{var v;v=function(){function p(){this._store={},this._keys=[]}p.prototype.isMock=!0,p.prototype.setItem=function(s,d){s=String(s),this._keys.indexOf(s)===-1&&this._keys.push(s),this._store[s]=d},p.prototype.getItem=function(s){return s=String(s),this._keys.indexOf(s)===-1?null:this._store[s]},p.prototype.removeItem=function(s){s=String(s),this._keys=this._keys.filter(function(d){return d!==s}),this._store[s]=null},p.prototype.clear=function(){this._keys=[],this._store={}},p.prototype.key=function(s){return s=parseInt(s,10)||0,this._keys[s]},Object.defineProperty&&Object.defineProperty(p.prototype,"length",{get:function(){return this._keys.length}});let g;const m=Date.now().toString();try{if(g=window.localStorage,g.setItem(m,m),g.getItem(m)!==m)throw Error("localStorage behaved unexpectedly");return g.removeItem(m),g}catch(s){console.warn(s),console.warn("localStorage failed, falling back on sessionStorage");try{if(g=window.sessionStorage,g.setItem(m,m),g.getItem(m)!==m)throw Error("sessionStorage behaved unexpectedly");return g.removeItem(m),g}catch(d){return console.warn(d),console.warn("sessionStorage failed, falling back on memory storage"),new p}}}.call(C,h,C,_),v!==void 0&&(_.exports=v)}}]);
