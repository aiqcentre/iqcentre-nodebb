(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[19285,84781,54354,43034,3564],{64451:(E,j,o)=>{"use strict";var P,v;P=[o(25142),o(60392),o(54939),o(91748),o(60447),o(42840),o(69241),o(6e4),o(7237),o(66603),o(85233),o(74344),o(7927),o(63281),o(42152)],v=function(m,I,s,b,x,n,p,d,t,i,a,r,y,k,D){const h={};let A=0,R="";$(window).on("action:ajaxify.start",function(l,u){b.removeListeners(),String(u.url).startsWith("topic/")||(n.disable(),t.get("navbar/title").find("span").text("").hide(),y.remove("bookmark"))}),h.init=async function(){const l=!A||parseInt(A,10)!==parseInt(ajaxify.data.tid,10);A=ajaxify.data.tid,R=ajaxify.currentPage,a.fire("action:topic.loading"),app.enterRoom("topic_"+A),l&&(x.signaturesShown={}),await x.onTopicPageLoad(t.get("post")),n.init('[component="post"]',ajaxify.data.postcount,h.toTop,h.toBottom,h.navigatorCallback),s.init(A),I.init(A,$(".topic")),b.init(),p.handleSort("topicPostSort","topic/"+ajaxify.data.slug),config.usePagination||m.init($('[component="topic"]'),x.loadMorePosts),g(),w(),N(),K(),Y(),Q(),B(),H(A),e(),$(window).on("scroll",utils.debounce(F,250)),W(),a.fire("action:topic.loaded",ajaxify.data)};function W(){Promise.resolve().then(function(){var l=[o(42441)];(u=>{config.topicSearchEnabled&&Promise.resolve().then(function(){var c=[o(7073)];(function(f){u.bind(["command+f","ctrl+f"],function(C){C.preventDefault();let T=$('[component="navbar"] [component="search/form"]');T.length||(T=$('[component="sidebar/right"] [component="search/form"]')),T.find('[component="search/fields"] input[name="query"]').val("in:topic-"+ajaxify.data.tid+" "),f.showAndFocusInput(T)}),a.onPage("action:ajaxify.cleanup",()=>{u.unbind(["command+f","ctrl+f"])})}).apply(null,c)}).catch(o.oe),u.bind("j",c=>{if(c.target.classList.contains("mousetrap"))return;const f=n.getIndex(),C=n.getCount();f!==C&&n.scrollToIndex(f,!0,0)}),u.bind("k",c=>{if(c.target.classList.contains("mousetrap"))return;const f=n.getIndex();f!==1&&n.scrollToIndex(f-2,!0,0)})}).apply(null,l)}).catch(o.oe)}h.toTop=function(){n.scrollTop(0)},h.toBottom=function(){socket.emit("topics.postcount",ajaxify.data.tid,function(l,u){if(l)return y.error(l);n.scrollBottom(u-1)})};function H(l){if(window.location.hash){const f=$(utils.escapeHTML(window.location.hash));if(f.length){const C=f.parents("[data-pid]");return n.scrollToElement(C,!0,0)}}const u=ajaxify.data.bookmark||i.getItem("topic:"+l+":bookmark"),c=ajaxify.data.postIndex;if(V(c),n.shouldScrollToPost(c))return n.scrollToPostIndex(c-1,!0,0);u&&(!config.usePagination||config.usePagination&&ajaxify.data.pagination.currentPage===1)&&ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&y.alert({alert_id:"bookmark",message:"[[topic:bookmark_instructions]]",timeout:15e3,type:"info",clickfn:function(){n.scrollToIndex(parseInt(u,10),!0)},closefn:function(){i.removeItem("topic:"+l+":bookmark")}})}function e(){const l=document.querySelector('[component="topic/thumb/list"]');l&&l.addEventListener("click",async u=>{const c=u.target.closest("a");if(c){const f=Array.from(c.parentNode.children).indexOf(c);u.preventDefault();const C=ajaxify.data.thumbs.map(S=>({...S}));C.forEach((S,U)=>{S.selected=U===f});const T=await app.parseAndTranslate("modals/topic-thumbs-view",{src:c.href,thumbs:C});k.dialog({size:"lg",onEscape:!0,backdrop:!0,message:T}).on("click",'[component="topic/thumb/select"]',function(){$('[component="topic/thumb/select"]').removeClass("border-primary"),$(this).addClass("border-primary"),$('[component="topic/thumb/current"]').attr("src",$(this).attr("src"))})}})}function g(){t.get("topic").on("click","blockquote .toggle",function(){const l=$(this).parent("blockquote"),u=$(this);l.toggleClass("uncollapsed");const c=!l.hasClass("uncollapsed");u.toggleClass("fa-angle-down",c).toggleClass("fa-angle-up",!c)})}function w(){new D('[component="copy/code/btn"]',{text:function(u){const c=$(u);c.find("i").removeClass("fa-copy").addClass("fa-check"),setTimeout(()=>c.find("i").removeClass("fa-check").addClass("fa-copy"),2e3);const f=c.parent().find("code");if(f.attr("data-lines")){let C="";return f.find(".hljs-ln-code[data-line-number]").each((T,L)=>{C+=$(L).text()+`
`}),C}return f.text()}});function l(){function u(S){return S.scrollHeight>S.clientHeight}function c(S){if(S.length){if(!S[0].scrollHeight)return setTimeout(c,100,S);u(S.get(0))&&S.parent().parent().find('[component="copy/code/btn"]').css({margin:"0.5rem 1.5rem 0 0"})}}let f=$('[component="topic"] [component="post/content"] code:not([data-button-added])');f=f.filter((S,U)=>$(U).text().includes(`
`));const C=$('<div class="hover-parent position-relative"></div>'),T=$('<button component="copy/code/btn" class="hover-visible position-absolute top-0 btn btn-sm btn-outline-secondary" style="right: 0px; margin: 0.5rem 0.5rem 0 0;"><i class="fa fa-fw fa-copy"></i></button>'),L=f.parent();L.wrap(C).parent().append(T),L.parent().find('[component="copy/code/btn"]').translateAttr("title","[[topic:copy-code]]"),L.each((S,U)=>{c($(U).find("code"))}),f.attr("data-button-added",1)}a.registerPage("action:posts.loaded",l),a.registerPage("action:topic.loaded",l),a.registerPage("action:posts.edited",l)}function N(){t.get("topic").on("click",'[component="post/parent"]',function(l){const u=$(this).attr("data-topid"),c=$('[component="topic"]>[component="post"][data-pid="'+u+'"]');if(c.length)return l.preventDefault(),n.scrollToIndex(c.attr("data-index"),!0),!1})}h.applyDropup=function(){const l=this.getBoundingClientRect(),u=this.querySelector(".dropdown-menu"),f=window.getComputedStyle(u).getPropertyValue("height").slice(0,-2),C=document.documentElement.style.getPropertyValue("--panel-offset").slice(0,-2),T=l.top+l.height-f-C>0;this.classList.toggle("dropup",T)};function K(){const u=t.get("topic").find(".dropdown-menu").parent();$(u).on("shown.bs.dropdown",function(){this.querySelector(".dropdown-menu").innerHTML&&h.applyDropup.call(this)}),a.onPage("action:topic.tools.load",({element:c})=>{h.applyDropup.call(c.get(0).parentNode)}),a.onPage("action:post.tools.load",({element:c})=>{h.applyDropup.call(c.get(0).parentNode)})}function Y(){$('[component="topic"]').on("click",'[component="post/reply-count"]',function(){const l=$(this);o.e(21352).then(function(){var u=[o(21352)];(function(c){c.init(l)}).apply(null,u)}).catch(o.oe)})}function Q(){if(!ajaxify.data.showPostPreviewsOnHover||utils.isMobile())return;let l=0,u=!1;const c={};function f(){clearTimeout(l),$("#post-tooltip").remove(),u=!0}$(window).one("action:ajaxify.start",f),$('[component="topic"]').on("mouseenter",'[component="post"] a, [component="topic/event"] a',async function(){const C=$(this);u=!1;async function T(O){const M=c[O]||await r.get(`/posts/${O}/summary`);if($("#post-tooltip").remove(),M&&ajaxify.data.template.topic){c[O]=M;const z=await app.parseAndTranslate("partials/topic/post-preview",{post:M});if(u)return;z.hide().find(".timeago").timeago(),z.appendTo($("body")).fadeIn(300);const Z=C.parents('[component="topic"]').find('[component="post/content"]').first(),q=Z.offset(),_=Z.width(),tt=C.offset();z.css({top:tt.top+30,left:q.left,width:_})}}const L=C.attr("href"),S=utils.urlToLocation(L),U=S.pathname,J=L&&L!=="#"&&window.location.hostname===S.hostname;$("#post-tooltip").remove();const G=J&&U&&U.match(/\/post\/([\d]+)/),X=J&&U&&U.match(/\/topic\/([\d]+)/);if(G){const O=G[1];if(parseInt(C.parents('[component="post"]').attr("data-pid"),10)===parseInt(O,10))return;l=setTimeout(async()=>{T(O)},300)}else X&&(l=setTimeout(async()=>{const O=X[1],M=await r.get("/topics/"+O,{});T(M.mainPid)},300))}).on("mouseleave",'[component="post"] a, [component="topic/event"] a',f)}function B(){(config.enableQuickReply||config.theme&&config.theme.enableQuickReply)&&d.init()}function F(){const l=t.get("navbar/title").find("span");$(window).scrollTop()>50&&l.hasClass("hidden")?l.html(ajaxify.data.title).removeClass("hidden"):$(window).scrollTop()<=50&&!l.hasClass("hidden")&&l.html("").addClass("hidden"),$(window).scrollTop()>300&&y.remove("bookmark")}h.navigatorCallback=function(l,u){if(!ajaxify.data.template.topic||n.scrollActive)return;const c="topic/"+ajaxify.data.slug+(l>1?"/"+l:"");if(c!==R&&(R=c,l>=u&&app.user.uid&&r.put(`/topics/${ajaxify.data.tid}/read`),V(l),ajaxify.data.updateUrlWithPostIndex&&history.replaceState)){let f=window.location.search||"";config.usePagination||(f=f&&!/^\?page=\d+$/.test(f)?f:""),history.replaceState({url:c+f},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+c+f)}};function V(l){const u="topic:"+ajaxify.data.tid+":bookmark",c=ajaxify.data.bookmark||i.getItem(u);config.topicPostSort==="newest_to_oldest"&&(l=Math.max(1,ajaxify.data.postcount-l+2)),ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&(!c||parseInt(l,10)>parseInt(c,10)||ajaxify.data.postcount<parseInt(c,10))&&(app.user.uid?(ajaxify.data.bookmark=Math.min(l,ajaxify.data.postcount),socket.emit("topics.bookmark",{tid:ajaxify.data.tid,index:ajaxify.data.bookmark},function(f){if(f)return ajaxify.data.bookmark=c,y.error(f)})):i.setItem(u,l)),(!c||parseInt(l,10)>=parseInt(c,10))&&y.remove("bookmark")}return h}.apply(j,P),v!==void 0&&(E.exports=v)},91748:(E,j,o)=>{"use strict";var P,v;P=[o(54939),o(60392),o(60447),o(47720),o(7237),o(32230),o(85233)],v=function(m,I,s,b,x,n,p){const d={},t={"event:user_status_change":i,"event:voted":a,"event:bookmarked":r,"event:topic_deleted":I.setDeleteState,"event:topic_restored":I.setDeleteState,"event:topic_purged":y,"event:topic_locked":I.setLockedState,"event:topic_unlocked":I.setLockedState,"event:topic_pinned":I.setPinnedState,"event:topic_unpinned":I.setPinnedState,"event:topic_moved":k,"event:post_edited":D,"event:post_purged":h,"event:post_deleted":A,"event:post_restored":A,"posts.bookmark":R,"posts.unbookmark":R,"posts.upvote":W,"posts.downvote":W,"posts.unvote":W,"event:new_notification":H,"event:new_post":s.onNewPost};d.init=function(){d.removeListeners();for(const e in t)t.hasOwnProperty(e)&&socket.on(e,t[e])},d.removeListeners=function(){for(const e in t)t.hasOwnProperty(e)&&socket.removeListener(e,t[e])};function i(e){app.updateUserStatus($('[data-uid="'+e.uid+'"] [component="user/status"]'),e.status)}function a(e){const g=$('[data-pid="'+e.post.pid+'"] [component="post/vote-count"]').filter(function(N,K){return parseInt($(K).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),w=$('.reputation[data-uid="'+e.post.uid+'"]');g.html(e.post.votes).attr("data-votes",e.post.votes),w.html(e.user.reputation).attr("data-reputation",e.user.reputation)}function r(e){$('[data-pid="'+e.post.pid+'"] .bookmarkCount').filter(function(g,w){return parseInt($(w).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).html(e.post.bookmarks).attr("data-bookmarks",e.post.bookmarks)}function y(e){ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function k(e){e&&e.slug&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("topic/"+e.slug,null,!0)}function D(e){if(!e||!e.post||parseInt(e.post.tid,10)!==parseInt(ajaxify.data.tid,10))return;const g=x.get("post/content",e.post.pid).filter(function(B,F){return parseInt($(F).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),w=$(`[data-pid="${e.post.pid}"]`),N=w.find('[component="post/editor"]').filter(function(B,F){return parseInt($(F).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),K=x.get("topic/title"),Y=x.get("navbar/title").find("span"),Q=x.get("breadcrumb/current");if(e.topic.rescheduled)return ajaxify.go("topic/"+e.topic.slug,null,!0);if(K.length&&e.topic.title&&e.topic.renamed){ajaxify.data.title=e.topic.title;const B="topic/"+e.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:B},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+B),K.fadeOut(250,function(){K.html(e.topic.title).fadeIn(250)}),Q.fadeOut(250,function(){Q.html(e.topic.title).fadeIn(250)}),Y.fadeOut(250,function(){Y.html(e.topic.title).fadeIn(250)})}e.post.changed?g.fadeOut(250,function(){if(g.html(n.unescape(e.post.content)),g.find("img:not(.not-responsive)").addClass("img-fluid"),b.wrapImagesInLinks(g.parent()),s.addBlockquoteEllipses(g.parent()),g.fadeIn(250),e.post.edited){const B={editor:e.editor,editedISO:utils.toISOString(e.post.edited)};app.parseAndTranslate("partials/topic/post-editor",B,function(F){N.replaceWith(F),w.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${B.editedISO}]]`),w.find('[component="post/editor"] .timeago').timeago(),p.fire("action:posts.edited",e)})}}):p.fire("action:posts.edited",e),e.topic.tags&&e.topic.tagsupdated&&o.e(62516).then(function(){var B=[o(62516)];(function(F){F.updateTopicTags([e.topic])}).apply(null,B)}).catch(o.oe),m.removeMenu(x.get("post","pid",e.post.pid))}function h(e){!e||parseInt(e.tid,10)!==parseInt(ajaxify.data.tid,10)||(x.get("post","pid",e.pid).fadeOut(500,function(){$(this).remove(),s.showBottomPostBar()}),ajaxify.data.postcount-=1,m.updatePostCount(ajaxify.data.postcount),o.e(21352).then(function(){var g=[o(21352)];(function(w){w.onPostPurged(e)}).apply(null,g)}).catch(o.oe))}function A(e){const g=x.get("post","pid",e.pid);if(!g.length)return;g.toggleClass("deleted");const w=g.hasClass("deleted");m.toggle(e.pid,w),!ajaxify.data.privileges.isAdminOrMod&&parseInt(e.uid,10)!==parseInt(app.user.uid,10)&&(g.find('[component="post/tools"]').toggleClass("hidden",w),w?g.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]"):g.find('[component="post/content"]').html(n.unescape(e.content)))}function R(e){const g=$('[data-pid="'+e.post.pid+'"] [component="post/bookmark"]').filter(function(w,N){return parseInt($(N).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)});g.length&&(g.attr("data-bookmarked",e.isBookmarked),g.find('[component="post/bookmark/on"]').toggleClass("hidden",!e.isBookmarked),g.find('[component="post/bookmark/off"]').toggleClass("hidden",e.isBookmarked))}function W(e){const g=$('[data-pid="'+e.post.pid+'"]');g.find('[component="post/upvote"]').filter(function(w,N){return parseInt($(N).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).toggleClass("upvoted",e.upvote),g.find('[component="post/downvote"]').filter(function(w,N){return parseInt($(N).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).toggleClass("downvoted",e.downvote)}function H(e){const g=ajaxify.data.tid;e&&e.tid&&parseInt(e.tid,10)===parseInt(g,10)&&socket.emit("topics.markTopicNotificationsRead",[g])}return d}.apply(j,P),v!==void 0&&(E.exports=v)},47913:(E,j,o)=>{E.exports=o(66485)},45482:(E,j,o)=>{E.exports=o(35729)},83713:(E,j,o)=>{E.exports=o(51077)},38259:(E,j,o)=>{E.exports=o(65616)},6e4:(E,j,o)=>{"use strict";var P,v;P=[o(7237),o(44541),o(2585),o(74344),o(7927),o(33371),o(42441),o(66603)],v=function(m,I,s,b,x,n,p,d){const t={};t.init=function(){const a=m.get("topic/quickreply/text"),r=`qr:draft:tid:${ajaxify.data.tid}`,y={element:a,strategies:[],options:{style:{"z-index":100}}};i(),$(window).one("action:ajaxify.start",()=>{i()}),$(window).trigger("composer:autocomplete:init",y),s._active.core_qr=s.setup(y),p.bind("ctrl+return",h=>{h.target===a.get(0)&&m.get("topic/quickreply/button").get(0).click()}),n.init({dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:a,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:a,route:"/api/post/upload",callback:function(h){let A=a.val();h.forEach(R=>{A=A+(A?`
`:"")+(R.isImage?"!":"")+`[${R.filename}](${R.url})`}),a.val(A)}});let k=!0;m.get("topic/quickreply/button").on("click",function(h){if(h.preventDefault(),!k)return;const A=m.get("topic/quickreply/text").val(),R={tid:ajaxify.data.tid,handle:void 0,content:A},W=A.length;if(W<parseInt(config.minimumPostLength,10))return x.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(W>parseInt(config.maximumPostLength,10))return x.error("[[error:content-too-long, "+config.maximumPostLength+"]]");k=!1,b.post(`/topics/${ajaxify.data.tid}`,R,function(H,e){if(k=!0,H)return x.error(H);e&&e.queued&&x.alert({type:"success",title:"[[global:alert.success]]",message:e.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${e.id}`)}}),m.get("topic/quickreply/text").val(""),d.removeItem(r),s._active.core_qr.hide()})});const D=d.getItem(r);D&&a.val(D),a.on("keyup",utils.debounce(function(){const h=a.val();h?d.setItem(r,h):d.removeItem(r)},1e3)),m.get("topic/quickreply/expand").on("click",h=>{h.preventDefault(),d.removeItem(r);const A=m.get("topic/quickreply/text");I.newReply({tid:ajaxify.data.tid,title:ajaxify.data.title,body:utils.escapeHTML(A.val())}),A.val("")})};function i(){s._active.core_qr&&(s._active.core_qr.destroy(),s._active.core_qr=null)}return t}.apply(j,P),v!==void 0&&(E.exports=v)},69241:(E,j,o)=>{"use strict";var P,v;P=[o(7237)],v=function(m){const I={};return I.handleSort=function(s,b){const x=m.get("thread/sort");x.find("i").removeClass("fa-check");const n=utils.params().sort||config[s];x.find('a[data-sort="'+n+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a').on("click",'[component="thread/sort"] a',function(){const d=$(this).attr("data-sort"),t=utils.params();t.sort=d;const i=decodeURIComponent($.param(t));ajaxify.go(b+(i?"?"+i:""))})},I}.apply(j,P),v!==void 0&&(E.exports=v)},27145:(E,j,o)=>{"use strict";E=o.nmd(E);var P,v;P=[o(32230),o(85233)],v=function(m,I){const s={};let b=!1;s.init=function(){if(s.taskbar=$('[component="taskbar"]'),s.tasklist=s.taskbar.find("ul"),!s.taskbar.length||!s.tasklist.length){b=!0;return}s.taskbar.on("click","li",async function(){const t=$(this),i=t.attr("data-module"),a=t.attr("data-uuid"),r=await app.require(i);return t.hasClass("active")?r.minimize(a):(n(),r.load(a),s.toggleNew(a,!1),s.tasklist.removeClass("active"),t.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){s.closeAll()})},s.close=async function(t,i){if(b)return;if(s.tasklist.find('[data-module="'+E+'"][data-uuid="'+i+'"]').length){const r=await app.require(t);r&&typeof r.close=="function"&&r.close(i)}},s.closeAll=function(t){if(b)return;let i="[data-uuid]";t&&(i='[data-module="'+t+'"]'+i),s.tasklist.find(i).each(function(a,r){s.close(t||r.getAttribute("data-module"),r.getAttribute("data-uuid"))})},s.discard=function(t,i){if(b)return;s.tasklist.find('[data-module="'+t+'"][data-uuid="'+i+'"]').remove(),x()},s.push=function(t,i,a,r){if(r=r||function(){},b)return r();const y=s.tasklist.find('li[data-uuid="'+i+'"]'),k={module:t,uuid:i,options:a,element:y};I.fire("filter:taskbar.push",k),!y.length&&k.module?p(k,r):r(y)},s.get=function(t){return b?[]:$('[data-module="'+t+'"]').map(function(a,r){return $(r).data()})},s.minimize=function(t,i){if(b)return;s.tasklist.find('[data-module="'+t+'"][data-uuid="'+i+'"]').toggleClass("active",!1)},s.toggleNew=function(t,i,a){if(b)return;s.tasklist.find('[data-uuid="'+t+'"]').toggleClass("new",i),a||I.fire("action:taskbar.toggleNew",t)},s.updateActive=function(t){if(b)return;const i=s.tasklist.find("li");i.removeClass("active"),i.filter('[data-uuid="'+t+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+t+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},s.isActive=function(t){return b?!1:s.tasklist.find('li[data-uuid="'+t+'"]').hasClass("active")};function x(){if(b)return;s.tasklist.find("li").length>0?s.taskbar.attr("data-active","1"):s.taskbar.removeAttr("data-active")}function n(){b||s.tasklist.find(".active").removeClass("active")}function p(t,i){if(b)return i();m.translate(t.options.title,function(a){const r=$("<div></div>").text(a||"NodeBB Task").html(),y=$("<li></li>").addClass(t.options.className).html('<a href="#"'+(t.options.image?` style="background-image: url('`+t.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(t.options.icon?'<i class="fa '+t.options.icon+'"></i> ':"")+'<span aria-label="'+r+'" component="taskbar/title">'+r+"</span></a>").attr({title:r,"data-module":t.module,"data-uuid":t.uuid}).addClass(t.options.state!==void 0?t.options.state:"active");(!t.options.state||t.options.state==="active")&&n(),s.tasklist.append(y),x(),t.element=y,y.data(t),I.fire("action:taskbar.pushed",t),i(y)})}const d=function(t,i,a){switch(i){case"title":t.find('[component="taskbar/title"]').text(a);break;case"icon":t.find("i").attr("class","fa fa-"+a);break;case"image":t.find("a").css("background-image",a?'url("'+a.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":t.find("a").css("background-color",a);break;case"color":t.find("a").css("color",a);break}};return s.update=function(t,i,a){if(b)return;const r=s.tasklist.find('[data-module="'+t+'"][data-uuid="'+i+'"]');if(!r.length)return;const y=r.data();Object.keys(a).forEach(function(k){y[k]=a[k],d(r,k,a[k])}),r.data(y)},s}.apply(j,P),v!==void 0&&(E.exports=v)},62023:(E,j,o)=>{"use strict";var P,v;P=[o(74344),o(63281),o(7927),o(50431),o(59006),o(32230),o(62526)],v=function(m,I,s,b,x,n){const p={};return p.get=d=>m.get(`/topics/${d}/thumbs`,{}),p.getByPid=d=>m.get(`/posts/${d}`,{}).then(t=>p.get(t.tid)),p.delete=(d,t)=>m.del(`/topics/${d}/thumbs`,{path:t}),p.deleteAll=d=>{p.get(d).then(t=>{Promise.all(t.map(i=>p.delete(d,i.url)))})},p.upload=d=>new Promise(t=>{b.show({title:"[[topic:composer.thumb_title]]",method:"put",route:config.relative_path+`/api/v3/topics/${d}/thumbs`},function(i){t(i)})}),p.modal={},p.modal.open=function(d){const{id:t,pid:i}=d;let{modal:a}=d,r;return new Promise(y=>{Promise.all([p.get(t),i?p.getByPid(i):[]]).then(k=>new Promise(D=>{const h=k.reduce((A,R)=>A.concat(R));r=h.length,D(h)})).then(k=>x.render("modals/topic-thumbs",{thumbs:k})).then(k=>{a?n.translate(k,function(D){a.find(".bootbox-body").html(D),p.modal.handleSort({modal:a,numThumbs:r})}):(a=I.dialog({title:"[[modules:thumbs.modal.title]]",message:k,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(p.upload(t).then(()=>{p.modal.open({...d,modal:a}),Promise.all([o.e(61006),o.e(42265),o.e(49915),o.e(8311)]).then(function(){var D=[o(44541)];(h=>{h.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),y()}).apply(null,D)}).catch(o.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),p.modal.handleDelete({...d,modal:a}),p.modal.handleSort({modal:a,numThumbs:r}))})})},p.modal.handleDelete=d=>{d.modal.get(0).addEventListener("click",i=>{i.target.closest('button[data-action="remove"]')&&I.confirm("[[modules:thumbs.modal.confirm-remove]]",a=>{if(!a)return;const r=i.target.closest("[data-id]").getAttribute("data-id"),y=i.target.closest("[data-path]").getAttribute("data-path");m.del(`/topics/${r}/thumbs`,{path:y}).then(()=>{p.modal.open(d)}).catch(s.error)})})},p.modal.handleSort=({modal:d,numThumbs:t})=>{if(t>1){const i=d.find(".topic-thumbs-modal");i.sortable({items:"[data-id]"}),i.on("sortupdate",p.modal.handleSortChange)}},p.modal.handleSortChange=(d,t)=>{const i=t.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(i).forEach((a,r)=>{const y=a.getAttribute("data-id");let k=a.getAttribute("data-path");k=k.replace(new RegExp(`^${config.upload_url}`),""),m.put(`/topics/${y}/thumbs/order`,{path:k,order:r}).catch(s.error)})},p}.apply(j,P),v!==void 0&&(E.exports=v)},50431:(E,j,o)=>{"use strict";var P,v;P=[o(86569)],v=function(){const m={};m.show=function(n,p){const d=n.hasOwnProperty("fileSize")&&n.fileSize!==void 0?parseInt(n.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:n.hasOwnProperty("showHelp")&&n.showHelp!==void 0?n.showHelp:!0,fileSize:d,title:n.title||"[[global:upload_file]]",description:n.description||"",button:n.button||"[[global:upload]]",accept:n.accept?n.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const i=t.find("#uploadForm");i.attr("action",n.route),i.find("#params").val(JSON.stringify(n.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),i.submit()}),i.submit(function(){return I(t,d,p),!1})})},m.hideAlerts=function(n){$(n).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function I(n,p,d){s(n,"status","[[uploads:uploading-file]]"),n.find("#upload-progress-bar").css("width","0%"),n.find("#upload-progress-box").show().removeClass("hide");const t=n.find("#fileInput");if(!t.val())return s(n,"error","[[uploads:select-file-to-upload]]");if(!x(t[0],p))return s(n,"error","[[error:file-too-big, "+p+"]]");m.ajaxSubmit(n,d)}function s(n,p,d){m.hideAlerts(n),p==="error"&&n.find("#fileUploadSubmitBtn").removeClass("disabled"),d=d.replace(/&amp;#44/g,"&#44"),n.find("#alert-"+p).translateText(d).removeClass("hide")}m.ajaxSubmit=function(n,p){n.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=b(t),s(n,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,i,a,r){n.find("#upload-progress-bar").css("width",r+"%")},success:function(t){let i=b(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(i=t.response.images),p(i[0].url),s(n,"success","[[uploads:upload-success]]"),setTimeout(function(){m.hideAlerts(n),n.modal("hide")},750)}})};function b(n){if(typeof n=="string")try{return JSON.parse(n)}catch{return{error:"[[error:parse-error]]"}}return n}function x(n,p){return window.FileReader&&p?n.files[0].size<=p*1e3:!0}return m}.apply(j,P),v!==void 0&&(E.exports=v)}}]);
