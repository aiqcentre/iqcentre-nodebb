"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[90028],{90028:(O,j,p)=>{var v,y;v=[p(7073),p(7927),p(74344)],y=function(q,k,C){const g={};let c,r,u={};g.init=function(t){t=t||function(){},!c&&app.parseAndTranslate("modals/merge-topic",{},function(a){c=a,$("body").append(c),r=c.find("#merge_topics_confirm"),c.find("#merge_topics_cancel").on("click",n),$("#content").on("click",'[component="topic/select"]',E),s(),r.on("click",function(){e(r)}),q.enableQuickSearch({searchElements:{inputEl:c.find(".topic-search-input"),resultEl:c.find(".quick-search-container")},searchOptions:{in:"titles"}}),c.on("click","[data-tid]",function(){return $(this).attr("data-tid")&&g.addTopic($(this).attr("data-tid")),!1}),t()})},g.addTopic=function(t,a){a=a||function(){},C.get(`/topics/${t}`,{}).then(function(o){const l=o?o.title:"No title";u[t]?delete u[t]:u[t]=l,i(),s(),a()}).catch(k.error)};function E(t){if(!c)return;const a=$(this).parents('[component="category/topic"]').attr("data-tid");return g.addTopic(a),t.preventDefault(),t.stopPropagation(),!1}function e(t){t.attr("disabled",!0);const a=Object.keys(u),o={};c.find(".merge-main-topic-radio").is(":checked")?o.mainTid=c.find(".merge-main-topic-select").val():c.find(".merge-new-title-radio").is(":checked")&&(o.newTopicTitle=c.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:a,options:o},function(l,d){if(t.removeAttr("disabled"),l)return k.error(l);ajaxify.go("/topic/"+d),n()})}function s(){if(!c)return;const t=Object.keys(u);t.sort(function(o,l){return o-l});const a=t.map(function(o){return{tid:o,title:u[o]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:a},function(o){c.find(".topics-section").html(o.find(".topics-section").html()),c.find(".merge-main-topic-select").html(o.find(".merge-main-topic-select").html())}):c.find(".topics-section").translateHtml("[[error:no-topics-selected]]")}function i(){Object.keys(u).length?r.removeAttr("disabled"):r.attr("disabled",!0)}function n(){c&&(c.remove(),c=null),u={},$("#content").off("click",'[component="topic/select"]',E)}return g}.apply(j,v),y!==void 0&&(O.exports=y)},7073:(O,j,p)=>{var v,y;v=[p(32230),p(66603),p(85233),p(7927),p(73138)],y=function(q,k,C,g,c){const r={current:{}};r.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((i,n)=>{u($(n),e)})};function u(e,s){const i=e.find('[component="search/button"]'),n=e.find('[component="search/fields"]'),t=n.find('input[name="query"]'),a=n.find("#quick-search-container"),o=n.hasClass("hidden");e.find(".advanced-search-link").off("mousedown").on("mousedown",function(){ajaxify.go("/search")}),o&&t.off("blur").on("blur",function(){setTimeout(function(){t.is(":focus")||(n.addClass("hidden"),i.removeClass("hidden"))},200)}),t.off("focus");const l={inputEl:t,resultEl:a};r.enableQuickSearch({searchOptions:s,searchElements:l}),i.off("click").on("click",function(d){return!config.loggedIn&&!app.user.privileges["search:content"]?(g.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(d.stopPropagation(),r.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const d=$(this).find('input[name="query"]'),m=r.getSearchPreferences();return m.term=d.val(),m.in=s.in,C.fire("action:search.submit",{searchOptions:m,searchElements:l}),r.query(m,function(){d.val(""),t.trigger("blur")}),!1})}r.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const s=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),i=e.searchElements.resultEl,n=e.searchElements.inputEl;let t=n.val();const a=i.find(".filter-category");function o(){ajaxify.data.template.category&&ajaxify.data.cid&&q.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(f){const h=$("<div></div>").html(f).text();a.find(".name").text(h)}),a.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function l(){e.searchOptions=Object.assign({},s),e.searchOptions.term=n.val(),o(),ajaxify.data.template.category&&ajaxify.data.cid&&a.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(i.removeClass("hidden").find(".quick-search-results-container").html(""),i.find(".loading-indicator").removeClass("hidden")),C.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,r.api(e.searchOptions,function(f){if(i.find(".loading-indicator").addClass("hidden"),!f.posts||e.hideOnNoMatches&&!f.posts.length)return i.addClass("hidden").find(".quick-search-results-container").html("");f.posts.forEach(function(h){const x=$("<div>"+h.content+"</div>").text(),A=n.val().toLowerCase().replace(/^in:topic-\d+/,""),b=Math.max(0,x.toLowerCase().indexOf(A)-40);h.snippet=utils.escapeHTML((b>0?"...":"")+x.slice(b,b+80)+(x.length-b>80?"...":""))}),app.parseAndTranslate("partials/quick-search-results",f,function(h){h.length&&h.find(".timeago").timeago(),i.toggleClass("hidden",!h.length||!n.is(":focus")).find(".quick-search-results-container").html(h.length?h:"");const x=i.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");r.highlightMatches(e.searchOptions.term,x),C.fire("action:search.quick.complete",{data:f,options:e})})})}i.find('.filter-category input[type="checkbox"]').on("change",function(){n.focus(),l()}),n.off("keyup").on("keyup",utils.debounce(function(){if(n.val().length<3){i.addClass("hidden"),t=n.val();return}if(n.val()!==t){if(t=n.val(),!n.is(":focus"))return i.addClass("hidden");l()}},500));let d=!1;i.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){i.addClass("hidden")}),d=!0}),n.on("blur",function(){setTimeout(function(){!n.is(":focus")&&!d&&!i.hasClass("hidden")&&i.addClass("hidden")},200)});let m=!1;C.on("action:ajaxify.end",function(){ajaxify.isCold()||(m=!0)}),n.on("focus",function(){d=!1;const f=n.val();t=f,f&&i.find("#quick-search-results").children().length&&(o(),m?(l(),m=!1):i.removeClass("hidden"),n[0].setSelectionRange(f.startsWith("in:topic")?f.indexOf(" ")+1:0,f.length))}),n.off("refresh").on("refresh",function(){l()})},r.showAndFocusInput=function(e){const s=e.parents(".dropdown-menu");if(s.length){const i=s.siblings("[data-bs-toggle]"),n=c.Dropdown.getOrCreateInstance(i[0]);n&&n.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},r.query=function(e,s){s=s||function(){},ajaxify.go("search?"+E(e),s)},r.api=function(e,s){const i=config.relative_path+"/api/search?"+E(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const n=config.relative_path+"/search?"+E(e);$.get(i,function(t){t.url=n,s(t)})};function E(e){const s=e.in||"titles";let i=e.term.replace(/^[ ?#]*/,"");try{i=encodeURIComponent(i)}catch{return g.error("[[error:invalid-search-term]]")}const n={...e,term:i,in:s};return C.fire("action:search.createQueryString",{query:n,data:e}),decodeURIComponent($.param(n))}return r.getSearchPreferences=function(){try{return JSON.parse(k.getItem("search-preferences")||"{}")}catch{return{}}},r.highlightMatches=function(e,s){if(!e||!s.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const i=e.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),n=new RegExp("("+i+")","gi");s.each(function(){const t=$(this),a=[];t.find("*").each(function(){$(this).after("<!-- "+a.length+" -->"),a.push($("<div></div>").append($(this)))}),t.html(t.html().replace(n,function(o,l){return'<strong class="search-match fw-bold text-decoration-underline">'+l+"</strong>"})),a.forEach(function(o,l){t.html(t.html().replace("<!-- "+l+" -->",function(){return o.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-fluid")},r}.apply(j,v),y!==void 0&&(O.exports=y)}}]);
