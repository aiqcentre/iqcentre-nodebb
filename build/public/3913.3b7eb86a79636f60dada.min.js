(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3913,50648,36861],{98166:(x,A,f)=>{x.exports=f(73398)},88186:(x,A,f)=>{x.exports=f(13720)},73398:(x,A,f)=>{"use strict";var E,v;E=[f(59006),f(63281),f(7927),f(32230)],v=function(h,p,b,y){const m={},n={timestamp:0,open:!1,edit:!1,posts:{}};let w=[],i,r,t,l;const a={el:null,defaultText:"",activeText:""},s={el:null,icon:null,defaultText:"",activeText:""};let o,u;$(window).on("action:composer.activate",O),m.init=function(e,c){n.timestamp=0,n.posts=c,y.translateKeys(["[[topic:composer.post-later]]","[[modules:composer.change-schedule-date]]"]).then(g=>{a.defaultText=g[0],a.activeText=g[1]}),w=e[0].querySelectorAll(".display-scheduler"),i=e[0].querySelectorAll(".display-scheduler i"),a.el=e[0].querySelector(".dropdown-item.display-scheduler"),r=e[0].querySelector(".dropdown-item.cancel-scheduling"),t=e.find('[component="composer/submit/container"]'),l=e.find('[component="composer/submit/options/container"]'),s.el=e[0].querySelector(".composer-submit:not(.btn-sm)"),s.icon=s.el.querySelector("i"),s.defaultText=s.el.lastChild.textContent,s.activeText=s.el.getAttribute("data-text-variant"),r.addEventListener("click",k),w.forEach(g=>g.addEventListener("click",d))},m.getTimestamp=function(){return!m.isActive()||isNaN(n.timestamp)?0:n.timestamp},m.isActive=function(){return n.timestamp>0},m.isOpen=function(){return n.open},m.reset=function(){n.timestamp=0},m.onChangeCategory=function(e){S(e.privileges["topics:schedule"]),_(!1);const c=e.privileges["topics:schedule"]||l.attr("data-submit-options")>0;t.find(".composer-submit").toggleClass("rounded-1",!c),l.toggleClass("hidden",!c),m.reset()};async function d(){const e=await h.render("modals/topic-scheduler");p.dialog({message:e,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:T,onHidden:L,onEscape:!0,buttons:{cancel:{label:n.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(n.timestamp?"btn-warning":"btn-outline-secondary")+(n.edit?" hidden":""),callback:k},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:I}}})}function T(e){n.open=!0;const c=e.target.querySelector(".datetime-picker");o=c.querySelector('input[type="date"]'),u=c.querySelector('input[type="time"]'),W()}function L(){n.open=!1}function O(e,{post_uuid:c}){n.edit=!1;const g=n.posts[c];g&&g.isMain&&g.timestamp>Date.now()&&(n.timestamp=g.timestamp,n.edit=!0,_())}function W(){const e=new Date,c=new Date(e.getTime()-e.getTimezoneOffset()*6e4).toJSON();if(o.setAttribute("min",c.slice(0,10)),u.setAttribute("min",c.slice(11,-8)),m.isActive()){const g=new Date(n.timestamp-e.getTimezoneOffset()*6e4).toJSON();o.value=g.slice(0,10),u.value=g.slice(11,-8)}}function I(){const e=o.value&&u.value,c=new Date(`${o.value} ${u.value}`).getTime();if(!e||isNaN(c)||c<Date.now()){n.timestamp=0;const g=c<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return b.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:g}),!1}n.timestamp||_(!0),n.timestamp=c}function k(){n.timestamp&&(_(!1),n.timestamp=0)}function _(e=!0){i.forEach(c=>c.classList.toggle("active",e)),s.icon&&(s.icon.classList.toggle("fa-check",!e),s.icon.classList.toggle("fa-clock-o",e)),a.el&&(a.el.textContent=e?a.activeText:a.defaultText,r.classList.toggle("hidden",!e)),s.el.lastChild.textContent=e?s.activeText:s.defaultText}function S(e){w.forEach(c=>c.classList.toggle("hidden",!e))}return m}.apply(A,E),v!==void 0&&(x.exports=v)},13720:(x,A,f)=>{"use strict";var E,v;E=[f(7927)],v=function(h){var p={},b,y;p.init=function(i,r){var t=i.find(".tags");if(t.length){b=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,y=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,t.tagsinput({tagClass:"badge bg-info rounded-1",confirmKeys:[13,44],trimValue:!0});var l=i.find(".bootstrap-tagsinput input");m(i,r,ajaxify.data),app.loadJQueryUI(function(){l.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:i.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(o,u){socket.emit("topics.autocompleteTags",{query:o.term,cid:r.cid},function(d,T){if(d)return h.error(d);T&&u(T),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){n(l)}}),w(r.tags,t),t.on("beforeItemAdd",function(o){var u=y&&y<=p.getTags(i.attr("data-uuid")).length,d=utils.cleanUpTag(o.item,config.maximumTagLength),T=d!==o.item;if(o.cancel=T||o.item.length<config.minimumTagLength||o.item.length>config.maximumTagLength||u,o.item.length<config.minimumTagLength)return h.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(o.item.length>config.maximumTagLength)return h.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(u)return h.error("[[error:too-many-tags, "+y+"]]");T&&t.tagsinput("add",d)});var a=!1,s=!1;t.on("itemRemoved",function(o){if(s){s=!1;return}o.item&&socket.emit("topics.canRemoveTag",{tag:o.item},function(u,d){if(u)return h.error(u);d||(h.error("[[error:cant-remove-system-tag]]"),a=!0,t.tagsinput("add",o.item))})}),t.on("itemAdded",function(o){if(a){a=!1;return}var u=r.hasOwnProperty("cid")?r.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:o.item,cid:u||0},function(d,T){if(d)return h.error(d);if(!T)return s=!0,t.tagsinput("remove",o.item);$(window).trigger("action:tag.added",{cid:u,tagEl:t,tag:o.item}),l.length&&l.autocomplete("close")})})}),l.attr("tabIndex",t.attr("tabIndex")),l.on("blur",function(){n(l)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var a=$(this).attr("data-tag");return a&&w([a],t),!1})}},p.isEnoughTags=function(i){return p.getTags(i).length>=b},p.minTagCount=function(){return b},p.onChangeCategory=function(i,r,t,l){var a=i.find('[component="composer/tag/dropdown"]');a.length&&(m(i,r,l),a.toggleClass("hidden",!l.tagWhitelist||!l.tagWhitelist.length),l.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:l.tagWhitelist},function(s){a.find(".dropdown-menu").html(s)}))};function m(i,r,t){var l=i.find(".tags"),a=i.find(".bootstrap-tagsinput input");a.length&&(t.hasOwnProperty("minTags")&&(b=t.minTags),t.hasOwnProperty("maxTags")&&(y=t.maxTags),t.tagWhitelist&&t.tagWhitelist.length?(a.attr("readonly",""),a.attr("placeholder",""),l.tagsinput("items").slice().forEach(function(s){t.tagWhitelist.indexOf(s)===-1&&l.tagsinput("remove",s)})):(a.removeAttr("readonly"),a.attr("placeholder",i.find("input.tags").attr("placeholder"))),i.find(".tags-container").toggleClass("haswhitelist",!!(t.tagWhitelist&&t.tagWhitelist.length)),i.find(".tags-container").toggleClass("hidden",t.privileges&&t.privileges.hasOwnProperty("topics:tag")&&!t.privileges["topics:tag"]||y===0&&!r&&!r.tags&&!r.tags.length),t.privileges&&t.privileges.hasOwnProperty("topics:tag")&&!t.privileges["topics:tag"]&&l.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:i,tagWhitelist:t.tagWhitelist,tagsInput:a}))}function n(i){var r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){i.trigger(r)},100)}function w(i,r){if(i&&i.length)for(var t=0;t<i.length;++t)r.tagsinput("add",i[t])}return p.getTags=function(i){return $('.composer[data-uuid="'+i+'"] .tags').tagsinput("items")},p}.apply(A,E),v!==void 0&&(x.exports=v)}}]);
