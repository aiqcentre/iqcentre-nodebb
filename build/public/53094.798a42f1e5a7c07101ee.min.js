"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[53094,11383],{53094:(_,x,l)=>{var p,f;p=[l(7237),l(3547),l(32230),l(7927),l(74344)],f=function(y,n,r,c,u){const m={};let o,d,s;m.init=function(t){o||(s=ajaxify.data.tid,app.parseAndTranslate("modals/move-post",{},function(i){o=i,d=o.find("#move_posts_confirm"),$("body").append(o),o.find("#move_posts_cancel").on("click",b),o.find("#topicId").on("keyup",utils.debounce(g,200)),n.init(A),h(),t&&n.togglePostSelection(t,t.attr("data-pid")),$(window).off("action:ajaxify.end",e).on("action:ajaxify.end",e),d.on("click",function(){const v=a();if(!v)return;d.attr("disabled",!0);const I={pids:n.pids.slice(),tid:v};if(config.undoTimeout>0)return c.alert({alert_id:"pids_move_"+n.pids.join("-"),title:"[[topic:thread_tools.move-posts]]",message:"[[topic:topic_move_posts_success]]",type:"success",timeout:config.undoTimeout,timeoutfn:function(){P(I)},clickfn:function(j,E){delete E.timeoutfn,c.success("[[topic:topic_move_posts_undone]]"),d.removeAttr("disabled")}});P(I)})}))};function e(){if(!o)return;const t=o.find("#topicId");let i=null;ajaxify.data.template.topic&&ajaxify.data.tid&&parseInt(ajaxify.data.tid,10)!==s&&(i=ajaxify.data.tid),i&&t.val(i),g()}function a(){const t=o.find("#topicId");return t.length&&t.val()?t.val():ajaxify.data.template.topic&&ajaxify.data.tid}function h(){if(!o)return;const t=a();n.pids.length?t&&parseInt(t,10)!==parseInt(s,10)?u.get("/topics/"+t,{}).then(function(i){if(!i||!i.tid)return c.error("[[error:no-topic]]");if(i.scheduled)return c.error("[[error:cant-move-posts-to-scheduled]]");const v=r.compile("topic:x-posts-will-be-moved-to-y",n.pids.length,i.title);o.find("#pids").translateHtml(v)}):o.find("#pids").translateHtml("[[topic:x-posts-selected, "+n.pids.length+"]]"):o.find("#pids").translateHtml("[[topic:no-posts-selected]]")}function g(){if(!o)return;const t=a();n.pids.length&&t&&parseInt(t,10)!==parseInt(s,10)?d.removeAttr("disabled"):d.attr("disabled",!0),h()}function A(){g()}function P(t){t.tid&&Promise.all(t.pids.map(i=>u.put(`/posts/${i}/move`,{tid:t.tid}))).then(()=>{t.pids.forEach(function(i){y.get("post","pid",i).fadeOut(500,function(){$(this).remove()})}),t.pids.length===1&&ajaxify.data.template.topic&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go(`/post/${t.pids[0]}`),b()}).catch(c.error)}function b(){o&&(o.remove(),o=null,n.disable(),$(window).off("action:ajaxify.end",e))}return m}.apply(x,p),f!==void 0&&(_.exports=f)},3547:(_,x,l)=>{var p,f;p=[l(7237)],f=function(y){const n={};let r;n.pids=[];let c=!1;n.init=function(s,e){n.pids.length=0,r=s,e=e||{},c=e.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',u),o()};function u(s){s.stopPropagation();const e=$(this).attr("data-pid"),a=$('[component="topic"] [data-pid="'+e+'"]');!c&&parseInt($(this).attr("data-index"),10)===0||n.togglePostSelection(a,e)}n.disable=function(){n.pids.forEach(function(s){y.get("post","pid",s).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',u),d()},n.togglePostSelection=function(s,e){if(e){const a=n.pids.indexOf(e);a===-1?(n.pids.push(e),s.toggleClass("selected",!0)):(n.pids.splice(a,1),s.toggleClass("selected",!1)),n.pids.length&&n.pids.sort(function(h,g){return h-g}),typeof r=="function"&&r()}};function m(){return!1}function o(){$("#content").on("click",'[component="post"] button, [component="post"] a',m)}function d(){$("#content").off("click",'[component="post"] button, [component="post"] a',m)}return n}.apply(x,p),f!==void 0&&(_.exports=f)}}]);
