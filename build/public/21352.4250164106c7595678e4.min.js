"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[21352],{21352:(y,C,c)=>{var h,f;h=[c(60447),c(85233),c(7927)],f=function(m,w,P){const r={};r.init=function(e){const n=e.closest("[data-pid]"),i=n.data("pid"),t=e.find('[component="post/replies/open"]'),o=e.find('[component="post/replies/loading"]'),d=e.find('[component="post/replies/close"]');t.is(":not(.hidden)")&&o.is(".hidden")?(t.addClass("hidden"),o.removeClass("hidden"),socket.emit("posts.getReplies",i,function(s,l){if(o.addClass("hidden"),s)return t.removeClass("hidden"),P.error(s);d.removeClass("hidden"),l.forEach((a,p)=>{a&&(a.index=p)}),m.modifyPostsByPrivileges(l);const u={posts:l,privileges:ajaxify.data.privileges,"downvote:disabled":ajaxify.data["downvote:disabled"],"reputation:disabled":ajaxify.data["reputation:disabled"],loggedIn:!!app.user.uid,hideReplies:config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0};app.parseAndTranslate("topic","posts",u,async function(a){const p=$("<ul>",{component:"post/replies",class:"list-unstyled"}).html(a).hide();e.attr("data-target-component")?n.find('[component="'+e.attr("data-target-component")+'"]').html(p):p.insertAfter(e),p.slideDown("fast"),await m.onNewPostsAddedToDom(a),w.fire("action:posts.loaded",{posts:l})})})):d.is(":not(.hidden)")&&(d.addClass("hidden"),t.removeClass("hidden"),o.addClass("hidden"),n.find('[component="post/replies"]').slideUp("fast",function(){$(this).remove()}))},r.onNewPost=function(e){const n=e.posts[0];n&&(g(n,1),e.hideReplies=config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0,app.parseAndTranslate("topic","posts",e,async function(i){const t=$('[component="post"][data-pid="'+n.toPid+'"] [component="post/replies"]').first();t.length&&(config.topicPostSort==="newest_to_oldest"?t.prepend(i):t.append(i),await m.onNewPostsAddedToDom(i))}))},r.onPostPurged=function(e){g(e,-1)};function g(e,n){const i=document.querySelector(`[component="post"][data-pid="${e.toPid}"]`);if(!i)return;const t=$('[component="post"][data-pid="'+e.toPid+'"]').find('[component="post/reply-count"]').first(),o=t.find('[component="post/reply-count/text"]'),d=t.find('[component="post/reply-count/avatars"]'),s=Math.max(0,(parseInt(o.attr("data-replies"),10)||0)+n),l=t.find(".timeago").attr("title",e.timestampISO),u=i.getAttribute("data-index"),a=s===1&&Math.abs(e.index-u)===1;o.attr("data-replies",s),t.toggleClass("hidden",s<=0||a),s>1?o.translateText("[[topic:replies_to_this_post, "+s+"]]"):o.translateText("[[topic:one_reply_to_this_post]]"),!d.find('[data-uid="'+e.uid+'"]').length&&s<7&&app.parseAndTranslate("topic","posts",{posts:[{replies:{count:s,hasMore:!1,users:[e.user]}}]},function(p){d.prepend(p.find('[component="post/reply-count/avatars"]').html())}),d.addClass("hasMore"),l.data("timeago",null).timeago()}return r}.apply(C,h),f!==void 0&&(y.exports=f)}}]);
