"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[93216,43034],{93216:(E,B,r)=>{var R,A;R=[r(7237),r(27145),r(32230),r(85233),r(63281),r(7927),r(74344)],A=function(x,p,d,l,y,h,I){const n={};let i=!1;n.openChat=function(t,e){if(!app.user.uid)return h.error("[[error:not-logged-in]]");function o(c){n.load(c.attr("data-uuid")),n.center(c),n.focusInput(c)}l.fire("filter:chat.openChat",{modal:!0,roomId:t,uid:e}).then(c=>{if(!c.modal)return ajaxify.go(`/chats/${t}`);n.modalExists(t)?o(n.getModal(t)):I.get(`/chats/${t}`,{uid:e||app.user.uid}).then(s=>{s.users=s.users.filter(function(m){return m&&parseInt(m.uid,10)!==parseInt(app.user.uid,10)}),s.uid=e||app.user.uid,s.isSelf=!0,n.createModal(s,o)}).catch(h.error)})},n.newChat=function(t,e){function o(){I.post("/chats",{uids:[t]}).then(({roomId:c})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+c):n.openChat(c),e(null,c)}).catch(h.error)}if(e=e||function(){},!app.user.uid)return h.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return h.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(c,s){if(c)return h.error(c);if(!s)return o();y.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(m){m&&o()})})},n.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(e,o){if(e)return h.error(e);const c=o.rooms.map(s=>(s&&s.teaser&&(s.teaser.timeagoLong=$.timeago(new Date(parseInt(s.teaser.timestamp,10)))),s));d.toggleTimeagoShorthand(async function(){c.forEach(v=>{v&&v.teaser&&(v.teaser.timeago=$.timeago(new Date(parseInt(v.teaser.timestamp,10))),v.teaser.timeagoShort=v.teaser.timeago)}),d.toggleTimeagoShorthand();const s=await app.parseAndTranslate("partials/chats/dropdown",{rooms:c}),m=t.get(0);t.find("*").not(".navigation-link").remove(),t.prepend(s),t.off("click").on("click","[data-roomid]",function(v){if([".user-link",".mark-read"].some(g=>v.target.closest(g)))return;const a=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+a):n.openChat(a)}),m.removeEventListener("click",u),m.addEventListener("click",u),$('[component="chats/mark-all-read"]').off("click").on("click",async function(){await socket.emit("modules.chats.markAllRead"),ajaxify.data.template.chats&&$('[component="chat/nav-wrapper"] [data-roomid]').each((v,a)=>{n.markChatElUnread($(a),!1)})})})})};function u(t){if(!t.target.closest(".mark-read"))return;t.stopPropagation();const o=t.target.closest("[data-roomid]");n.toggleReadState(o)}n.toggleReadState=function(t){const e=!t.classList.contains("unread"),o=t.getAttribute("data-roomid");I[e?"put":"del"](`/chats/${o}/state`,{}).catch(c=>{h.error(c),n.markChatElUnread($(t),!e)}),n.markChatElUnread($(t),e)},n.isFromBlockedUser=function(t){return app.user.blocks.includes(parseInt(t,10))},n.isLookingAtRoom=function(t){return ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(t,10)},n.markChatElUnread=function(t,e){if(t.length>0){t.toggleClass("unread",e);const o=t.find(".mark-read");o.length&&(o.find(".read").toggleClass("hidden",e),o.find(".unread").toggleClass("hidden",!e))}},n.onChatMessageReceived=function(t){app.user.blocks.includes(parseInt(t.fromUid,10))||n.modalExists(t.roomId)&&(t.self=parseInt(app.user.uid,10)===parseInt(t.fromUid,10)?1:0,i||(i=t.self===0),t.message.self=t.self,t.message.timestamp=Math.min(Date.now(),t.message.timestamp),t.message.timestampISO=utils.toISOString(t.message.timestamp),f(t))};function f(t){const e=n.getModal(t.roomId),o=t.message.fromUser.username,c=t.self===1;r.e(46862).then(function(){var s=[r(46862)];(function(m){e.find('[data-mid="'+t.message.messageId+'"]').length||m.appendChatMessage(e.find('[component="chat/message/content"]'),t.message),e.is(":visible")?(p.updateActive(e.attr("data-uuid")),m.isAtBottom(e.find('[component="chat/message/content"]'))&&m.scrollToBottomAfterImageLoad(e.find('[component="chat/message/content"]'))):ajaxify.data.template.chats||n.toggleNew(e.attr("data-uuid"),!0,!0),!c&&(!e.is(":visible")||!app.isFocused)&&p.push("chat",e.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||o),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,s)}).catch(r.oe)}return n.onUserStatusChange=function(t){const e=n.getModal(t.uid);app.updateUserStatus(e.find('[component="user/status"]'),t.status)},n.onRoomRename=function(t){const e=n.getModal(t.roomId),o=e.find('[component="chat/room/name"]'),c=o.attr("data-icon");o.length&&o.html(t.newName?`<i class="fa ${c} text-muted"></i> ${t.newName}`:t.chatWithMessage);const s=$("<div></div>").html(t.newName).text();p.update("chat",e.attr("data-uuid"),{title:s}),l.fire("action:chat.renamed",Object.assign(t,{modal:e}))},n.getModal=function(t){return $("#chat-modal-"+t)},n.modalExists=function(t){return $("#chat-modal-"+t).length!==0},n.createModal=function(t,e){e=e||function(){},Promise.all([r.e(42441),r.e(61006),r.e(46862),r.e(54271),r.e(40855)]).then(function(){var o=[r(75203),r(30524),r(46862),r(14406)];(function(c,s,m,v){app.parseAndTranslate("chat",t,function(a){const g=t.roomId;if(n.modalExists(g))return e(n.getModal(t.roomId));const k=utils.generateUUID();let S=!1;a.attr("id","chat-modal-"+g),a.attr("data-roomid",g),a.attr("intervalId",0),a.attr("data-uuid",k),a.css("position","fixed"),a.appendTo($("body")),a.find(".timeago").timeago(),m.wrapImagesInLinks(a.find('[component="chat/messages"] .chat-content')),n.center(a),app.loadJQueryUI(function(){a.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),a.find(".modal-content").on("resize",function(C,H){H.originalSize.height!==H.size.height&&a.find(".modal-body").css("height",n.calculateChatListHeight(a))}),a.draggable({start:function(){p.updateActive(k),a.css({bottom:"auto",right:"auto"})},stop:function(){n.focusInput(a)},distance:10,handle:".modal-header"})}),c.apply(a.find('[component="chat/messages"] .chat-content')),a.find("#chat-close-btn").on("click",function(){n.close(k)});function U(){const C=x.get("chat/input").val();$(window).one("action:ajaxify.end",function(){x.get("chat/input").val(C)}),ajaxify.go(`user/${app.user.userslug}/chats/${g}`),n.close(k)}a.find(".modal-header").on("dblclick",U),a.find('button[data-action="maximize"]').on("click",U),a.find('button[data-action="minimize"]').on("click",function(){const C=a.attr("data-uuid");n.minimize(C)}),a.on("mouseup",function(){p.updateActive(a.attr("data-uuid")),S&&(S=!1)}),a.on("mousemove",function(C){C.which===1&&(S=!0)}),a.on("mousemove keypress click",function(){i&&(I.del(`/chats/${g}/state`,{}),i=!1)}),s.addActionHandlers(a.find('[component="chat/messages"]'),g),s.addRenameHandler(g,a.find('[data-action="rename"]')),s.addLeaveHandler(g,a.find('[data-action="leave"]')),s.addDeleteHandler(g,a.find('[data-action="delete"]')),s.addSendHandlers(g,a.find(".chat-input"),a.find('[data-action="send"]')),s.addManageHandler(g,a.find('[data-action="manage"]')),s.createAutoComplete(g,a.find('[component="chat/input"]')),s.addScrollHandler(g,t.uid,a.find('[component="chat/message/content"]')),s.addScrollBottomHandler(a.find('[component="chat/message/content"]')),s.addParentHandler(a.find('[component="chat/message/content"]')),s.addCharactersLeftHandler(a),s.addTextareaResizeHandler(a),s.addIPHandler(a),s.addUploadHandler({dragDropAreaEl:a.find(".modal-content"),pasteEl:a,uploadFormEl:a.find('[component="chat/upload"]'),uploadBtnEl:a.find('[component="chat/upload/button"]'),inputEl:a.find('[component="chat/input"]')}),m.addSocketListeners(),v.init(g,a),s.addNotificationSettingHandler(g,a),p.push("chat",a.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){p.toggleNew(a.attr("data-uuid"),!t.isSelf),l.fire("action:chat.loaded",a),typeof e=="function"&&e(a)})})}).apply(null,o)}).catch(r.oe)},n.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},n.close=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');clearInterval(e.attr("intervalId")),e.attr("intervalId",0),e.remove(),e.data("modal",null),p.discard("chat",t),e.attr("data-mobile")&&n.disableMobileBehaviour(e);const o=e.attr("data-roomid");Promise.all([r.e(42441),r.e(61006),r.e(46862),r.e(54271),r.e(81018)]).then(function(){var c=[r(30524)];(function(s){s.destroyAutoComplete(o)}).apply(null,c)}).catch(r.oe),socket.emit("modules.chats.leave",o),l.fire("action:chat.closed",{uuid:t,modal:e})},n.center=function(t){const e=t.attr("data-center");if(!e||e==="false")return;let o=!1;return t.hasClass("hide")&&(t.removeClass("hide"),o=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),o&&t.addClass("hide"),t},n.load=function(t){r.e(46862).then(function(){var e=[r(46862)];(function(o){const c=$('.chat-modal[data-uuid="'+t+'"]');c.removeClass("hide"),p.updateActive(t),o.scrollToBottomAfterImageLoad(c.find(".chat-content")),n.focusInput(c);const s=c.attr("data-roomid");I.del(`/chats/${s}/state`,{}),socket.emit("modules.chats.enter",s);const m=utils.findBootstrapEnvironment();(m==="xs"||m==="sm")&&n.enableMobileBehaviour(c)}).apply(null,e)}).catch(r.oe)},n.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const e=t.find(".modal-body");e.css("height",n.calculateChatListHeight(t));function o(){e.css("height",n.calculateChatListHeight(t)),r.e(46862).then(function(){var c=[r(46862)];(function(s){s.scrollToBottom(t.find(".chat-content"))}).apply(null,c)}).catch(r.oe)}$(window).on("resize",o),$(window).one("action:ajaxify.start",function(){n.close(t.attr("data-uuid")),$(window).off("resize",o)})},n.disableMobileBehaviour=function(){app.toggleNavbar(!0)},n.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},n.minimize=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');e.addClass("hide"),p.minimize("chat",t),clearInterval(e.attr("intervalId")),e.attr("intervalId",0),l.fire("action:chat.minimized",{uuid:t,modal:e})},n.toggleNew=p.toggleNew,n}.apply(B,R),A!==void 0&&(E.exports=A)},27145:(E,B,r)=>{E=r.nmd(E);var R,A;R=[r(32230),r(85233)],A=function(x,p){const d={};let l=!1;d.init=function(){if(d.taskbar=$('[component="taskbar"]'),d.tasklist=d.taskbar.find("ul"),!d.taskbar.length||!d.tasklist.length){l=!0;return}d.taskbar.on("click","li",async function(){const i=$(this),u=i.attr("data-module"),f=i.attr("data-uuid"),t=await app.require(u);return i.hasClass("active")?t.minimize(f):(h(),t.load(f),d.toggleNew(f,!1),d.tasklist.removeClass("active"),i.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){d.closeAll()})},d.close=async function(i,u){if(l)return;if(d.tasklist.find('[data-module="'+E+'"][data-uuid="'+u+'"]').length){const t=await app.require(i);t&&typeof t.close=="function"&&t.close(u)}},d.closeAll=function(i){if(l)return;let u="[data-uuid]";i&&(u='[data-module="'+i+'"]'+u),d.tasklist.find(u).each(function(f,t){d.close(i||t.getAttribute("data-module"),t.getAttribute("data-uuid"))})},d.discard=function(i,u){if(l)return;d.tasklist.find('[data-module="'+i+'"][data-uuid="'+u+'"]').remove(),y()},d.push=function(i,u,f,t){if(t=t||function(){},l)return t();const e=d.tasklist.find('li[data-uuid="'+u+'"]'),o={module:i,uuid:u,options:f,element:e};p.fire("filter:taskbar.push",o),!e.length&&o.module?I(o,t):t(e)},d.get=function(i){return l?[]:$('[data-module="'+i+'"]').map(function(f,t){return $(t).data()})},d.minimize=function(i,u){if(l)return;d.tasklist.find('[data-module="'+i+'"][data-uuid="'+u+'"]').toggleClass("active",!1)},d.toggleNew=function(i,u,f){if(l)return;d.tasklist.find('[data-uuid="'+i+'"]').toggleClass("new",u),f||p.fire("action:taskbar.toggleNew",i)},d.updateActive=function(i){if(l)return;const u=d.tasklist.find("li");u.removeClass("active"),u.filter('[data-uuid="'+i+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+i+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},d.isActive=function(i){return l?!1:d.tasklist.find('li[data-uuid="'+i+'"]').hasClass("active")};function y(){if(l)return;d.tasklist.find("li").length>0?d.taskbar.attr("data-active","1"):d.taskbar.removeAttr("data-active")}function h(){l||d.tasklist.find(".active").removeClass("active")}function I(i,u){if(l)return u();x.translate(i.options.title,function(f){const t=$("<div></div>").text(f||"NodeBB Task").html(),e=$("<li></li>").addClass(i.options.className).html('<a href="#"'+(i.options.image?` style="background-image: url('`+i.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(i.options.icon?'<i class="fa '+i.options.icon+'"></i> ':"")+'<span aria-label="'+t+'" component="taskbar/title">'+t+"</span></a>").attr({title:t,"data-module":i.module,"data-uuid":i.uuid}).addClass(i.options.state!==void 0?i.options.state:"active");(!i.options.state||i.options.state==="active")&&h(),d.tasklist.append(e),y(),i.element=e,e.data(i),p.fire("action:taskbar.pushed",i),u(e)})}const n=function(i,u,f){switch(u){case"title":i.find('[component="taskbar/title"]').text(f);break;case"icon":i.find("i").attr("class","fa fa-"+f);break;case"image":i.find("a").css("background-image",f?'url("'+f.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":i.find("a").css("background-color",f);break;case"color":i.find("a").css("color",f);break}};return d.update=function(i,u,f){if(l)return;const t=d.tasklist.find('[data-module="'+i+'"][data-uuid="'+u+'"]');if(!t.length)return;const e=t.data();Object.keys(f).forEach(function(o){e[o]=f[o],n(t,o,f[o])}),t.data(e)},d}.apply(B,R),A!==void 0&&(E.exports=A)}}]);
