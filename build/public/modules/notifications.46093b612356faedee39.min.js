(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[70071],{69986:(P,D,p)=>{"use strict";var b,T;b=[p(32230),p(7237),p(42840),p(16943),p(85233),p(7927)],T=function(h,u,v,m,l,f){const o={};let c={};const y=({notifications:e})=>new Promise(a=>{for(let i=0;i<e.length;i+=1)e[i].timeagoLong=$.timeago(new Date(parseInt(e[i].datetime,10)));h.toggleTimeagoShorthand(function(){for(let i=0;i<e.length;i+=1)e[i].timeago=$.timeago(new Date(parseInt(e[i].datetime,10))),e[i].timeagoShort=e[i].timeago;h.toggleTimeagoShorthand(),a({notifications:e})})});l.on("filter:notifications.load",y),o.loadNotifications=function(e,a){a=a||function(){},socket.emit("notifications.get",null,function(i,r){if(i)return f.error(i);const k=r.unread.concat(r.read).sort(function(R,B){return parseInt(R.datetime,10)>parseInt(B.datetime,10)?-1:1});l.fire("filter:notifications.load",{notifications:k}).then(({notifications:R})=>{app.parseAndTranslate("partials/notifications_list",{notifications:R},function(B){e.html(B),e.off("click").on("click","[data-nid]",function(O){const I=$(this);if(N(I)&&(O.stopPropagation(),O.preventDefault(),u.get("notifications/list").dropdown("toggle")),!I.hasClass("unread"))return;const U=I.attr("data-nid");s(U,!0)}),u.get("notifications").on("click",".mark-all-read",o.markAllRead),o.handleUnreadButton(e),l.fire("action:notifications.loaded",{notifications:k,list:e}),a()})})})},o.handleUnreadButton=function(e){e.on("click",".mark-read",function(){const a=$(this),i=a.parents("[data-nid]"),r=i.hasClass("unread"),k=i.attr("data-nid");return s(k,r,function(){i.toggleClass("unread"),a.find(".unread").toggleClass("hidden",r),a.find(".read").toggleClass("hidden",!r)}),!1})},o.onNewNotification=function(e){ajaxify.currentPage==="notifications"&&ajaxify.refresh(),socket.emit("notifications.getCount",function(a,i){if(a)return f.error(a);o.updateNotifCount(i)}),c[e.nid]||(c[e.nid]=!0)},o.markNotification=function(e,a,i){s(e,a,i)};function s(e,a,i){socket.emit("notifications.mark"+(a?"Read":"Unread"),e,function(r){if(r)return f.error(r);a&&c[e]&&delete c[e],i&&i()})}function N(e){const a=e.attr("data-pid"),i=e.attr("data-path"),r=u.get("post","pid",a);return i.startsWith(config.relative_path+"/post/")&&a&&r.length&&ajaxify.data.template.topic?(v.scrollToIndex(r.attr("data-index"),!0),!0):!1}return o.updateNotifCount=function(e){const a=u.get("notifications/icon");e=Math.max(0,e),a.toggleClass("fa-bell",e>0).toggleClass("fa-bell-o",e<=0);const i=e>99?"99+":e;a.toggleClass("unread-count",e>0),a.attr("data-content",i),u.get("notifications/count").toggleClass("hidden",e<=0).text(i);const r={count:e,updateFavicon:!0};l.fire("action:notification.updateCount",r),r.updateFavicon&&m.setBubble(i),v.setAppBadge&&v.setAppBadge(e)},o.markAllRead=function(){socket.emit("notifications.markAllRead",function(e){e&&f.error(e),c={};const a=$('[component="notifications/list"] [data-nid]');a.removeClass("unread"),a.find(".mark-read .unread").addClass("hidden"),a.find(".mark-read .read").removeClass("hidden")})},o}.apply(D,b),T!==void 0&&(P.exports=T)},16943:(P,D,p)=>{var b,T;/*!
* Tinycon - A small library for manipulating the Favicon
* Tom Moor, http://tommoor.com
* Copyright (c) 2015 Tom Moor
* @license MIT Licensed
*/(function(){var h={},u=null,v=null,m=null,l=null,f={},o=Math.ceil(window.devicePixelRatio)||1,c=16*o,y={width:7,height:9,font:10*o+"px arial",color:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},s=function(){var t=navigator.userAgent.toLowerCase();return function(n){return t.indexOf(n)!==-1}}(),N={ie:s("trident"),chrome:s("chrome"),webkit:s("chrome")||s("safari"),safari:s("safari")&&!s("chrome"),mozilla:s("mozilla")&&!s("chrome")&&!s("safari")},e=function(){for(var t=document.getElementsByTagName("link"),n=0,d=t.length;n<d;n++)if((t[n].getAttribute("rel")||"").match(/\bicon\b/i))return t[n];return!1},a=function(){for(var t=document.getElementsByTagName("link"),n=0,d=t.length;n<d;n++){var E=typeof t[n]<"u";E&&(t[n].getAttribute("rel")||"").match(/\bicon\b/i)&&t[n].parentNode.removeChild(t[n])}},i=function(){if(!v||!u){var t=e();u=t?t.getAttribute("href"):"/favicon.ico",v||(v=u)}return u},r=function(){return l||(l=document.createElement("canvas"),l.width=c,l.height=c),l},k=function(t){if(t){a();var n=document.createElement("link");n.type="image/x-icon",n.rel="icon",n.href=t,document.getElementsByTagName("head")[0].appendChild(n)}},R=function(t){window.console&&window.console.log(t)},B=function(t,E){if(!r().getContext||N.ie||N.safari||f.fallback==="force")return O(t);var d=r().getContext("2d"),E=E||"#000000",S=i();m=document.createElement("img"),m.onload=function(){d.clearRect(0,0,c,c),d.drawImage(m,0,0,m.width,m.height,0,0,c,c),(t+"").length>0&&I(d,t,E),M()},!S.match(/^data/)&&f.crossOrigin&&(m.crossOrigin="anonymous"),m.src=S},O=function(t){if(f.fallback){var n=document.title;n[0]==="("&&(n=n.slice(n.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+n:document.title=n}},I=function(t,n,d){typeof n=="number"&&n>99&&f.abbreviate&&(n=U(n));var E=(n+"").length-1,S=f.width*o+6*o*E,_=f.height*o,F=c-_,w=c-S-o,C=16*o,A=16*o,g=2*o;t.font=(N.webkit?"bold ":"")+f.font,t.fillStyle=f.background,t.strokeStyle=f.background,t.lineWidth=o,t.beginPath(),t.moveTo(w+g,F),t.quadraticCurveTo(w,F,w,F+g),t.lineTo(w,C-g),t.quadraticCurveTo(w,C,w+g,C),t.lineTo(A-g,C),t.quadraticCurveTo(A,C,A,C-g),t.lineTo(A,F+g),t.quadraticCurveTo(A,F,A-g,F),t.closePath(),t.fill(),t.beginPath(),t.strokeStyle="rgba(0,0,0,0.3)",t.moveTo(w+g/2,C),t.lineTo(A-g/2,C),t.stroke(),t.fillStyle=f.color,t.textAlign="right",t.textBaseline="top",t.fillText(n,o===2?29:15,N.mozilla?7*o:6*o)},M=function(){r().getContext&&k(r().toDataURL())},U=function(t){for(var n=[["G",1e9],["M",1e6],["k",1e3]],d=0;d<n.length;++d)if(t>=n[d][1]){t=W(t/n[d][1])+n[d][0];break}return t},W=function(t,n){var d=new Number(t);return d.toFixed(n)};h.setOptions=function(t){f={},t.colour&&(t.color=t.colour);for(var n in y)f[n]=t.hasOwnProperty(n)?t[n]:y[n];return this},h.setImage=function(t){return u=t,M(),this},h.setBubble=function(t,n){return t=t||"",B(t,n),this},h.reset=function(){u=v,k(v)},h.setOptions(y),b=h,T=typeof b=="function"?b.call(D,p,D,P):b,T!==void 0&&(P.exports=T)})()}}]);
