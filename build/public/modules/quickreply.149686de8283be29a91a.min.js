(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[99098,70565,83014,99617,28306,43034,79191,3564,74344],{74344:(p,E,r)=>{"use strict";r.r(E),r.d(E,{del:()=>i,get:()=>o,head:()=>a,patch:()=>t,post:()=>c,put:()=>s});var b=r(85233),m=r.n(b),d=r(63281),h=r.n(d);const n=config.relative_path+"/api/v3";function f(e,l){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:n+e.url,typeof l=="function"){k(e,l);return}return new Promise((u,v)=>{k(e,function(g,y){if(g)return g.message==="A valid login session was not found. Please log in and try again."?(0,d.confirm)("[[error:api.reauth-required]]",A=>{A&&ajaxify.go("login")}):v(g);u(y)})})}async function k(e,l){const{url:u}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,b.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const v=await fetch(u,e),{headers:g}=v,y=g.get("content-type"),A=y&&y.startsWith("application/json");let x;if(A?x=await v.json():x=await v.text(),!v.ok)return l(new Error(A?x.status.message:x));l(null,A&&x.hasOwnProperty("status")&&x.hasOwnProperty("response")?x.response:x)}function o(e,l,u){return f({url:e+(l&&Object.keys(l).length?"?"+$.param(l):"")},u)}function a(e,l,u){return f({url:e+(l&&Object.keys(l).length?"?"+$.param(l):""),method:"head"},u)}function c(e,l,u){return f({url:e,method:"post",data:l,headers:{"x-csrf-token":config.csrf_token}},u)}function t(e,l,u){return f({url:e,method:"patch",data:l,headers:{"x-csrf-token":config.csrf_token}},u)}function s(e,l,u){return f({url:e,method:"put",data:l,headers:{"x-csrf-token":config.csrf_token}},u)}function i(e,l,u){return f({url:e,method:"delete",data:l,headers:{"x-csrf-token":config.csrf_token}},u)}},47913:(p,E,r)=>{p.exports=r(66485)},45482:(p,E,r)=>{p.exports=r(35729)},83713:(p,E,r)=>{p.exports=r(51077)},38259:(p,E,r)=>{p.exports=r(65616)},6e4:(p,E,r)=>{"use strict";var b,m;b=[r(7237),r(44541),r(2585),r(74344),r(7927),r(33371),r(42441),r(66603)],m=function(d,h,n,f,k,o,a,c){const t={};t.init=function(){const i=d.get("topic/quickreply/text"),e=`qr:draft:tid:${ajaxify.data.tid}`,l={element:i,strategies:[],options:{style:{"z-index":100}}};s(),$(window).one("action:ajaxify.start",()=>{s()}),$(window).trigger("composer:autocomplete:init",l),n._active.core_qr=n.setup(l),a.bind("ctrl+return",g=>{g.target===i.get(0)&&d.get("topic/quickreply/button").get(0).click()}),o.init({dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:i,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:i,route:"/api/post/upload",callback:function(g){let y=i.val();g.forEach(A=>{y=y+(y?`
`:"")+(A.isImage?"!":"")+`[${A.filename}](${A.url})`}),i.val(y)}});let u=!0;d.get("topic/quickreply/button").on("click",function(g){if(g.preventDefault(),!u)return;const y=d.get("topic/quickreply/text").val(),A={tid:ajaxify.data.tid,handle:void 0,content:y},x=y.length;if(x<parseInt(config.minimumPostLength,10))return k.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(x>parseInt(config.maximumPostLength,10))return k.error("[[error:content-too-long, "+config.maximumPostLength+"]]");u=!1,f.post(`/topics/${ajaxify.data.tid}`,A,function(S,P){if(u=!0,S)return k.error(S);P&&P.queued&&k.alert({type:"success",title:"[[global:alert.success]]",message:P.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${P.id}`)}}),d.get("topic/quickreply/text").val(""),c.removeItem(e),n._active.core_qr.hide()})});const v=c.getItem(e);v&&i.val(v),i.on("keyup",utils.debounce(function(){const g=i.val();g?c.setItem(e,g):c.removeItem(e)},1e3)),d.get("topic/quickreply/expand").on("click",g=>{g.preventDefault(),c.removeItem(e);const y=d.get("topic/quickreply/text");h.newReply({tid:ajaxify.data.tid,title:ajaxify.data.title,body:utils.escapeHTML(y.val())}),y.val("")})};function s(){n._active.core_qr&&(n._active.core_qr.destroy(),n._active.core_qr=null)}return t}.apply(E,b),m!==void 0&&(p.exports=m)},66603:(p,E,r)=>{"use strict";var b;b=function(){function m(){this._store={},this._keys=[]}m.prototype.isMock=!0,m.prototype.setItem=function(n,f){n=String(n),this._keys.indexOf(n)===-1&&this._keys.push(n),this._store[n]=f},m.prototype.getItem=function(n){return n=String(n),this._keys.indexOf(n)===-1?null:this._store[n]},m.prototype.removeItem=function(n){n=String(n),this._keys=this._keys.filter(function(f){return f!==n}),this._store[n]=null},m.prototype.clear=function(){this._keys=[],this._store={}},m.prototype.key=function(n){return n=parseInt(n,10)||0,this._keys[n]},Object.defineProperty&&Object.defineProperty(m.prototype,"length",{get:function(){return this._keys.length}});let d;const h=Date.now().toString();try{if(d=window.localStorage,d.setItem(h,h),d.getItem(h)!==h)throw Error("localStorage behaved unexpectedly");return d.removeItem(h),d}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(d=window.sessionStorage,d.setItem(h,h),d.getItem(h)!==h)throw Error("sessionStorage behaved unexpectedly");return d.removeItem(h),d}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new m}}}.call(E,r,E,p),b!==void 0&&(p.exports=b)},27145:(p,E,r)=>{"use strict";p=r.nmd(p);var b,m;b=[r(32230),r(85233)],m=function(d,h){const n={};let f=!1;n.init=function(){if(n.taskbar=$('[component="taskbar"]'),n.tasklist=n.taskbar.find("ul"),!n.taskbar.length||!n.tasklist.length){f=!0;return}n.taskbar.on("click","li",async function(){const t=$(this),s=t.attr("data-module"),i=t.attr("data-uuid"),e=await app.require(s);return t.hasClass("active")?e.minimize(i):(o(),e.load(i),n.toggleNew(i,!1),n.tasklist.removeClass("active"),t.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){n.closeAll()})},n.close=async function(t,s){if(f)return;if(n.tasklist.find('[data-module="'+p+'"][data-uuid="'+s+'"]').length){const e=await app.require(t);e&&typeof e.close=="function"&&e.close(s)}},n.closeAll=function(t){if(f)return;let s="[data-uuid]";t&&(s='[data-module="'+t+'"]'+s),n.tasklist.find(s).each(function(i,e){n.close(t||e.getAttribute("data-module"),e.getAttribute("data-uuid"))})},n.discard=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').remove(),k()},n.push=function(t,s,i,e){if(e=e||function(){},f)return e();const l=n.tasklist.find('li[data-uuid="'+s+'"]'),u={module:t,uuid:s,options:i,element:l};h.fire("filter:taskbar.push",u),!l.length&&u.module?a(u,e):e(l)},n.get=function(t){return f?[]:$('[data-module="'+t+'"]').map(function(i,e){return $(e).data()})},n.minimize=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').toggleClass("active",!1)},n.toggleNew=function(t,s,i){if(f)return;n.tasklist.find('[data-uuid="'+t+'"]').toggleClass("new",s),i||h.fire("action:taskbar.toggleNew",t)},n.updateActive=function(t){if(f)return;const s=n.tasklist.find("li");s.removeClass("active"),s.filter('[data-uuid="'+t+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+t+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},n.isActive=function(t){return f?!1:n.tasklist.find('li[data-uuid="'+t+'"]').hasClass("active")};function k(){if(f)return;n.tasklist.find("li").length>0?n.taskbar.attr("data-active","1"):n.taskbar.removeAttr("data-active")}function o(){f||n.tasklist.find(".active").removeClass("active")}function a(t,s){if(f)return s();d.translate(t.options.title,function(i){const e=$("<div></div>").text(i||"NodeBB Task").html(),l=$("<li></li>").addClass(t.options.className).html('<a href="#"'+(t.options.image?` style="background-image: url('`+t.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(t.options.icon?'<i class="fa '+t.options.icon+'"></i> ':"")+'<span aria-label="'+e+'" component="taskbar/title">'+e+"</span></a>").attr({title:e,"data-module":t.module,"data-uuid":t.uuid}).addClass(t.options.state!==void 0?t.options.state:"active");(!t.options.state||t.options.state==="active")&&o(),n.tasklist.append(l),k(),t.element=l,l.data(t),h.fire("action:taskbar.pushed",t),s(l)})}const c=function(t,s,i){switch(s){case"title":t.find('[component="taskbar/title"]').text(i);break;case"icon":t.find("i").attr("class","fa fa-"+i);break;case"image":t.find("a").css("background-image",i?'url("'+i.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":t.find("a").css("background-color",i);break;case"color":t.find("a").css("color",i);break}};return n.update=function(t,s,i){if(f)return;const e=n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]');if(!e.length)return;const l=e.data();Object.keys(i).forEach(function(u){l[u]=i[u],c(e,u,i[u])}),e.data(l)},n}.apply(E,b),m!==void 0&&(p.exports=m)},62023:(p,E,r)=>{"use strict";var b,m;b=[r(74344),r(63281),r(7927),r(50431),r(59006),r(32230),r(62526)],m=function(d,h,n,f,k,o){const a={};return a.get=c=>d.get(`/topics/${c}/thumbs`,{}),a.getByPid=c=>d.get(`/posts/${c}`,{}).then(t=>a.get(t.tid)),a.delete=(c,t)=>d.del(`/topics/${c}/thumbs`,{path:t}),a.deleteAll=c=>{a.get(c).then(t=>{Promise.all(t.map(s=>a.delete(c,s.url)))})},a.upload=c=>new Promise(t=>{f.show({title:"[[topic:composer.thumb_title]]",method:"put",route:config.relative_path+`/api/v3/topics/${c}/thumbs`},function(s){t(s)})}),a.modal={},a.modal.open=function(c){const{id:t,pid:s}=c;let{modal:i}=c,e;return new Promise(l=>{Promise.all([a.get(t),s?a.getByPid(s):[]]).then(u=>new Promise(v=>{const g=u.reduce((y,A)=>y.concat(A));e=g.length,v(g)})).then(u=>k.render("modals/topic-thumbs",{thumbs:u})).then(u=>{i?o.translate(u,function(v){i.find(".bootbox-body").html(v),a.modal.handleSort({modal:i,numThumbs:e})}):(i=h.dialog({title:"[[modules:thumbs.modal.title]]",message:u,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(a.upload(t).then(()=>{a.modal.open({...c,modal:i}),Promise.all([r.e(61006),r.e(42265),r.e(49915),r.e(8311)]).then(function(){var v=[r(44541)];(g=>{g.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),l()}).apply(null,v)}).catch(r.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),a.modal.handleDelete({...c,modal:i}),a.modal.handleSort({modal:i,numThumbs:e}))})})},a.modal.handleDelete=c=>{c.modal.get(0).addEventListener("click",s=>{s.target.closest('button[data-action="remove"]')&&h.confirm("[[modules:thumbs.modal.confirm-remove]]",i=>{if(!i)return;const e=s.target.closest("[data-id]").getAttribute("data-id"),l=s.target.closest("[data-path]").getAttribute("data-path");d.del(`/topics/${e}/thumbs`,{path:l}).then(()=>{a.modal.open(c)}).catch(n.error)})})},a.modal.handleSort=({modal:c,numThumbs:t})=>{if(t>1){const s=c.find(".topic-thumbs-modal");s.sortable({items:"[data-id]"}),s.on("sortupdate",a.modal.handleSortChange)}},a.modal.handleSortChange=(c,t)=>{const s=t.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(s).forEach((i,e)=>{const l=i.getAttribute("data-id");let u=i.getAttribute("data-path");u=u.replace(new RegExp(`^${config.upload_url}`),""),d.put(`/topics/${l}/thumbs/order`,{path:u,order:e}).catch(n.error)})},a}.apply(E,b),m!==void 0&&(p.exports=m)},50431:(p,E,r)=>{"use strict";var b,m;b=[r(86569)],m=function(){const d={};d.show=function(o,a){const c=o.hasOwnProperty("fileSize")&&o.fileSize!==void 0?parseInt(o.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:o.hasOwnProperty("showHelp")&&o.showHelp!==void 0?o.showHelp:!0,fileSize:c,title:o.title||"[[global:upload_file]]",description:o.description||"",button:o.button||"[[global:upload]]",accept:o.accept?o.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const s=t.find("#uploadForm");s.attr("action",o.route),s.find("#params").val(JSON.stringify(o.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),s.submit()}),s.submit(function(){return h(t,c,a),!1})})},d.hideAlerts=function(o){$(o).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function h(o,a,c){n(o,"status","[[uploads:uploading-file]]"),o.find("#upload-progress-bar").css("width","0%"),o.find("#upload-progress-box").show().removeClass("hide");const t=o.find("#fileInput");if(!t.val())return n(o,"error","[[uploads:select-file-to-upload]]");if(!k(t[0],a))return n(o,"error","[[error:file-too-big, "+a+"]]");d.ajaxSubmit(o,c)}function n(o,a,c){d.hideAlerts(o),a==="error"&&o.find("#fileUploadSubmitBtn").removeClass("disabled"),c=c.replace(/&amp;#44/g,"&#44"),o.find("#alert-"+a).translateText(c).removeClass("hide")}d.ajaxSubmit=function(o,a){o.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=f(t),n(o,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,s,i,e){o.find("#upload-progress-bar").css("width",e+"%")},success:function(t){let s=f(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(s=t.response.images),a(s[0].url),n(o,"success","[[uploads:upload-success]]"),setTimeout(function(){d.hideAlerts(o),o.modal("hide")},750)}})};function f(o){if(typeof o=="string")try{return JSON.parse(o)}catch{return{error:"[[error:parse-error]]"}}return o}function k(o,a){return window.FileReader&&a?o.files[0].size<=a*1e3:!0}return d}.apply(E,b),m!==void 0&&(p.exports=m)}}]);
