"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[48704,50613,66623,92128,19011],{29412:(S,F,f)=>{var D,x;D=[f(69941),f(60392),f(7237),f(74344),f(63281),f(7927)],x=function(T,P,g,h,p,o){const i={};i.init=function(){T.init(s),k(),$('[component="category/topic"]').each((n,c)=>{P.observeTopicLabels($(c).find('[component="topic/labels"]'))}),g.get("topic/delete").on("click",function(){return e("del","/state","delete",d),!1}),g.get("topic/restore").on("click",function(){return e("put","/state","restore",d),!1}),g.get("topic/purge").on("click",function(){return e("del","","purge",r),!1}),g.get("topic/lock").on("click",function(){return e("put","/lock","lock",t),!1}),g.get("topic/unlock").on("click",function(){return e("del","/lock","unlock",t),!1}),g.get("topic/pin").on("click",function(){return e("put","/pin","pin",t),!1}),g.get("topic/unpin").on("click",function(){return e("del","/pin","unpin",t),!1}),g.get("topic/mark-unread-for-all").on("click",function(){const n=T.getSelectedTids();return n.length?(socket.emit("topics.markAsUnreadForAll",n,function(c){if(c)return o.error(c);o.success("[[topic:markAsUnreadForAll.success]]"),n.forEach(function(l){$('[component="category/topic"][data-tid="'+l+'"]').addClass("unread")}),t()}),!1):o.error("[[error:no-topics-selected]]")}),g.get("topic/move").on("click",function(){return f.e(17434).then(function(){var n=[f(57378)];(function(c){const l=T.getSelectedTids();if(!l.length)return o.error("[[error:no-topics-selected]]");c.init(l,null,t)}).apply(null,n)}).catch(f.oe),!1}),g.get("topic/move-all").on("click",function(){const n=ajaxify.data.cid;if(!ajaxify.data.template.category)return o.error("[[error:invalid-data]]");f.e(17434).then(function(){var c=[f(57378)];(function(l){l.init(null,n,function(w){if(w)return o.error(w);ajaxify.refresh()})}).apply(null,c)}).catch(f.oe)}),g.get("topic/merge").on("click",function(){const n=T.getSelectedTids();f.e(90028).then(function(){var c=[f(90028)];(function(l){l.init(function(){n.length&&n.forEach(function(w){l.addTopic(w)})})}).apply(null,c)}).catch(f.oe)}),g.get("topic/tag").on("click",async function(){const n=T.getSelectedTids();if(!n.length)return o.error("[[error:no-topics-selected]]");const c=await Promise.all(n.map(l=>h.get(`/topics/${l}`)));f.e(62516).then(function(){var l=[f(62516)];(function(w){w.init(c,ajaxify.data.tagWhitelist,t)}).apply(null,l)}).catch(f.oe)}),i.removeListeners(),socket.on("event:topic_deleted",M),socket.on("event:topic_restored",M),socket.on("event:topic_purged",E),socket.on("event:topic_locked",u),socket.on("event:topic_unlocked",u),socket.on("event:topic_pinned",W),socket.on("event:topic_unpinned",W),socket.on("event:topic_moved",a)};function e(n,c,l,w){w||(w=function(){});const R=T.getSelectedTids(),I={},B=function(N){N&&Promise.all(R.map(K=>h[n](`/topics/${K}${c}`,I))).then(w).catch(o.error)};if(!R.length)return o.error("[[error:no-topics-selected]]");switch(l){case"delete":case"restore":case"purge":p.confirm(`[[topic:thread_tools.${l}_confirm]]`,B);break;case"pin":P.requestPinExpiry(I,B.bind(null,!0));break;default:B(!0);break}}i.removeListeners=function(){socket.removeListener("event:topic_deleted",M),socket.removeListener("event:topic_restored",M),socket.removeListener("event:topic_purged",E),socket.removeListener("event:topic_locked",u),socket.removeListener("event:topic_unlocked",u),socket.removeListener("event:topic_pinned",W),socket.removeListener("event:topic_unpinned",W),socket.removeListener("event:topic_moved",a)};function y(){$(".thread-tools .show").removeClass("show")}function t(){y(),T.unselectAll()}function d(){y(),s()}function r(){y(),T.unselectAll(),s()}function s(){const n=T.getSelectedTids(),c=v(m,n),l=A(m,n),w=v(L,n),R=v(C,n),I=v(b,n),B=A(b,n);g.get("topic/delete").toggleClass("hidden",c),g.get("topic/restore").toggleClass("hidden",I||!c),g.get("topic/purge").toggleClass("hidden",!l||!n.length),g.get("topic/lock").toggleClass("hidden",R),g.get("topic/unlock").toggleClass("hidden",!R),g.get("topic/pin").toggleClass("hidden",B||w),g.get("topic/unpin").toggleClass("hidden",B||!w),g.get("topic/merge").toggleClass("hidden",I)}function v(n,c){for(let l=0;l<c.length;l+=1)if(n(c[l]))return!0;return!1}function A(n,c){for(let l=0;l<c.length;l+=1)if(!n(c[l]))return!1;return!0}function m(n){return j(n).hasClass("deleted")}function C(n){return j(n).hasClass("locked")}function L(n){return j(n).hasClass("pinned")}function b(n){return j(n).hasClass("scheduled")}function j(n){return g.get("category/topic","tid",n)}function M(n){const c=j(n.tid);c.toggleClass("deleted",n.isDeleted),c.find('[component="topic/locked"]').toggleClass("hidden",!n.isDeleted)}function W(n){const c=j(n.tid);c.toggleClass("pinned",n.isPinned),c.find('[component="topic/pinned"]').toggleClass("hidden",!n.isPinned),ajaxify.refresh()}function u(n){const c=j(n.tid);c.toggleClass("locked",n.isLocked),c.find('[component="topic/locked"]').toggleClass("hidden",!n.isLocked)}function a(n){j(n.tid).remove()}function E(n){j(n.tid).remove()}function k(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const n=ajaxify.data.topics.filter(c=>c.pinned).length;!app.user.isAdmin&&!app.user.isMod||n<2||app.loadJQueryUI(function(){const c=$('[component="category"]').filter(function(w,R){return!$(R).parents("[widget-area],[data-widget-area]").length});let l=0;c.sortable({axis:"y",handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){l=parseInt(c.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(w,R){const I=R.item.attr("data-tid"),B=c.find('[component="category/topic"].pinned');let N=0;B.each((K,U)=>{if($(U).attr("data-tid")===I)return N=K,!1}),socket.emit("topics.orderPinnedTopics",{tid:I,order:l+N},function(K){if(K)return o.error(K);B.each((U,Y)=>{$(Y).attr("data-index",l+U)})})}})})}return i}.apply(F,D),x!==void 0&&(S.exports=x)},39941:(S,F,f)=>{var D,x;D=[f(22905),f(74344),f(85233)],x=function(T,P,g){const h={};h.init=function(o,i){if(!o||!o.length)return;i=i||{},i.states=i.states||["watching","notwatching","ignoring"],i.template=i.template||"partials/category/filter-dropdown-left",g.fire("action:category.filter.options",{el:o,options:i}),T.init(o,i);let e=[],y=[];Array.isArray(i.selectedCids)?e=i.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(e=ajaxify.data.selectedCids.map(String)),y=e.slice(),o.on("hidden.bs.dropdown",function(){let t=y.length!==e.length;if(y.forEach(function(d,r){d!==e[r]&&(t=!0)}),y=e.slice(),t&&(i.updateButton?i.updateButton({el:o,changed:t,selectedCids:e.slice()}):i.updateButton!==!1&&p(o,e)),i.onHidden){i.onHidden({changed:t,selectedCids:e.slice()});return}if(t){let d=window.location.pathname;const r=utils.params();e.length?r.cid=e:delete r.cid,delete r.page,Object.keys(r).length&&(d+="?"+decodeURIComponent($.param(r))),ajaxify.go(d)}}),o.on("click",'[component="category/list"] [data-cid]',function(){const t=o.find('[component="category/list"]'),d=$(this),r=d.find("a").attr("href");if(r&&r!=="#"&&r.length)return;const s=d.attr("data-cid"),v=d.find('[component="category/select/icon"]');return s!=="all"?(e.includes(s)?e.splice(e.indexOf(s),1):e.push(s),e.sort(function(A,m){return A-m}),v.toggleClass("invisible"),t.find('[data-cid="all"] i').toggleClass("invisible",!!e.length)):(o.find('[component="category/select/icon"]').addClass("invisible"),t.find('[data-cid="all"] i').removeClass("invisible"),e=[]),i.selectedCids=e,i.onSelect&&i.onSelect({cid:s,selectedCids:e.slice()}),!1})};function p(o,i){i.length>1?e({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):i.length===1?P.get(`/categories/${i[0]}`,{}).then(e):e();function e(y){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:y},function(t){o.find("button").replaceWith($("<div/>").html(t).find("button"))})}}return h}.apply(F,D),x!==void 0&&(S.exports=x)},22905:(S,F,f)=>{var D,x;D=[f(7927),f(73138)],x=function(T,P){const g={};return g.init=function(h,p){let o=null;p=p||{},p.privilege=p.privilege||"topics:read",p.states=p.states||["watching","notwatching","ignoring"],p.cacheList=p.hasOwnProperty("cacheList")?p.cacheList:!0;let i=[];Array.isArray(p.localCategories)&&(i=p.localCategories.map(r=>({...r}))),p.selectedCids=p.selectedCids||ajaxify.data.selectedCids||[];const e=h.find('[component="category-selector-search"]');if(!e.length)return;const y=e.parent('[component="category/dropdown"]').length>0||e.parent('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){y&&(h.find(".dropdown-toggle").css({visibility:"hidden"}),e.removeClass("hidden"),e.css({"z-index":h.find(".dropdown-toggle").css("z-index")+1}));function r(){const s=e.find("input").val();s.length>1||!s&&!o?t(s,function(v){o=p.cacheList&&(o||v),d(v)}):!s&&o&&d(o)}e.on("click",function(s){s.preventDefault(),s.stopPropagation()}),e.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),h.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||e.find("input").focus()}),h.on("hide.bs.dropdown",function(){y&&(h.find(".dropdown-toggle").css({visibility:"inherit"}),e.addClass("hidden")),e.off("click"),e.find("input").off("keyup")});function t(r,s){socket.emit("categories.categorySearch",{search:r,query:utils.params(),parentCid:p.parentCid||0,selectedCids:p.selectedCids,privilege:p.privilege,states:p.states,showLinks:p.showLinks},function(v,A){if(v)return T.error(v);s(i.concat(A))})}function d(r){const s=p.selectedCids.map(String);r.forEach(function(v){v.selected=s.includes(String(v.cid))}),app.parseAndTranslate(p.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(v){h.find('[component="category/list"]').html(v.find('[component="category/list"]').html()),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const A=P.Dropdown.getInstance(h.find(".dropdown-toggle").get(0));A&&A.update()})}},g}.apply(F,D),x!==void 0&&(S.exports=x)},66661:(S,F,f)=>{var D,x;D=[f(85233),f(7927),f(73138)],x=function(T,P,g){const h={};h.init=function(o,i){if(!o||!o.length)return;i=i||{},i.template="partials/tags/filter-dropdown-left",T.fire("action:tag.filter.options",{el:o,options:i});const e=o.find('[component="tag/filter/search"]');i.selectedTags=i.selectedTags||ajaxify.data.selectedTags||[];let y=null,t=[],d=[];Array.isArray(i.selectedTags)?t=i.selectedTags.map(String):Array.isArray(ajaxify.data.selectedTags)&&(t=ajaxify.data.selectedTags.map(String)),d=t.slice();const r=e.parent('[component="tag/filter"]').length&&app.user.privileges["search:tags"];o.on("show.bs.dropdown",function(){r&&(o.find(".dropdown-toggle").css({visibility:"hidden"}),e.removeClass("hidden"),e.css({"z-index":o.find(".dropdown-toggle").css("z-index")+1}));function A(){const m=e.find("input").val();m.length>1||!m&&!y?s(m,function(C){y=y||C,v(C)}):!m&&y&&v(y)}e.on("click",function(m){m.preventDefault(),m.stopPropagation()}),e.find("input").val("").on("keyup",utils.debounce(A,300)),A()}),o.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||e.find("input").focus()}),o.on("hidden.bs.dropdown",function(){r&&(o.find(".dropdown-toggle").css({visibility:"inherit"}),e.addClass("hidden")),e.off("click"),e.find("input").off("keyup");let A=d.length!==t.length;if(d.forEach(function(m,C){m!==t[C]&&(A=!0)}),d=t.slice(),A&&(i.updateButton?i.updateButton({el:o,changed:A,selectedTags:t.slice()}):i.updateButton!==!1&&p(o,t)),i.onHidden){i.onHidden({changed:A,selectedTags:t.slice()});return}if(A){let m=window.location.pathname;const C=utils.params();t.length?C.tag=t.length?t:void 0:delete C.tag,delete C.page,Object.keys(C).length&&(m+="?"+decodeURIComponent($.param(C))),ajaxify.go(m)}}),o.on("click",'[component="tag/filter/list"] [data-tag]',function(){const A=o.find('[component="tag/filter/list"]'),m=$(this),C=m.find("a").attr("href");if(C&&C!=="#"&&C.length)return;const L=m.attr("data-tag"),b=m.find('[component="tag/select/icon"]');return L!==""?(t.includes(L)?t.splice(t.indexOf(L),1):t.push(L),t.sort(function(j,M){return j-M}),b.toggleClass("invisible")):(o.find('[component="tag/select/icon"]').addClass("invisible"),t=[]),A.find('[data-tag=""] i').toggleClass("invisible",!!t.length),i.selectedTags=t,i.onSelect&&i.onSelect({tag:L,selectedTags:t.slice()}),!1});function s(A,m){let C=null;ajaxify.data.template.category?C=[ajaxify.data.cid]:Array.isArray(ajaxify.data.selectedCids)&&ajaxify.data.selectedCids.length&&(C=ajaxify.data.selectedCids),socket.emit("topics.tagFilterSearch",{query:A,cids:C},function(L,b){if(L)return P.error(L);m(b)})}function v(A){const m=i.selectedTags;A.forEach(function(C){C.selected=m.includes(C.valueEscaped)}),app.parseAndTranslate(i.template,{tagItems:A.slice(0,200),selectedTag:ajaxify.data.selectedTag},function(C){o.find('[component="tag/filter/list"]').html(C.find('[component="tag/filter/list"]').html());const L=g.Dropdown.getInstance(o.find(".dropdown-toggle").get(0));L&&L.update()})}};function p(o,i){i.length>0?e({label:i.join(", ")}):e();function e(y){app.parseAndTranslate("partials/tags/filter-dropdown-content",{selectedTag:y},function(t){o.find("button").replaceWith($("<div/>").html(t).find("button"))})}}return h}.apply(F,D),x!==void 0&&(S.exports=x)},14745:(S,F,f)=>{var D,x;D=[f(25142),f(66044),f(69941),f(39941),f(66661),f(29412),f(85233)],x=function(T,P,g,h,p,o,i){const e={};let y="",t=0,d=0,r,s;const v=[];$(window).on("action:ajaxify.start",function(){e.removeListeners(),o.removeListeners()}),e.init=function(u,a){s=A(),y=u,r=a||j,o.init(),e.watchForNewPosts();const E=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?E.push("notwatching","ignoring"):u!=="unread"&&E.push("notwatching"),h.init($('[component="category/dropdown"]'),{states:E}),p.init($('[component="tag/filter"]')),config.usePagination||T.init(e.loadMoreTopics),P.init(function(k,n){r(k,1,function(c,l){W(y,c.topics,ajaxify.data.showSelect,1,function(){n(),l()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){e.loadMoreTopics(1)}),i.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function A(){return $('[component="category"]').filter(function(u,a){return!$(a).parents("[widget-area],[data-widget-area]").length})}e.watchForNewPosts=function(){d=0,t=0,e.removeListeners(),socket.on("event:new_topic",m),socket.on("event:new_post",C)},e.removeListeners=function(){socket.removeListener("event:new_topic",m),socket.removeListener("event:new_post",C)};function m(u){const a=ajaxify.data,E=a.selectedCids&&a.selectedCids.length&&a.selectedCids.indexOf(parseInt(u.cid,10))===-1,k=a.selectedFilter&&a.selectedFilter.filter==="watched",n=a.template.category&&parseInt(a.cid,10)!==parseInt(u.cid,10),c=!!(E||k||n||v.includes(u.tid));i.fire("filter:topicList.onNewTopic",{topic:u,preventAlert:c}).then(l=>{l.preventAlert||(u.scheduled&&u.tid&&v.push(u.tid),t+=1,L())})}function C(u){const a=u.posts[0];if(!a||!a.topic||a.topic.isFollowing)return;const E=ajaxify.data,k=parseInt(a.topic.mainPid,10)===parseInt(a.pid,10),n=E.selectedCids&&E.selectedCids.length&&E.selectedCids.indexOf(parseInt(a.topic.cid,10))===-1,c=E.selectedFilter&&E.selectedFilter.filter==="new",l=E.selectedFilter&&E.selectedFilter.filter==="watched"&&!a.topic.isFollowing,w=E.template.category&&parseInt(E.cid,10)!==parseInt(a.topic.cid,10),R=!!(k||n||c||l||w);i.fire("filter:topicList.onNewPost",{post:a,preventAlert:R}).then(I=>{I.preventAlert||(d+=1,L())})}function L(){(t>0||d>0)&&($("#new-topics-alert").removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide"))}e.loadMoreTopics=function(u){if(!s.length||!s.children().length)return;const a=s.find('[component="category/topic"]'),E=u>0?a.last():a.first(),k=(parseInt(E.attr("data-index"),10)||0)+(u>0?1:0);!utils.isNumber(k)||k===0&&s.find('[component="category/topic"][data-index="0"]').length||r(k,u,function(n,c){W(y,n.topics,ajaxify.data.showSelect,u,c)})};function b(u,a){return Math.floor(u/config.topicsPerPage)+(a>0?1:0)}function j(u,a,E){E=E||function(){};const k=utils.params();k.page=b(u,a),T.loadMoreXhr(k,E)}function M(u){return u.filter(function(a){return!s.find('[component="category/topic"][data-tid="'+a.tid+'"]').length})}function W(u,a,E,k,n){if(!a||!a.length||(a=M(a),!a.length))return $("#load-more-btn").hide(),n();let c,l;const w=s.find('[component="category/topic"]');k>0&&a.length?c=w.last():k<0&&a.length&&(l=w.first());const R={topics:a,showSelect:E,template:{name:u}};R.template[u]=!0,i.fire("action:topics.loading",{topics:a,after:c,before:l}),app.parseAndTranslate(u,"topics",R,function(I){if(s.removeClass("hidden"),$("#category-no-topics").remove(),c&&c.length)I.insertAfter(c);else if(l&&l.length){const B=$(document).height(),N=$(window).scrollTop();I.insertBefore(l),$(window).scrollTop(N+($(document).height()-B))}else s.append(I);g.getSelectedTids().length||T.removeExtra(s.find('[component="category/topic"]'),k,Math.max(60,config.topicsPerPage*3)),I.find(".timeago").timeago(),i.fire("action:topics.loaded",{topics:a,template:u}),n()})}return e}.apply(F,D),x!==void 0&&(S.exports=x)},69941:(S,F,f)=>{var D,x;D=[f(7237)],x=function(T){const P={};let g,h;P.init=function(t){h=$('[component="category"]'),h.on("selectstart",'[component="topic/select"]',function(d){d.preventDefault()}),h.on("click",'[component="topic/select"]',function(d){const s=$(this).parents('[component="category/topic"]');if(d.shiftKey)return i(s.attr("data-tid")),g=s,!1;const v=s.hasClass("selected");p(s,!v),g=s,typeof t=="function"&&t()})};function p(t,d){const r=t.find('[component="topic/select"]');r.toggleClass("fa-check-square-o",d),r.toggleClass("fa-square-o",!d),r.parents('[component="category/topic"]').toggleClass("selected",d),o()}function o(){const t=$('[component="topic/selected/badge"]');if(t.length){const d=h.find('[component="category/topic"].selected').length;t.text(d>0?d:"")}}P.getSelectedTids=function(){const t=[];return h&&h.find('[component="category/topic"].selected').each(function(){t.push($(this).attr("data-tid"))}),t},P.unselectAll=function(){h&&(h.find('[component="category/topic"].selected').removeClass("selected"),h.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0),o())};function i(t){g||(g=$('[component="category/topic"]').first());const d=T.get("category/topic","tid",t).hasClass("selected"),r=y(t),s=y(g.attr("data-tid"));e(r,s,!d)}function e(t,d,r){if(t>d){const s=t;t=d,d=s}for(let s=t;s<=d;s+=1){const v=$('[component="category/topic"]').eq(s);p(v,r)}}function y(t){return T.get("category/topic","tid",t).index('[component="category/topic"]')}return P}.apply(F,D),x!==void 0&&(S.exports=x)}}]);
