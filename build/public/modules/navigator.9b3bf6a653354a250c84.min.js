"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[38786,82344,28306],{78989:(E,M,T)=>{var P,w;P=[T(63281)],w=function(g){const l={};return l.init=function(){$("body").on("click",'[component="pagination/select-page"]',function(){return g.prompt("[[global:enter_page_number]]",function(i){l.loadPage(i)}),!1})},l.loadPage=function(i,b){if(b=b||function(){},i=parseInt(i,10),!utils.isNumber(i)||i<1||i>ajaxify.data.pagination.pageCount)return;const _=utils.params();_.page=i;const R=window.location.pathname+"?"+$.param(_);ajaxify.go(R,b)},l.nextPage=function(i){l.loadPage(ajaxify.data.pagination.currentPage+1,i)},l.previousPage=function(i){l.loadPage(ajaxify.data.pagination.currentPage-1,i)},l}.apply(M,P),w!==void 0&&(E.exports=w)},42840:(E,M,T)=>{var P,w;P=[T(78989),T(7237),T(85233),T(7927),T(32230),T(66603)],w=function(g,l,i,b,_,R){const o={};let r=0,y=0,B=0,K,S,O,A,W,C=!1,j=!0,H="";o.scrollActive=!1;let s=$(".pagination-block"),F=s.find(".pagination-text"),tt=s.find("meter"),ot=s.find(".progress-bar"),X=s.find(".unread"),v;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",J)}),o.init=function(t,e,a,n,h){r=0,o.selector=t,o.callback=h,o.toTop=a||function(){},o.toBottom=n||function(){},s=$(".pagination-block"),F=s.find(".pagination-text"),tt=s.find("meter"),ot=s.find(".progress-bar"),X=s.find(".unread"),v=$(".scroller-thumb"),H=utils.findBootstrapEnvironment(),$(window).off("scroll",o.delayedUpdate).on("scroll",o.delayedUpdate),s.find(".dropdown-menu").off("click").on("click",function(u){u.stopPropagation()}),s.off("shown.bs.dropdown",".wrapper").on("shown.bs.dropdown",".wrapper",function(){const u=$(this);setTimeout(async function(){["lg","xl","xxl"].includes(utils.findBootstrapEnvironment())&&u.find("input").trigger("focus"),await socket.emit("topics.getPostCountInTopic",ajaxify.data.tid)>0&&s.find("#myNextPostBtn").removeAttr("disabled")},100)}),s.find(".pageup").off("click").on("click",o.scrollUp),s.find(".pagedown").off("click").on("click",o.scrollDown),s.find(".pagetop").off("click").on("click",o.toTop),s.find(".pagebottom").off("click").on("click",o.toBottom),s.find(".pageprev").off("click").on("click",g.previousPage),s.find(".pagenext").off("click").on("click",g.nextPage),s.find("#myNextPostBtn").off("click").on("click",at),s.find("input").on("keydown",function(u){if(u.which===13){const d=$(this);if(!utils.isNumber(d.val())){d.val("");return}const x=parseInt(d.val(),10),f=U(x);d.val(""),s.find(".dopdown-menu.show").removeClass("show"),ajaxify.go(f)}}),ajaxify.data.template.topic&&(st(),B=ajaxify.data.postcount,nt(ajaxify.data.postIndex)),ct(),o.setCount(e),o.update()};let L=0;async function at(){async function t(e){return await socket.emit("topics.getMyNextPostIndex",{tid:ajaxify.data.tid,index:Math.max(1,e),sort:config.topicPostSort})}if(ajaxify.data.template.topic){let e=await t(r);L===e&&(e=await t(e)),e&&r!==e+1?(L=e,$(window).one("action:ajaxify.end",function(){s.find(".dropdown-menu").is(":hidden")&&s.find(".dropdown-toggle").dropdown("toggle")}),o.scrollToIndex(e,!0,0)):(b.alert({message:"[[topic:no-more-next-post]]",type:"info"}),L=1)}}function N(t,e){const a=t.parent(),n=a.offset(),u=t.find(".scroller-thumb-icon").height();return e<n.top?e=n.top:e>n.top+a.height()-u&&(e=n.top+a.height()-u),e}function D(t){!v||!v.length||!v.is(":visible")||(v.each((e,a)=>{const n=$(a);if(n.is(":hidden"))return;const h=n.parent(),u=h.offset(),x=n.find(".scroller-thumb-icon").height(),f=(h.height()-x)/(ajaxify.data.postcount-1),c={top:N(n,u.top+(t-1)*f),left:n.offset().left};n.offset(c),V(n,t),et(n,t)}),nt(t),G(t))}function V(t,e){H==="xs"||H==="sm"||H==="md"?t.find(".thumb-text").text(`${e}/${ajaxify.data.postcount}`):t.find(".thumb-text").translateText(`[[topic:navigator.index, ${e}, ${ajaxify.data.postcount}]]`)}async function et(t,e){const a=t.find(".thumb-timestamp");if(a.length){const n=await it(e);a.attr("title",utils.toISOString(n)).timeago()}}async function it(t){const e=$(`[component="post"][data-index=${t-1}]`);return e.length?parseInt(e.attr("data-timestamp"),10):await socket.emit("posts.getPostTimestampByIndex",{tid:ajaxify.data.tid,index:t-1})}function st(){if(!v.length)return;v.parent().off("click").on("click",function(f){if($(f.target).hasClass("scroller-container")){const m=$(f.target).find(".scroller-thumb"),c=e(m,f.pageY);return o.scrollToIndex(c-1,!0,0),!1}});function e(f,m){const c=f.parent(),I=f.find(".scroller-thumb-icon").height(),k=N(f,m-I/2),Q=c.offset(),Z=(k-Q.top)/(c.height()-I);return r=Math.max(1,Math.ceil(ajaxify.data.postcount*Z)),r>ajaxify.data.postcount?ajaxify.data.postcount:r}let a=!1;i.on("action:ajaxify.end",function(){W=null}),s.find(".dropdown-menu").parent().off("shown.bs.dropdown").on("shown.bs.dropdown",function(){D(r)});let n=null;const h=utils.debounce(et,50);function u(f){if(!n||!n.length)return;const c=n.find(".scroller-thumb-icon").height(),p=N(n,f.pageY-c/2);n.offset({top:p,left:n.offset().left});const I=e(n,f.pageY);return o.updateTextAndProgressBar(),V(n,I),h(n,I),j&&x(),j=!1,f.stopPropagation(),!1}v.off("mousedown").on("mousedown",function(f){f.originalEvent.button===0&&(a=!0,n=$(this),n.addClass("active"),$(window).on("mousemove",u),j=!0)});function d(){$(window).off("mousemove",u),a&&(o.scrollToIndex(r-1,!0,0),s.find(".dropdown-menu.show").removeClass("show")),z(),a=!1,j=!1,n&&n.length&&n.removeClass("active"),n=null}function x(){z(),S=setInterval(function(){G(r)},250)}$(window).off("mousemove",u),$(window).off("mouseup",d).on("mouseup",d),v.each((f,m)=>{const c=$(m);c.off("touchstart").on("touchstart",function(p){C=!0,O=Math.min($(window).width(),Math.max(0,p.touches[0].clientX)),A=Math.min($(window).height(),Math.max(0,p.touches[0].clientY)),j=!0,c.addClass("active")}),c.off("touchmove").on("touchmove",function(p){const I=$(window).width(),k=$(window).height(),Q=Math.abs(O-Math.min(I,Math.max(0,p.touches[0].clientX))),Z=Math.abs(A-Math.min(k,Math.max(0,p.touches[0].clientY)));if(O=Math.min(I,Math.max(0,p.touches[0].clientX)),A=Math.min(k,Math.max(0,p.touches[0].clientY)),Z>=Q&&j&&(C=!0,x()),C&&p.cancelable){p.preventDefault(),p.stopPropagation();const rt=c.find(".scroller-thumb-icon").height(),lt=N(c,A+$(window).scrollTop()-rt/2);c.offset({top:lt,left:c.offset().left});const q=e(c,A+$(window).scrollTop());o.updateTextAndProgressBar(),V(c,q),h(c,q),j&&G(q)}j=!1}),c.off("touchend").on("touchend",function(){z(),C&&(c.removeClass("active"),o.scrollToIndex(r-1,!0,0),C=!1,s.find(".dropdown-menu.show").removeClass("show"))})})}async function nt(t){if(!X.length||ajaxify.data.postcount<=ajaxify.data.bookmarkThreshold)return;const e=ajaxify.data.bookmark||R.getItem("topic:"+ajaxify.data.tid+":bookmark");t=Math.max(t,Math.min(e,ajaxify.data.postcount));const a=X.get(0),n=a.parentNode,h=n.getBoundingClientRect().height,u=1-t/ajaxify.data.postcount;a.style.height=`${h*u}px`;const d=n.querySelector(".scroller-thumb"),x=parseInt(d.style.height,10),f=parseInt(d.style.top||0,10)+x,m=a.querySelector(".meta a");if(B=Math.min(B,ajaxify.data.postcount-t),B>0&&h-f>=x){const c=await _.translate(`[[topic:navigator.unread, ${B}]]`);m.href=`${config.relative_path}/topic/${ajaxify.data.slug}/${Math.min(t+1,ajaxify.data.postcount)}`,m.innerText=c}else m.href=ajaxify.data.url,m.innerText=""}function z(){S&&(clearInterval(S),S=0)}async function G(t){if(!t||W===t||!s.find(".post-content").is(":visible"))return;W=t;const e=await socket.emit("posts.getPostSummaryByIndex",{tid:ajaxify.data.tid,index:t-1}),a=await app.parseAndTranslate("partials/topic/navigation-post",{post:e});s.find(".post-content").html(a).find(".timeago").timeago()}function ct(){config.usePagination||$(window).off("keydown",J).on("keydown",J)}function J(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey)return;if(t.which===36&&o.toTop)return o.toTop(),!1;if(t.which===35&&o.toBottom)return o.toBottom(),!1}}function U(t){const a=window.location.pathname.replace(config.relative_path,"").split("/");return a[1]+"/"+a[2]+"/"+a[3]+(t?"/"+t:"")}o.getCount=()=>y,o.setCount=function(t){t=parseInt(t,10),t!==y&&(y=t,o.updateTextAndProgressBar(),D(r),Y(y>0))},o.show=function(){Y(!0)},o.disable=function(){y=0,r=1,o.callback=null,o.selector=null,$(window).off("scroll",o.delayedUpdate),Y(!1)};function Y(t){const e=ajaxify.removeRelativePath(window.location.pathname.slice(1));t&&!e.startsWith("topic")&&!e.startsWith("category")||(s.toggleClass("ready",t),s.toggleClass("noreplies",y<=1))}return o.delayedUpdate=function(){K||(K=setTimeout(function(){o.update(),K=void 0},100))},o.update=function(){let t=r;const e=$(o.selector);e.length&&(t=parseInt(e.first().attr("data-index"),10)+1);const a=$(window).scrollTop(),n=$(window).height(),h=$(document).height(),u=a+n/2;let d=Number.MAX_VALUE;e.each(function(){const m=$(this),c=parseInt(m.attr("data-index"),10);if(c>=0){const p=Math.abs(u-(m.offset().top+m.outerHeight(!0)/2));if(p>d)return!1;p<d&&(t=c+1,d=p)}});const x=a===0&&parseInt(e.first().attr("data-index"),10)===0,f=a+n>h-100&&parseInt(e.last().attr("data-index"),10)===y-1;x?t=1:f&&(t=y),i.fire("action:navigator.update",{newIndex:t,index:r}),t!==r&&(typeof o.callback=="function"&&o.callback(t,y),r=t,o.updateTextAndProgressBar(),D(r)),Y(y>0)},o.getIndex=()=>r,o.setIndex=t=>{r=t+1,typeof o.callback=="function"&&o.callback(r,y),o.updateTextAndProgressBar(),D(r)},o.updateTextAndProgressBar=function(){if(!utils.isNumber(r))return;r=r>y?y:r,config.usePagination?F.html(`<i class="fa fa-file"></i> ${ajaxify.data.pagination.currentPage} / ${ajaxify.data.pagination.pageCount}`):F.translateHtml("[[global:pagination.out_of, "+r+", "+y+"]]");const t=(r-1)/(y-1||1);tt.val(t),ot.width(t*100+"%")},o.scrollUp=function(){const t=$(window);if(config.usePagination&&t.scrollTop()<=0)return g.previousPage(function(){$("body,html").scrollTop($(document).height()-t.height())});$("body,html").animate({scrollTop:t.scrollTop()-t.height()})},o.scrollDown=function(){const t=$(window);if(config.usePagination&&t.scrollTop()>=$(document).height()-t.height())return g.nextPage();$("body,html").animate({scrollTop:t.scrollTop()+t.height()})},o.scrollTop=function(t){$(o.selector+'[data-index="'+t+'"]').length?o.scrollToIndex(t,!0):ajaxify.go(U())},o.scrollBottom=function(t){parseInt(t,10)<0||($(o.selector+'[data-index="'+t+'"]').length?o.scrollToIndex(t,!0):(t=parseInt(t,10)+1,ajaxify.go(U(t))))},o.scrollToIndex=function(t,e,a){const n=!!l.get("topic").length,h=!!l.get("category").length;if(!utils.isNumber(t)||!n&&!h)return;if(a=a!==void 0?a:400,o.scrollActive=!0,n&&l.get("post/anchor",t).length)return o.scrollToPostIndex(t,e,a);if(h&&$('[component="category/topic"][data-index="'+t+'"]').length)return o.scrollToTopicIndex(t,e,a);if(!config.usePagination){o.scrollActive=!1,t=parseInt(t,10)+1,ajaxify.go(U(t));return}const u=n?o.scrollToPostIndex:o.scrollToTopicIndex,d=1+Math.floor(t/config.postsPerPage);parseInt(d,10)!==ajaxify.data.pagination.currentPage?g.loadPage(d,function(){u(t,e,a)}):u(t,e,a)},o.shouldScrollToPost=function(t){if(!ajaxify.data.template.topic||t<=1)return!1;const e=$('[component="topic"] [component="post"]').first();return parseInt(e.attr("data-index"),10)!==t-1},o.scrollToPostIndex=function(t,e,a){const n=l.get("post","index",t);o.scrollToElement(n,e,a,t)},o.scrollToTopicIndex=function(t,e,a){const n=$('[component="category/topic"][data-index="'+t+'"]');o.scrollToElement(n,e,a,t)},o.scrollToElement=async(t,e,a,n=null)=>{if(!t.length){o.scrollActive=!1;return}await i.fire("filter:navigator.scroll",{scrollTo:t,highlight:e,duration:a,newIndex:n+1});const h=t.outerHeight(!0),u=l.get("navbar").outerHeight(!0)||0,d=$(".topic-main-buttons").outerHeight(!0)||0,x=$(window).height();$(window).off("scroll",o.delayedUpdate),a=a!==void 0?a:400,o.scrollActive=!0;let f=!1;function m(){function p(){setTimeout(()=>{$(window).off("scroll",o.delayedUpdate).on("scroll",o.delayedUpdate),i.fire("action:navigator.scrolled",{scrollTo:t,highlight:e,duration:a,newIndex:n+1})},50)}function I(){if(f){p();return}f=!0,o.scrollActive=!1,c(),n?o.setIndex(n):o.update()}let k=0;if(h<x-u-d?k=t.offset().top-x/2+h/2:k=t.offset().top-u-d,a===0){$(window).scrollTop(k),I(),p();return}$("html, body").animate({scrollTop:k+"px"},a,I)}function c(){e&&($('[component="post"],[component="category/topic"]').removeClass("highlight"),t.addClass("highlight"),setTimeout(function(){t.removeClass("highlight")},1e4))}m()},o}.apply(M,P),w!==void 0&&(E.exports=w)},66603:(E,M,T)=>{var P;P=function(){function w(){this._store={},this._keys=[]}w.prototype.isMock=!0,w.prototype.setItem=function(i,b){i=String(i),this._keys.indexOf(i)===-1&&this._keys.push(i),this._store[i]=b},w.prototype.getItem=function(i){return i=String(i),this._keys.indexOf(i)===-1?null:this._store[i]},w.prototype.removeItem=function(i){i=String(i),this._keys=this._keys.filter(function(b){return b!==i}),this._store[i]=null},w.prototype.clear=function(){this._keys=[],this._store={}},w.prototype.key=function(i){return i=parseInt(i,10)||0,this._keys[i]},Object.defineProperty&&Object.defineProperty(w.prototype,"length",{get:function(){return this._keys.length}});let g;const l=Date.now().toString();try{if(g=window.localStorage,g.setItem(l,l),g.getItem(l)!==l)throw Error("localStorage behaved unexpectedly");return g.removeItem(l),g}catch(i){console.warn(i),console.warn("localStorage failed, falling back on sessionStorage");try{if(g=window.sessionStorage,g.setItem(l,l),g.getItem(l)!==l)throw Error("sessionStorage behaved unexpectedly");return g.removeItem(l),g}catch(b){return console.warn(b),console.warn("sessionStorage failed, falling back on memory storage"),new w}}}.call(M,T,M,E),P!==void 0&&(E.exports=P)}}]);
