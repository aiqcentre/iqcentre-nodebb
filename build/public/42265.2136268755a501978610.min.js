"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[42265],{35127:(Q,G,l)=>{var M,L;M=[l(27145),l(32230),l(22143),l(45482),l(47913),l(88186),l(98755),l(83713),l(38259),l(2585),l(98166),l(75203),l(62023),l(74344),l(63281),l(7927),l(85233),l(44882),l(7073),l(10577)],L=function(A,P,B,w,y,f,O,s,r,n,d,m,h,b,T,C,a,g,p,D){var i={active:void 0,posts:{},bsEnvironment:void 0,formatting:void 0};$(window).off("resize",N).on("resize",N),N(),$(window).on("action:composer.topics.post",function(e,t){localStorage.removeItem("category:"+t.data.cid+":bookmark"),localStorage.removeItem("category:"+t.data.cid+":bookmark:clicked")}),$(window).on("popstate",function(){var e=utils.findBootstrapEnvironment();if(i.active&&(e==="xs"||e==="sm")){if(!i.posts[i.active].modified){i.discard(i.active),i.discardConfirm&&i.discardConfirm.length&&(i.discardConfirm.modal("hide"),delete i.discardConfirm);return}P.translate("[[modules:composer.discard]]",function(t){i.discardConfirm=T.confirm(t,function(o){o?i.discard(i.active):i.posts[i.active].modified=!0}),i.posts[i.active].modified=!1})}});function H(){var e=i.bsEnvironment;(ajaxify.data.template.compose===!0||e==="xs"||e==="sm")&&history.back()}function N(){var e=utils.findBootstrapEnvironment(),t=e==="xs"||e==="sm";s.toggle&&(s.env!==e&&t&&(s.env=e,s.toggle(!1)),s.env=e),i.active!==void 0&&(r.reposition($('.composer[data-uuid="'+i.active+'"]')),!t&&window.location.pathname.startsWith(config.relative_path+"/compose")?history.back():t&&!window.location.pathname.startsWith(config.relative_path+"/compose")&&te()),i.bsEnvironment=e}function Z(e){var t,o;e.hasOwnProperty("cid")?t="cid":e.hasOwnProperty("tid")?t="tid":e.hasOwnProperty("pid")&&(t="pid"),o=e[t];for(var v in i.posts)if(i.posts[v].hasOwnProperty(t)&&o===i.posts[v][t])return v;return!1}function u(e){if(e){var t=utils.generateUUID(),o=Z(e);if(o)return A.updateActive(o),i.load(o);var v="[[topic:composer.new_topic]]";e.action==="posts.reply"?v="[[topic:composer.replying_to]]":e.action==="posts.edit"&&(v="[[topic:composer.editing-in]]"),P.translate(v,function(E){A.push("composer",t,{title:E.replace("%1",'"'+e.title+'"')})}),i.posts[t]=e,i.load(t)}}async function c(e,t){$('.composer[data-uuid="'+e+'"]').find(".composer-submit").removeAttr("disabled");const{showAlert:o}=await a.fire("filter:composer.error",{post_uuid:e,message:t,showAlert:!0});o&&C.alert({type:"danger",timeout:1e4,title:"",message:t,alert_id:"post_error"})}i.findByTid=function(e){for(var t in i.posts)if(i.posts.hasOwnProperty(t)&&i.posts[t].hasOwnProperty("tid")&&parseInt(i.posts[t].tid,10)===parseInt(e,10))return t;return null},i.addButton=function(e,t,o){w.addButton(e,t,o)},i.newTopic=async e=>{let t={save_id:e.save_id,action:"topics.post",cid:e.cid,handle:e.handle,title:e.title||"",body:e.body||"",tags:e.tags||[],modified:!!(e.title&&e.title.length||e.body&&e.body.length),isMain:!0};({pushData:t}=await a.fire("filter:composer.topic.push",{data:e,pushData:t})),u(t)},i.addQuote=function(e){e.uuid=e.uuid||i.active;var t=(e.title||"").replace(/([\\`*_{}[\]()#+\-.!])/g,"\\$1").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;").replace(/%/g,"&#37;").replace(/,/g,"&#44;");e.body&&(e.body="> "+e.body.replace(/\n/g,`
> `)+`

`);var o="["+t+"]("+config.relative_path+"/post/"+(e.selectedPid||e.toPid)+")";if(e.uuid===void 0){e.title&&(e.selectedPid||e.toPid)?i.newReply({tid:e.tid,toPid:e.toPid,title:e.title,body:"[[modules:composer.user_said_in, "+e.username+", "+o+`]]
`+e.body}):i.newReply({tid:e.tid,toPid:e.toPid,title:e.title,body:"[[modules:composer.user_said, "+e.username+`]]
`+e.body});return}else e.uuid!==i.active&&i.load(e.uuid);var v=$('.composer[data-uuid="'+e.uuid+'"]'),E=v.find("textarea"),x=E.val();e.title&&(e.selectedPid||e.toPid)?P.translate("[[modules:composer.user_said_in, "+e.username+", "+o+`]]
`,config.defaultLang,j):P.translate("[[modules:composer.user_said, "+e.username+`]]
`,config.defaultLang,j);function j(V){i.posts[e.uuid].body=(x.length?x+`

`:"")+V+e.body,E.val(i.posts[e.uuid].body),R(v),s.render(v)}},i.newReply=function(e){P.translate(e.body,config.defaultLang,function(t){u({save_id:e.save_id,action:"posts.reply",tid:e.tid,toPid:e.toPid,title:e.title,body:t,modified:!!(t&&t.length),isMain:!1})})},i.editPost=function(e){socket.emit("plugins.composer.push",e.pid,function(t,o){if(t)return C.error(t);o.save_id=e.save_id,o.action="posts.edit",o.pid=e.pid,o.modified=!1,e.body&&(o.body=e.body,o.modified=!0),e.title&&(o.title=e.title,o.modified=!0),u(o)})},i.load=function(e){var t=$('.composer[data-uuid="'+e+'"]');t.length?(X(e),r.reposition(t),R(t),S()):i.formatting?k(e):socket.emit("plugins.composer.getFormattingOptions",function(o,v){if(o)return C.error(o);i.formatting=v,k(e)})},i.enhance=function(e,t,o){!t&&!o&&(t=utils.generateUUID(),i.posts[t]=ajaxify.data,o=ajaxify.data,e.attr("data-uuid",t)),O.init(e,i.posts[t]),d.init(e,i.posts),w.addHandler(e),w.addComposerButtons(),s.handleToggler(e),B.initialize(t),f.init(e,i.posts[t]),n.init(e,t),e.on("change","input, textarea",function(){i.posts[t].modified=!0}),e.on("click",".composer-submit",function(x){x.preventDefault(),x.stopPropagation(),$(this).attr("disabled",!0),W(t)}),l.e(42441).then(function(){var x=[l(42441)];(function(j){j(e.get(0)).bind("mod+enter",function(){e.find(".composer-submit").attr("disabled",!0),W(t)})}).apply(null,x)}).catch(l.oe),e.find(".composer-discard").on("click",function(x){if(x.preventDefault(),!i.posts[t].modified)return i.discard(t),H();w.exitFullscreen();var j=$(this).prop("disabled",!0);P.translate("[[modules:composer.discard]]",function(V){T.confirm(V,function(_){_&&(i.discard(t),H()),j.prop("disabled",!1)})})}),e.find(".composer-minimize, .minimize .trigger").on("click",function(x){x.preventDefault(),x.stopPropagation(),i.minimize(t)});const v=e.find("textarea");v.on("input propertychange",utils.debounce(function(){s.render(e)},250)),v.on("scroll",function(){s.matchScroll(e)}),y.init(e,o);const E=y.get(o.save_id);s.render(e,function(){s.matchScroll(e)}),ie(e),ae(e),R(e),o.action==="posts.edit"&&i.updateThumbCount(t,e),D.isEnabled||$('[data-format="zen"]').addClass("hidden"),a.fire("action:composer.enhanced",{postContainer:e,postData:o,draft:E})};async function I(e){return ajaxify.data.template.category&&parseInt(e.cid,10)===parseInt(ajaxify.data.cid,10)?ajaxify.data:parseInt(e.cid,10)?await b.get(`/api/category/${e.cid}`,{}):null}async function k(e){var t=i.posts[e],o=t?t.hasOwnProperty("cid"):!1,v=t?!!t.isMain:!1,E=t?!!t.pid:!1,x=t?parseInt(t.uid,10)===0:!1;const j=t.timestamp>Date.now();var V=t.title.replace(/%/g,"&#37;").replace(/,/g,"&#44;");t.category=await I(t);const _=t.category?t.category.privileges:ajaxify.data.privileges;var z={topicTitle:V,titleLength:V.length,body:utils.escapeHTML(t.body),mobile:i.bsEnvironment==="xs"||i.bsEnvironment==="sm",resizable:!0,thumb:t.thumb,isTopicOrMain:o||v,maximumTitleLength:config.maximumTitleLength,maximumPostLength:config.maximumPostLength,minimumTagLength:config.minimumTagLength,maximumTagLength:config.maximumTagLength,"composer:showHelpTab":config["composer:showHelpTab"],isTopic:o,isEditing:E,canSchedule:!!(v&&_&&(_["topics:schedule"]&&!E||j&&_.view_scheduled)),showHandleInput:config.allowGuestHandles&&(app.user.uid===0||E&&x&&app.user.isAdmin),handle:t?t.handle||"":void 0,formatting:i.formatting,tagWhitelist:t.category?t.category.tagWhitelist:ajaxify.data.tagWhitelist,privileges:app.user.privileges,selectedCategory:t.category,submitOptions:[]};z.mobile&&(te(),app.toggleNavbar(!1)),t.mobile=i.bsEnvironment==="xs"||i.bsEnvironment==="sm",{postData:t,createData:z}=await a.fire("filter:composer.create",{postData:t,createData:z}),app.parseAndTranslate("composer",z,function(F){if(!$('.composer.composer[data-uuid="'+e+'"]').length){F=$(F),F.find(".title").each(function(){$(this).text(P.unescape($(this).text()))}),F.attr("data-uuid",e),$(document.body).append(F);var U=$(F[0]);if(r.reposition(U),i.enhance(U,e,t),X(e),U.on("click",function(){A.isActive(e)||A.updateActive(e)}),r.handleResize(U),i.bsEnvironment==="xs"||i.bsEnvironment==="sm"){var J=U.find(".composer-submit"),K=U.find(".mobile-navbar .composer-submit"),ne=U.find(".write"),ee=ne.attr("tabindex");J.removeAttr("tabindex"),K.attr("tabindex",parseInt(ee,10)+1)}$(window).trigger("action:composer.loaded",{postContainer:U,post_uuid:e,composerData:i.posts[e],formatting:i.formatting}),m.apply(U.find(".write")),R(U),S()}})}function te(){var e="compose?p="+window.location.pathname,t=window.location.pathname.slice(1)+window.location.search;t.startsWith(config.relative_path.slice(1))&&(t=t.slice(config.relative_path.length)),window.history.replaceState({url:null,returnPath:t},t,config.relative_path+"/"+t),window.history.pushState({url:e},e,`${config.relative_path}/${t}`)}function ie(e){e.find('[data-action="help"]').on("click",async function(){const o=await socket.emit("plugins.composer.renderHelp");o&&o.length>0&&T.dialog({size:"large",message:o,onEscape:!0,backdrop:!0})})}function ae(e){var t=e.attr("data-uuid"),o=i.posts[t]&&i.posts[t].action==="posts.edit",v=utils.findBootstrapEnvironment(),E=v==="xs"||v==="sm";o||E||p.enableQuickSearch({searchElements:{inputEl:e.find("input.title"),resultEl:e.find(".quick-search-container")},searchOptions:{composer:1},hideOnNoMatches:!0,hideDuringSearch:!0})}function X(e){i.active&&i.active!==e&&i.minimize(i.active),i.active=e;const t=$('.composer[data-uuid="'+e+'"]');t.css("visibility","visible"),$(window).trigger("action:composer.activate",{post_uuid:e,postContainer:t})}function R(e){setTimeout(function(){var t=e.find("input.title");t.length?t.focus():e.find("textarea").focus().putCursorAtEnd()},20)}async function W(e){var t=i.posts[e],o=$('.composer[data-uuid="'+e+'"]'),v=o.find(".handle"),E=o.find(".title"),x=o.find("textarea"),j=o.find("input#topic-thumb-url"),V=t.hasOwnProperty("template")&&t.template.compose===!0;const _=o.find(".composer-submit");E.val(E.val().trim()),x.val(utils.rtrim(x.val())),j.length&&j.val(j.val().trim());var z=t.action,F=(t.hasOwnProperty("cid")||parseInt(t.pid,10))&&o.find("input.title").length,U=!F||F&&parseInt(t.cid,10),J={post_uuid:e,postData:t,postContainer:o,titleEl:E,titleLen:E.val().length,bodyEl:x,bodyLen:x.val().length};if(await a.fire("filter:composer.check",J),$(window).trigger("action:composer.check",J),J.error)return c(e,J.error);if(B.inProgress[e]&&B.inProgress[e].length)return c(e,"[[error:still-uploading]]");if(F&&J.titleLen<parseInt(config.minimumTitleLength,10))return c(e,"[[error:title-too-short, "+config.minimumTitleLength+"]]");if(F&&J.titleLen>parseInt(config.maximumTitleLength,10))return c(e,"[[error:title-too-long, "+config.maximumTitleLength+"]]");if(z==="topics.post"&&!U)return c(e,"[[error:category-not-selected]]");if(J.bodyLen<parseInt(config.minimumPostLength,10))return c(e,"[[error:content-too-short, "+config.minimumPostLength+"]]");if(J.bodyLen>parseInt(config.maximumPostLength,10))return c(e,"[[error:content-too-long, "+config.maximumPostLength+"]]");if(F&&!f.isEnoughTags(e))return c(e,"[[error:not-enough-tags, "+f.minTagCount()+"]]");if(d.isActive()&&d.getTimestamp()<=Date.now())return c(e,"[[error:scheduling-to-past]]");let K={uuid:e},ne="post",ee="";z==="topics.post"?(ee="/topics",K={...K,handle:v?v.val():void 0,title:E.val(),content:x.val(),thumb:j.val()||"",cid:O.getSelectedCid(),tags:f.getTags(e),timestamp:d.getTimestamp()}):z==="posts.reply"?(ee=`/topics/${t.tid}`,K={...K,tid:t.tid,handle:v?v.val():void 0,content:x.val(),toPid:t.toPid}):z==="posts.edit"&&(ne="put",ee=`/posts/${t.pid}`,K={...K,pid:t.pid,handle:v?v.val():void 0,content:x.val(),title:E.val(),thumb:j.val()||"",tags:f.getTags(e),timestamp:d.getTimestamp()});var oe={composerEl:o,action:z,composerData:K,postData:t,redirect:!0};await a.fire("filter:composer.submit",oe),a.fire("action:composer.submit",Object.freeze(oe));var se=$('#taskbar .composer[data-uuid="'+e+'"] i'),re=o.find(".write");se.removeClass("fa-plus").addClass("fa-circle-o-notch fa-spin"),i.minimize(e),re.prop("readonly",!0),b[ne](ee,K).then(Y=>{_.removeAttr("disabled"),t.submitted=!0,i.discard(e),y.removeDraft(t.save_id),Y.queued?C.alert({type:"success",title:"[[global:alert.success]]",message:Y.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${Y.id}`)}}):z==="topics.post"?oe.redirect&&ajaxify.go("topic/"+Y.slug,void 0,V||i.bsEnvironment==="xs"||i.bsEnvironment==="sm"):z==="posts.reply"?V||i.bsEnvironment==="xs"||i.bsEnvironment==="sm"?window.history.back():oe.redirect&&(ajaxify.data.template.name!=="topic"||ajaxify.data.template.topic&&parseInt(t.tid,10)!==parseInt(ajaxify.data.tid,10))&&ajaxify.go("post/"+Y.pid):H(),a.fire("action:composer."+z,{composerData:K,data:Y})}).catch(Y=>{if(i.load(e),re.prop("readonly",!1),Y.message==="[[error:email-not-confirmed]]")return g.showEmailConfirmWarning(Y.message);c(e,Y.message)})}function S(){$("html").addClass("composing")}function q(){$("#content").css({paddingBottom:0}),$("html").removeClass("composing"),app.toggleNavbar(!0),w.exitFullscreen()}return i.discard=function(e){if(i.posts[e]){var t=i.posts[e],o=$('.composer[data-uuid="'+e+'"]');o.remove(),y.removeDraft(t.save_id),h.deleteAll(e),A.discard("composer",e),$('[data-action="post"]').removeAttr("disabled"),a.fire("action:composer.discard",{post_uuid:e,postData:t}),delete i.posts[e],i.active=void 0}d.reset(),q()},i.close=i.discard,i.minimize=function(e){var t=$('.composer[data-uuid="'+e+'"]');t.css("visibility","hidden"),i.active=void 0,A.minimize("composer",e),$(window).trigger("action:composer.minimize",{post_uuid:e}),q()},i.minimizeActive=function(){i.active&&i.miminize(i.active)},i.updateThumbCount=function(e,t){const o=i.posts[e];if(o.action==="topics.post"||o.action==="posts.edit"&&o.isMain){const v=[h.get(e)];o.pid&&v.push(h.getByPid(o.pid)),Promise.all(v).then(E=>{E=E.reduce((x,j)=>(x=x.concat(j),x)),E.length&&t.find('[data-format="thumbs"]').find(".badge").text(E.length).toggleClass("hidden",!E.length)})}},i}.apply(G,M),L!==void 0&&(Q.exports=L)},77678:(Q,G,l)=>{var M,L;M=[l(50548),l(27145),l(74344)],L=function(A,P,B){var w={},y;w.init=function(r,n){var d=r.find(".category-list-container");d.length&&(r.on("action:composer.resize",function(){f(r)}),w.updateTaskbar(r,n),y=A.init(d.find('[component="category-selector"]'),{privilege:"topics:create",states:["watching","notwatching","ignoring"],onSelect:function(m){n.hasOwnProperty("cid")&&s(r,n,m)}}),y&&(n.cid&&n.category?y.selectedCategory={cid:n.cid,name:n.category.name}:ajaxify.data.template.compose&&ajaxify.data.selectedCategory&&(y.selectedCategory={cid:ajaxify.data.cid,name:ajaxify.data.selectedCategory}),r.find(".category-name").translateText(y.selectedCategory?y.selectedCategory.name:"[[modules:composer.select_category]]").on("click",function(){A.modal({privilege:"topics:create",states:["watching","notwatching","ignoring"],openOnLoad:!0,showLinks:!1,onSubmit:function(m){r.find(".category-name").text(m.name),y.selectCategory(m.cid),n.hasOwnProperty("cid")&&s(r,n,m)}})}),f(r)))};function f(r){r.find('.category-list-container [component="category-selector"]').toggleClass("dropup",r.outerHeight()<$(window).height()/2)}w.getSelectedCid=function(){var r;return y&&(r=y.getSelectedCategory()),r?r.cid:0},w.updateTaskbar=function(r,n){parseInt(n.cid,10)&&B.get(`/categories/${n.cid}`,{}).then(function(d){O(r,d)})};function O(r,n){if(n){var d=r.attr("data-uuid");P.update("composer",d,{image:n.backgroundImage,color:n.color,"background-color":n.bgColor,icon:n.icon&&n.icon.slice(3)})}}async function s(r,n,d){n.cid=d.cid;const m=await window.fetch(`${config.relative_path}/api/category/${d.cid}`).then(h=>h.json());n.category=m,O(r,m),l.e(3913).then(function(){var h=[l(98166),l(88186)];(function(b,T){b.onChangeCategory(m),T.onChangeCategory(r,n,d.cid,m),$(window).trigger("action:composer.changeCategory",{postContainer:r,postData:n,selectedCategory:d,categoryData:m})}).apply(null,h)}).catch(l.oe)}return w}.apply(G,M),L!==void 0&&(Q.exports=L)},73398:(Q,G,l)=>{var M,L;M=[l(59006),l(63281),l(7927),l(32230)],L=function(A,P,B,w){const y={},f={timestamp:0,open:!1,edit:!1,posts:{}};let O=[],s,r,n,d;const m={el:null,defaultText:"",activeText:""},h={el:null,icon:null,defaultText:"",activeText:""};let b,T;$(window).on("action:composer.activate",p),y.init=function(u,c){f.timestamp=0,f.posts=c,w.translateKeys(["[[topic:composer.post-later]]","[[modules:composer.change-schedule-date]]"]).then(I=>{m.defaultText=I[0],m.activeText=I[1]}),O=u[0].querySelectorAll(".display-scheduler"),s=u[0].querySelectorAll(".display-scheduler i"),m.el=u[0].querySelector(".dropdown-item.display-scheduler"),r=u[0].querySelector(".dropdown-item.cancel-scheduling"),n=u.find('[component="composer/submit/container"]'),d=u.find('[component="composer/submit/options/container"]'),h.el=u[0].querySelector(".composer-submit:not(.btn-sm)"),h.icon=h.el.querySelector("i"),h.defaultText=h.el.lastChild.textContent,h.activeText=h.el.getAttribute("data-text-variant"),r.addEventListener("click",H),O.forEach(I=>I.addEventListener("click",C))},y.getTimestamp=function(){return!y.isActive()||isNaN(f.timestamp)?0:f.timestamp},y.isActive=function(){return f.timestamp>0},y.isOpen=function(){return f.open},y.reset=function(){f.timestamp=0},y.onChangeCategory=function(u){Z(u.privileges["topics:schedule"]),N(!1);const c=u.privileges["topics:schedule"]||d.attr("data-submit-options")>0;n.find(".composer-submit").toggleClass("rounded-1",!c),d.toggleClass("hidden",!c),y.reset()};async function C(){const u=await A.render("modals/topic-scheduler");P.dialog({message:u,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:a,onHidden:g,onEscape:!0,buttons:{cancel:{label:f.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(f.timestamp?"btn-warning":"btn-outline-secondary")+(f.edit?" hidden":""),callback:H},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:i}}})}function a(u){f.open=!0;const c=u.target.querySelector(".datetime-picker");b=c.querySelector('input[type="date"]'),T=c.querySelector('input[type="time"]'),D()}function g(){f.open=!1}function p(u,{post_uuid:c}){f.edit=!1;const I=f.posts[c];I&&I.isMain&&I.timestamp>Date.now()&&(f.timestamp=I.timestamp,f.edit=!0,N())}function D(){const u=new Date,c=new Date(u.getTime()-u.getTimezoneOffset()*6e4).toJSON();if(b.setAttribute("min",c.slice(0,10)),T.setAttribute("min",c.slice(11,-8)),y.isActive()){const I=new Date(f.timestamp-u.getTimezoneOffset()*6e4).toJSON();b.value=I.slice(0,10),T.value=I.slice(11,-8)}}function i(){const u=b.value&&T.value,c=new Date(`${b.value} ${T.value}`).getTime();if(!u||isNaN(c)||c<Date.now()){f.timestamp=0;const I=c<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return B.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:I}),!1}f.timestamp||N(!0),f.timestamp=c}function H(){f.timestamp&&(N(!1),f.timestamp=0)}function N(u=!0){s.forEach(c=>c.classList.toggle("active",u)),h.icon&&(h.icon.classList.toggle("fa-check",!u),h.icon.classList.toggle("fa-clock-o",u)),m.el&&(m.el.textContent=u?m.activeText:m.defaultText,r.classList.toggle("hidden",!u)),h.el.lastChild.textContent=u?h.activeText:h.defaultText}function Z(u){O.forEach(c=>c.classList.toggle("hidden",!u))}return y}.apply(G,M),L!==void 0&&(Q.exports=L)},13720:(Q,G,l)=>{var M,L;M=[l(7927)],L=function(A){var P={},B,w;P.init=function(s,r){var n=s.find(".tags");if(n.length){B=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,w=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,n.tagsinput({tagClass:"badge bg-info rounded-1",confirmKeys:[13,44],trimValue:!0});var d=s.find(".bootstrap-tagsinput input");y(s,r,ajaxify.data),app.loadJQueryUI(function(){d.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:s.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(b,T){socket.emit("topics.autocompleteTags",{query:b.term,cid:r.cid},function(C,a){if(C)return A.error(C);a&&T(a),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){f(d)}}),O(r.tags,n),n.on("beforeItemAdd",function(b){var T=w&&w<=P.getTags(s.attr("data-uuid")).length,C=utils.cleanUpTag(b.item,config.maximumTagLength),a=C!==b.item;if(b.cancel=a||b.item.length<config.minimumTagLength||b.item.length>config.maximumTagLength||T,b.item.length<config.minimumTagLength)return A.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(b.item.length>config.maximumTagLength)return A.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(T)return A.error("[[error:too-many-tags, "+w+"]]");a&&n.tagsinput("add",C)});var m=!1,h=!1;n.on("itemRemoved",function(b){if(h){h=!1;return}b.item&&socket.emit("topics.canRemoveTag",{tag:b.item},function(T,C){if(T)return A.error(T);C||(A.error("[[error:cant-remove-system-tag]]"),m=!0,n.tagsinput("add",b.item))})}),n.on("itemAdded",function(b){if(m){m=!1;return}var T=r.hasOwnProperty("cid")?r.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:b.item,cid:T||0},function(C,a){if(C)return A.error(C);if(!a)return h=!0,n.tagsinput("remove",b.item);$(window).trigger("action:tag.added",{cid:T,tagEl:n,tag:b.item}),d.length&&d.autocomplete("close")})})}),d.attr("tabIndex",n.attr("tabIndex")),d.on("blur",function(){f(d)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var m=$(this).attr("data-tag");return m&&O([m],n),!1})}},P.isEnoughTags=function(s){return P.getTags(s).length>=B},P.minTagCount=function(){return B},P.onChangeCategory=function(s,r,n,d){var m=s.find('[component="composer/tag/dropdown"]');m.length&&(y(s,r,d),m.toggleClass("hidden",!d.tagWhitelist||!d.tagWhitelist.length),d.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:d.tagWhitelist},function(h){m.find(".dropdown-menu").html(h)}))};function y(s,r,n){var d=s.find(".tags"),m=s.find(".bootstrap-tagsinput input");m.length&&(n.hasOwnProperty("minTags")&&(B=n.minTags),n.hasOwnProperty("maxTags")&&(w=n.maxTags),n.tagWhitelist&&n.tagWhitelist.length?(m.attr("readonly",""),m.attr("placeholder",""),d.tagsinput("items").slice().forEach(function(h){n.tagWhitelist.indexOf(h)===-1&&d.tagsinput("remove",h)})):(m.removeAttr("readonly"),m.attr("placeholder",s.find("input.tags").attr("placeholder"))),s.find(".tags-container").toggleClass("haswhitelist",!!(n.tagWhitelist&&n.tagWhitelist.length)),s.find(".tags-container").toggleClass("hidden",n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]||w===0&&!r&&!r.tags&&!r.tags.length),n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]&&d.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:s,tagWhitelist:n.tagWhitelist,tagsInput:m}))}function f(s){var r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){s.trigger(r)},100)}function O(s,r){if(s&&s.length)for(var n=0;n<s.length;++n)r.tagsinput("add",s[n])}return P.getTags=function(s){return $('.composer[data-uuid="'+s+'"] .tags').tagsinput("items")},P}.apply(G,M),L!==void 0&&(Q.exports=L)},77070:(Q,G,l)=>{var M,L;M=[l(83713),l(98755),l(32230),l(7927),l(33371),l(86569)],L=function(A,P,B,w,y){var f={inProgress:{}},O="";f.initialize=function(a){d(a),m(a),s(a),r(a),B.translate("[[modules:composer.uploading, 0%]]",function(g){O=g})};function s(a){var g=$('.composer[data-uuid="'+a+'"]');g.find("#files").on("change",function(p){var D=(p.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);D&&T({files:D,post_uuid:a,route:"/api/post/upload"})})}function r(a){var g=$('.composer[data-uuid="'+a+'"]');g.on("click",".topic-thumb-clear-btn",function(p){g.find("input#topic-thumb-url").val("").trigger("change"),n(g.find("input#topic-thumb-file")),$(this).addClass("hide"),p.preventDefault()}),g.on("paste change keypress","input#topic-thumb-url",function(){var p=$(this);setTimeout(function(){var D=p.val();D?g.find(".topic-thumb-clear-btn").removeClass("hide"):(n(g.find("input#topic-thumb-file")),g.find(".topic-thumb-clear-btn").addClass("hide")),g.find("img.topic-thumb-preview").attr("src",D)},100)})}function n(a){a.wrap("<form />").closest("form").get(0).reset(),a.unwrap()}function d(a){var g=$('.composer[data-uuid="'+a+'"]');y.handleDragDrop({container:g,callback:function(p){T({files:p.files,post_uuid:a,route:"/api/post/upload",formData:p.formData})}})}function m(a){var g=$('.composer[data-uuid="'+a+'"]');y.handlePaste({container:g,callback:function(p){T({files:p.files,fileNames:p.fileNames,post_uuid:a,route:"/api/post/upload",formData:p.formData})}})}function h(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function b(a,g,p){return a.slice(0,g)+p+a.slice(g)}function T(a){var g=[...a.files],p=a.post_uuid,D=$('.composer[data-uuid="'+p+'"]'),i=D.find("textarea"),H=i.val(),N=D.find("#fileForm"),Z=!1;N.attr("action",config.relative_path+a.route);var u=P.getSelectedCid();!u&&ajaxify.data.cid&&(u=ajaxify.data.cid);var c=0,I=!1;for(c=0;c<g.length;++c)if(I=g[c].type.match(/image./),I&&!app.user.privileges["upload:post:image"]||!I&&!app.user.privileges["upload:post:file"])return w.error("[[error:no-privileges]]");var k=[];let te="";for(c=0;c<g.length;++c){if(k.push(c+"_"+Date.now()+"_"+(a.fileNames?a.fileNames[c]:g[c].name)),I=g[c].type.match(/image./),!app.user.isAdmin&&g[c].size>parseInt(config.maximumFileSize,10)*1024)return N[0].reset(),w.error("[[error:file-too-big, "+config.maximumFileSize+"]]");te+=(I?"!":"")+"["+k[c]+"]("+O+") "}const ie=i.getCursorPosition(),ae=H.length;H=b(H,ie,te),N.length&&D.find('[data-action="post"]').prop("disabled",!0),i.val(H),$(window).trigger("action:composer.uploadStart",{post_uuid:p,files:k.map(function(X,R){return{filename:X.replace(/^\d+_\d{13}_/,""),isImage:/image./.test(g[R].type)}}),text:O}),N.off("submit").submit(function(){function X(R,W,S){var q;S&&(q=R.replace(/^\d+_\d{13}_/,""));var e=i.val(),t=new RegExp(h(R)+"]\\([^)]+\\)","g");i.val(e.replace(t,(q||R)+"]("+W+")")),$(window).trigger("action:composer.uploadUpdate",{post_uuid:p,filename:R,text:W})}return f.inProgress[p]=f.inProgress[p]||[],f.inProgress[p].push(1),a.formData&&a.formData.append("cid",u),$(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:a.formData,data:{cid:u},error:function(R){Z=!0,D.find('[data-action="post"]').prop("disabled",!1);const W=C(R,p);for(var S=0;S<g.length;++S)X(k[S],W,!0);A.render(D)},uploadProgress:function(R,W,S,q){B.translate("[[modules:composer.uploading, "+q+"%]]",function(e){if(!Z)for(var t=0;t<g.length;++t)X(k[t],e)})},success:function(R){const W=R.response.images;if(Z=!0,W&&W.length)for(var S=0;S<W.length;++S)W[S].filename=k[S].replace(/^\d+_\d{13}_/,""),W[S].isImage=/image./.test(g[S].type),X(k[S],W[S].url,!0);A.render(D),i.selectRange(ie+i.val().length-ae),D.find('[data-action="post"]').prop("disabled",!1),$(window).trigger("action:composer.upload",{post_uuid:p,files:W})},complete:function(){N[0].reset(),f.inProgress[p].pop()}}),!1}),N.submit()}function C(a,g){var p=a.responseJSON&&(a.responseJSON.error||a.responseJSON.status&&a.responseJSON.status.message)||"[[error:parse-error]]";return a&&a.status===413&&(p=a.statusText||"Request Entity Too Large"),w.error(p),$(window).trigger("action:composer.uploadError",{post_uuid:g,message:p}),p}return f}.apply(G,M),L!==void 0&&(Q.exports=L)}}]);
