"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[7245,70565,83014,99617,3564,74344],{12649:(A,g,o)=>{var d,h;d=[o(74344),o(63281),o(7927),o(50431)],h=function(a,E,c,f){const m={};return m.init=function(){$("#upload").on("click",function(){f.show({title:"[[admin/manage/uploads:upload-file]]",route:config.relative_path+"/api/admin/upload/file",params:{folder:ajaxify.data.currentFolder}},function(){ajaxify.refresh()})}),$(".delete").on("click",function(){const e=$(this).parents("[data-path]");E.confirm("[[admin/manage/uploads:confirm-delete]]",function(s){s&&a.del("/files",{path:e.attr("data-path")}).then(()=>{e.remove()}).catch(c.error)})}),$("#new-folder").on("click",async function(){E.prompt("[[admin/manage/uploads:name-new-folder]]",e=>{!e||!e.trim()||a.put("/files/folder",{path:ajaxify.data.currentFolder,folderName:e}).then(()=>{ajaxify.refresh()}).catch(c.error)})})},m}.apply(g,d),h!==void 0&&(A.exports=h)},74344:(A,g,o)=>{o.r(g),o.d(g,{del:()=>P,get:()=>e,head:()=>s,patch:()=>r,post:()=>u,put:()=>l});var d=o(85233),h=o.n(d),a=o(63281),E=o.n(a);const c=config.relative_path+"/api/v3";function f(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:c+t.url,typeof n=="function"){m(t,n);return}return new Promise((i,y)=>{m(t,function(_,O){if(_)return _.message==="A valid login session was not found. Please log in and try again."?(0,a.confirm)("[[error:api.reauth-required]]",b=>{b&&ajaxify.go("login")}):y(_);i(O)})})}async function m(t,n){const{url:i}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,d.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const y=await fetch(i,t),{headers:_}=y,O=_.get("content-type"),b=O&&O.startsWith("application/json");let p;if(b?p=await y.json():p=await y.text(),!y.ok)return n(new Error(b?p.status.message:p));n(null,b&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p)}function e(t,n,i){return f({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},i)}function s(t,n,i){return f({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},i)}function u(t,n,i){return f({url:t,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},i)}function r(t,n,i){return f({url:t,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},i)}function l(t,n,i){return f({url:t,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},i)}function P(t,n,i){return f({url:t,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},i)}},50431:(A,g,o)=>{var d,h;d=[o(86569)],h=function(){const a={};a.show=function(e,s){const u=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:u,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(r){r.modal("show"),r.on("hidden.bs.modal",function(){r.remove()});const l=r.find("#uploadForm");l.attr("action",e.route),l.find("#params").val(JSON.stringify(e.params)),r.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),l.submit()}),l.submit(function(){return E(r,u,s),!1})})},a.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function E(e,s,u){c(e,"status","[[uploads:uploading-file]]"),e.find("#upload-progress-bar").css("width","0%"),e.find("#upload-progress-box").show().removeClass("hide");const r=e.find("#fileInput");if(!r.val())return c(e,"error","[[uploads:select-file-to-upload]]");if(!m(r[0],s))return c(e,"error","[[error:file-too-big, "+s+"]]");a.ajaxSubmit(e,u)}function c(e,s,u){a.hideAlerts(e),s==="error"&&e.find("#fileUploadSubmitBtn").removeClass("disabled"),u=u.replace(/&amp;#44/g,"&#44"),e.find("#alert-"+s).translateText(u).removeClass("hide")}a.ajaxSubmit=function(e,s){e.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(r){r=f(r),c(e,"error",r.responseJSON?.status?.message||r.responseJSON?.error||`[[error:upload-error-fallback, ${r.status} ${r.statusText}]]`)},uploadProgress:function(r,l,P,t){e.find("#upload-progress-bar").css("width",t+"%")},success:function(r){let l=f(r);r.hasOwnProperty("response")&&r.hasOwnProperty("status")&&r.status.code==="ok"&&(l=r.response.images),s(l[0].url),c(e,"success","[[uploads:upload-success]]"),setTimeout(function(){a.hideAlerts(e),e.modal("hide")},750)}})};function f(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return{error:"[[error:parse-error]]"}}return e}function m(e,s){return window.FileReader&&s?e.files[0].size<=s*1e3:!0}return a}.apply(g,d),h!==void 0&&(A.exports=h)}}]);
