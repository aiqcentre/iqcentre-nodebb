"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[54400],{29721:(x,E,a)=>{var v,m;v=[a(32230),a(59006),a(63281),a(7927),a(62526)],m=function(f,R,p,u){const d={};d.init=function(){const o=$(".plugins"),c=o[0].querySelectorAll("li").length;let e;if(!c){f.translate("<li><p><i>[[admin/extend/plugins:none-found]]</i></p></li>",function(t){o.append(t)});return}window.location.hash&&$(`.nav-pills button[data-bs-target="${window.location.hash}"]`).trigger("click");const r=document.querySelector("#plugin-search");r.value="",o.on("click",'button[data-action="toggleActive"]',function(){const t=$(this).parents("li");e=t.attr("data-plugin-id");const l=$(this),n=ajaxify.data.installed[t.attr("data-plugin-index")];function i(){socket.emit("admin.plugins.toggleActive",e,function(s,g){if(s)return u.error(s);l.siblings('[data-action="toggleActive"]').removeClass("hidden"),l.addClass("hidden"),g.active&&!$('#active [id="'+e+'"]').length&&$("#active ul").prepend(t.clone(!0)),n.active=!n.active,u.alert({alert_id:"plugin_toggled",title:"[[admin/extend/plugins:alert."+(g.active?"enabled":"disabled")+"]]",message:"[[admin/extend/plugins:alert."+(g.active?"activate-success":"deactivate-success")+"]]",type:g.active?"warning":"success",timeout:5e3,clickfn:function(){a.e(37201).then(function(){var h=[a(64117)];(function(C){C.rebuildAndRestart()}).apply(null,h)}).catch(a.oe)}})})}n.license&&n.active!==!0?R.render("admin/partials/plugins/license",n).then(function(s){p.dialog({title:"[[admin/extend/plugins:license.title]]",message:s,size:"large",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:i}},onShown:function(){const g=this.querySelector("button.btn-primary");g&&g.focus()}})}):i(e)}),o.on("click",'button[data-action="toggleInstall"]',function(){const t=$(this);if(t.attr("disabled",!0),e=$(this).parents("li").attr("data-plugin-id"),$(this).attr("data-installed")==="1")return d.toggleInstall(e,$(this).parents("li").attr("data-version"));d.suggest(e,function(l,n){if(l){p.confirm(f.compile("admin/extend/plugins:alert.suggest-error",l.status,l.responseText),function(i){i?d.toggleInstall(e,"latest"):t.removeAttr("disabled")});return}n.version!=="latest"?d.toggleInstall(e,n.version):n.version==="latest"?A(e,function(i){i?d.toggleInstall(e,"latest"):t.removeAttr("disabled")}):t.removeAttr("disabled")})}),o.on("click",'button[data-action="upgrade"]',function(){const t=$(this),l=t.parents("li");e=l.attr("data-plugin-id"),d.suggest(e,function(n,i){if(n)return p.alert("[[admin/extend/plugins:alert.package-manager-unreachable]]");a.e(6445).then(function(){var s=[a(6445)];(function(g){const h=l.find(".currentVersion").text();i.version!=="latest"&&g.compare(i.version,h,">")?b(e,t,i.version):i.version==="latest"?A(e,function(){b(e,t,i.version)}):p.alert(f.compile("admin/extend/plugins:alert.incompatible",app.config.version,i.version))}).apply(null,s)}).catch(a.oe)})}),$(r).on("input propertychange",function(){const t=$(this).val();$(".plugins li").each(function(){const n=$(this).attr("data-plugin-id");$(this).toggleClass("hide",n&&n.indexOf(t)===-1)}),document.querySelectorAll(".plugins .tab-pane").forEach(n=>{const i=n.querySelectorAll("li:not(.hide)").length,s=n.querySelector(".no-plugins");s&&s.classList.toggle("hide",i!==0)})}),$("#plugin-submit-usage").on("click",function(){socket.emit("admin.config.setMultiple",{submitPluginUsage:$(this).prop("checked")?"1":"0"},function(t){if(t)return u.error(t)})}),$("#plugin-order").on("click",function(){$("#order-active-plugins-modal").modal("show"),socket.emit("admin.plugins.getActive",function(t,l){if(t)return u.error(t);let n="";if(l.forEach(function(s){n+=`
						<li class="d-flex justify-content-between gap-1 pointer border-bottom pb-2">
							${s}
							<div class="d-flex gap-1">
								<div class="btn-ghost-sm move-up">
									<i class="fa fa-chevron-up"></i>
								</div>
								<div class="btn-ghost-sm move-down">
									<i class="fa fa-chevron-down"></i>
								</div>
							</div>
						</li>
					`}),!l.length){f.translate("[[admin/extend/plugins:none-active]]",function(s){$("#order-active-plugins-modal .plugin-list").html(s).sortable()});return}const i=$("#order-active-plugins-modal .plugin-list");i.html(n).sortable(),i.find(".move-up").on("click",function(){const s=$(this).parents("li");s.prev().before(s)}),i.find(".move-down").on("click",function(){const s=$(this).parents("li");s.next().after(s)})})}),$("#save-plugin-order").on("click",function(){const t=$("#order-active-plugins-modal .plugin-list").children(),l=[];t.each(function(n,i){l.push({name:$(i).text(),order:n})}),socket.emit("admin.plugins.orderActivePlugins",l,function(n){if(n)return u.error(n);$("#order-active-plugins-modal").modal("hide"),u.alert({alert_id:"plugin_reordered",title:"[[admin/extend/plugins:alert.reorder]]",message:"[[admin/extend/plugins:alert.reorder-success]]",type:"success",timeout:5e3,clickfn:function(){a.e(37201).then(function(){var i=[a(64117)];(function(s){s.rebuildAndRestart()}).apply(null,i)}).catch(a.oe)}})})}),y(),I()};function A(o,c){p.confirm(f.compile("admin/extend/plugins:alert.possibly-incompatible",o),function(e){c(e)})}function b(o,c,e){c.attr("disabled",!0).find("i").attr("class","fa fa-refresh fa-spin"),socket.emit("admin.plugins.upgrade",{id:o,version:e},function(r,t){if(r)return u.error(r);const l=c.parents("li");l.find(".fa-exclamation-triangle").remove(),l.find(".currentVersion").text(e),c.remove(),t&&u.alert({alert_id:"plugin_upgraded",title:"[[admin/extend/plugins:alert.upgraded]]",message:"[[admin/extend/plugins:alert.upgrade-success]]",type:"warning",timeout:5e3,clickfn:function(){a.e(37201).then(function(){var n=[a(64117)];(function(i){i.rebuildAndRestart()}).apply(null,n)}).catch(a.oe)}})})}d.toggleInstall=function(o,c,e){const r=$('li[data-plugin-id="'+o+'"] button[data-action="toggleInstall"]');r.find("i").attr("class","fa fa-refresh fa-spin"),socket.emit("admin.plugins.toggleInstall",{id:o,version:c},function(t,l){if(t)return r.removeAttr("disabled"),u.error(t);ajaxify.refresh(),u.alert({alert_id:"plugin_toggled",title:"[[admin/extend/plugins:alert."+(l.installed?"installed":"uninstalled")+"]]",message:"[[admin/extend/plugins:alert."+(l.installed?"install-success":"uninstall-success")+"]]",type:"info",timeout:5e3}),typeof e=="function"&&e.apply(this,arguments)})},d.suggest=function(o,c){const e=app.config.version.match(/^\d+\.\d+\.\d+/);$.ajax((app.config.registry||"https://packages.nodebb.org")+"/api/v1/suggest",{type:"GET",data:{package:o,version:e[0]},dataType:"json"}).done(function(r){c(void 0,r)}).fail(c)};function y(){$("#installed ul li").each(function(){$(this).find('[data-action="upgrade"]').length&&$("#upgrade ul").append($(this).clone(!0))})}function I(){$("#installed ul li").each(function(){$(this).hasClass("active")?$("#active ul").append($(this).clone(!0)):$("#deactive ul").append($(this).clone(!0))})}return d}.apply(E,v),m!==void 0&&(x.exports=m)}}]);
