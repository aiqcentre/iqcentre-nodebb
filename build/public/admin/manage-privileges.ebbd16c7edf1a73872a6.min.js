"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[27678,88768,70565,83014,28253,66623,49286,99617,74344,86193],{15606:(T,S,h)=>{var P,v;P=[h(74344),h(86193),h(63281),h(7927),h(32230),h(50548),h(42441),h(18310),h(99764)],v=function(E,x,C,g,l,u,s,c,m){const n={};let o;n.init=function(){o=isNaN(parseInt(ajaxify.data.selectedCategory.cid,10))?"admin":ajaxify.data.selectedCategory.cid,c.init(".privilege-table-container"),u.init($('[component="category-selector"]'),{onSelect:function(e){o=parseInt(e.cid,10),o=isNaN(o)?"admin":o,n.refreshPrivilegeTable(),ajaxify.updateHistory("admin/manage/privileges/"+(o||""))},localCategories:ajaxify.data.categories,privilege:"find",showLinks:!0}),n.setupPrivilegeTable(),L(),$(".privilege-filters button:first-child").click()},n.setupPrivilegeTable=function(){$(".privilege-table-container").on("change",'input[type="checkbox"]:not(.checkbox-helper)',function(){const e=this,t=$(this),i=t.parents("[data-privilege]"),r=i.index()+1,f=i.attr("data-privilege"),y=t.prop("checked"),b=t.parents("tr"),k=b.attr("data-group-name")||b.attr("data-uid"),R=parseInt(b.attr("data-private")||0,10),U=b.attr("data-group-name")!==void 0,N=U&&b.attr("data-group-name")==="banned-users"||b.attr("data-banned")!==void 0?"banned-users":"registered-users",j=t.prop("checked")===(i.attr("data-value")==="true")?null:y;k?(U&&f==="groups:moderate"&&!R&&y?C.confirm("[[admin/manage/privileges:alert.confirm-moderate]]",function(O){O?(i.attr("data-delta",j),n.applyDeltaState(e,j),n.exposeSingleAssumedPriv(r,N)):t.prop("checked",!t.prop("checked"))}):f.endsWith("admin:admins-mods")&&y?C.confirm("[[admin/manage/privileges:alert.confirm-admins-mods]]",function(O){O?(i.attr("data-delta",j),n.applyDeltaState(e,j),n.exposeSingleAssumedPriv(r,N)):t.prop("checked",!t.prop("checked"))}):(i.attr("data-delta",j),n.applyDeltaState(e,j),n.exposeSingleAssumedPriv(r,N)),c.updateState(t)):g.error("[[error:invalid-data]]")}),n.exposeAssumedPrivileges(),c.updateAll(),n.addEvents()},n.applyDeltaState=(e,t)=>{["bg-success","bg-opacity-75","border-success"].forEach(i=>{e.classList.toggle(i,t===!0)}),["bg-danger","bg-opacity-50","border-danger"].forEach(i=>{e.classList.toggle(i,t===!1)})},n.addEvents=function(){document.getElementById("save").addEventListener("click",function(){i("save",n.commit)}),document.getElementById("discard").addEventListener("click",function(){i("discard",n.discard)});const e=document.querySelector(".privilege-table-container");e.addEventListener("change",r=>{r.target.closest("td[data-privilege] input")&&(document.getElementById("discard").style.display=e.querySelectorAll("td[data-delta]").length?"unset":"none")});const t=$(".privilege-table-container");t.on("click",'[data-action="search.user"]',n.addUserToPrivilegeTable),t.on("click",'[data-action="search.group"]',n.addGroupToPrivilegeTable),t.on("click",'[data-action="copyToChildren"]',function(){i("copyToChildren",n.copyPrivilegesToChildren.bind(null,o,""))}),t.on("click",'[data-action="copyToChildrenGroup"]',function(){const r=$(this).parents("[data-group-name]").attr("data-group-name");i("copyToChildrenGroup",n.copyPrivilegesToChildren.bind(null,o,r))}),t.on("click",'[data-action="copyPrivilegesFrom"]',function(){n.copyPrivilegesFromCategory(o,"")}),t.on("click",'[data-action="copyPrivilegesFromGroup"]',function(){const r=$(this).parents("[data-group-name]").attr("data-group-name");n.copyPrivilegesFromCategory(o,r)}),t.on("click",'[data-action="copyToAll"]',function(){i("copyToAll",n.copyPrivilegesToAllCategories.bind(null,o,""))}),t.on("click",'[data-action="copyToAllGroup"]',function(){const r=$(this).parents("[data-group-name]").attr("data-group-name");i("copyToAllGroup",n.copyPrivilegesToAllCategories.bind(null,o,r))}),t.on("click",".privilege-filters button",W),s.bind("ctrl+s",function(r){i("save",n.commit),r.preventDefault()});function i(r,f){const y=B();C.confirm(`[[admin/manage/privileges:alert.confirm-${r}, ${y}]]<br /><br />[[admin/manage/privileges:alert.no-undo]]`,function(b){b&&f.call()})}},n.commit=function(){const e=document.querySelector(".privilege-table-container"),t=$.map(e.querySelectorAll("td[data-delta]"),function(i){const r=i.getAttribute("data-privilege"),f=i.parentNode,y=f.getAttribute("data-group-name")||f.getAttribute("data-uid"),b=i.getAttribute("data-delta")==="true"?1:0;return n.setPrivilege(y,r,b)});Promise.allSettled(t).then(i=>{n.refreshPrivilegeTable();const r=i.filter(f=>f.status==="rejected");r.length?r.forEach(f=>{g.error(f.reason)}):m.toggleSaveSuccess($("#save"))})},n.discard=function(){n.refreshPrivilegeTable(),g.success("[[admin/manage/privileges:alert.discarded]]")},n.refreshPrivilegeTable=function(e){E.get(`/categories/${o}/privileges`,{}).then(t=>{ajaxify.data.privileges={...ajaxify.data.privileges,...t};const i=parseInt(o,10)?"admin/partials/privileges/category":"admin/partials/privileges/global",r=ajaxify.currentPage.endsWith("admin/manage/privileges/admin");app.parseAndTranslate(i,{privileges:t,isAdminPriv:r}).then(f=>{const y=$(".privilege-filters button.btn-warning").map((b,k)=>$(k).index()).get();$(".privilege-table-container").html(f),n.exposeAssumedPrivileges(),document.querySelectorAll(".privilege-filters").forEach((b,k)=>{const R=y[k]===void 0?0:y[k];b.querySelectorAll("button")[R].click()}),w("data-group-name",e)})}).catch(alert.error)},n.exposeAssumedPrivileges=function(){const e=(f,y)=>`.privilege-table tr[data-banned] td[data-privilege="${f[y]}"] input`,t=d("banned-users");A(t,e);const i=(f,y)=>`.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="banned-users"],[data-group-name="guests"],[data-group-name="spiders"]) td[data-privilege="${f[y]}"] input, .privilege-table tr[data-uid]:not([data-banned]) td[data-privilege="${f[y]}"] input`,r=d("registered-users");A(r,i)},n.exposeSingleAssumedPriv=function(e,t){let i;switch(t){case"banned-users":i=()=>`.privilege-table tr[data-banned] td[data-privilege]:nth-child(${e}) input`;break;default:i=()=>`.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="banned-users"],[data-group-name="guests"],[data-group-name="spiders"]) td[data-privilege]:nth-child(${e}) input, .privilege-table tr[data-uid]:not([data-banned]) td[data-privilege]:nth-child(${e}) input`}const r=p(t,e);D(i,r)},n.setPrivilege=(e,t,i)=>E[i?"put":"del"](`/categories/${isNaN(o)?0:o}/privileges/${encodeURIComponent(t)}`,{member:e}),n.addUserToPrivilegeTable=function(){const e=C.dialog({title:"[[admin/manage/categories:alert.find-user]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.user-search]]" />',show:!0});e.on("shown.bs.modal",function(){const t=e.find("input");t.focus(),x.user(t,function(i,r){M(r.item.user,function(){e.modal("hide")})})})},n.addGroupToPrivilegeTable=function(){const e=C.dialog({title:"[[admin/manage/categories:alert.find-group]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.group-search]]" />',show:!0});e.on("shown.bs.modal",function(){const t=e.find("input");t.focus(),x.group(t,function(i,r){if(r.item.group.name==="administrators")return g.alert({type:"warning",message:"[[admin/manage/privileges:alert.admin-warning]]"});I(r.item.group.name,function(){e.modal("hide")})})})},n.copyPrivilegesToChildren=function(e,t){const i=F();socket.emit("admin.categories.copyPrivilegesToChildren",{cid:e,group:t,filter:i},function(r){if(r)return g.error(r.message);g.success("[[admin/manage/categories:privileges.copy-success]]")})},n.copyPrivilegesFromCategory=function(e,t){const i=B(),r="<br>"+(t?`[[admin/manage/privileges:alert.copyPrivilegesFromGroup-warning, ${i}]]`:`[[admin/manage/privileges:alert.copyPrivilegesFrom-warning, ${i}]]`)+"<br><br>[[admin/manage/privileges:alert.no-undo]]";u.modal({title:"[[admin/manage/privileges:alert.copyPrivilegesFrom-title]]",message:r,localCategories:[],showLinks:!0,onSubmit:function(f){socket.emit("admin.categories.copyPrivilegesFrom",{toCid:e,filter:F(),fromCid:f.cid,group:t},function(y){if(y)return g.error(y);ajaxify.refresh()})}})},n.copyPrivilegesToAllCategories=function(e,t){const i=F();socket.emit("admin.categories.copyPrivilegesToAllCategories",{cid:e,group:t,filter:i},function(r){if(r)return g.error(r);g.success("[[admin/manage/categories:privileges.copy-success]]")})};function d(e){const t=[];return $(`.privilege-table tr[data-group-name="${e}"] td input[type="checkbox"]:not(.checkbox-helper)`).parents("[data-privilege]").each(function(i,r){$(r).find("input").prop("checked")&&t.push(r.getAttribute("data-privilege"))}),t.concat(t.map(function(i){return i.startsWith("groups:")?i.slice(7):!1})).filter(Boolean)}function p(e,t){return $(`.privilege-table tr[data-group-name="${e}"] td:nth-child(${t}) input[type="checkbox"]`)[0].checked}function A(e,t){for(let i=0,r=e.length;i<r;i+=1)$(t(e,i)).each(function(y,b){b.checked||(b.indeterminate=!0)})}function D(e,t){$(e()).each((r,f)=>{f.indeterminate=f.checked?!1:t})}function w(e,t){if(t){const i=$("["+e+"]").filter(function(){return $(this).attr(e)===String(t)});if(i.length)return i.addClass("selected"),!0}return!1}function L(){if(ajaxify.data.group){if(w("data-group-name",ajaxify.data.group))return;I(ajaxify.data.group)}}function I(e,t){if(t=t||function(){},document.querySelector('.privilege-table [data-group-name="'+e+'"]'))return w("data-group-name",e),t();const r=ajaxify.data.privileges.keys.groups.reduce(function(f,y){return f[y]=!1,f},{});app.parseAndTranslate("admin/partials/privileges/"+(isNaN(o)||o===0?"global":"category"),"privileges.groups",{privileges:{groups:[{name:e,nameEscaped:l.escape(e),privileges:r}]}},function(f){const y=document.querySelector(".privilege-table tbody"),b=$(".privilege-filters").first().find("button.btn-warning").index();y.append(f.get(0)),n.exposeAssumedPrivileges(),w("data-group-name",e),document.querySelector(".privilege-filters").querySelectorAll("button")[b].click(),t()})}async function M(e,t){if(t=t||function(){},document.querySelector('.privilege-table [data-uid="'+e.uid+'"]'))return w("data-uid",e.uid),t();const r=ajaxify.data.privileges.keys.users.reduce(function(k,R){return k[R]=!1,k},{}),f=await app.parseAndTranslate("admin/partials/privileges/"+(isNaN(o)?"global":"category"),"privileges.users",{privileges:{users:[{picture:e.picture,username:e.username,banned:e.banned,uid:e.uid,"icon:text":e["icon:text"],"icon:bgColor":e["icon:bgColor"],privileges:r}]}}),y=document.querySelectorAll(".privilege-table tbody"),b=$(".privilege-filters").last().find("button.btn-warning").index();y[1].append(f.get(0)),n.exposeAssumedPrivileges(),w("data-uid",e.uid),document.querySelectorAll(".privilege-filters")[1].querySelectorAll("button")[b].click(),t()}function W(e){const[t,i]=e.target.getAttribute("data-filter").split(",").map(f=>parseInt(f,10));$(e.target).closest("table")[0].querySelectorAll("thead tr:last-child, tbody tr ").forEach(f=>{f.querySelectorAll("td, th").forEach((y,b)=>{const k=y.tagName.toUpperCase()==="TH"?1:0;b<3-k||y.classList.toggle("hidden",!(b>=t-k&&b<=i-k))})}),c.updateAll(),$(e.target).siblings("button").toArray().forEach(f=>f.classList.remove("btn-warning")),e.target.classList.add("btn-warning")}function F(){const e=document.querySelector(".privilege-filters .btn-warning").getAttribute("data-filter").split(",").map(t=>parseInt(t,10));return e[0]-=3,e[1]=e[1]-3+1,e}function B(){const e=document.querySelector(".privilege-filters .btn-warning"),t=e?e.textContent.toLocaleLowerCase():"";return t.indexOf("privileges")>-1?t:`${t} privileges`.trim()}return n}.apply(S,P),v!==void 0&&(T.exports=v)},18310:(T,S,h)=>{var P;P=function(){const v={};let E;v.toggling=!1,v.init=function(g){E=$(g),E.on("change","input.checkbox-helper",x)},v.updateAll=function(){E.find("input.checkbox-helper").each((g,l)=>{v.updateState($(l))})},v.updateState=function(g){if(v.toggling)return;const l=g.closest("tr").find("input:not([disabled]):visible").toArray(),u=$(l.shift()),s=l.length&&l.every(c=>c.checked);u.prop("checked",s)};function x(g){const l=$(g.target);C(l)}function C(g){v.toggling=!0;const l=g.prop("checked");g.closest("tr").find("input:not(.checkbox-helper):visible").each((u,s)=>{const c=$(s);c.prop("checked")!==l&&c.click()}),v.toggling=!1}return v}.call(S,h,S,T),P!==void 0&&(T.exports=P)},74344:(T,S,h)=>{h.r(S),h.d(S,{del:()=>o,get:()=>u,head:()=>s,patch:()=>m,post:()=>c,put:()=>n});var P=h(85233),v=h.n(P),E=h(63281),x=h.n(E);const C=config.relative_path+"/api/v3";function g(a,d){if(a.url=a.url.startsWith("/api")?config.relative_path+a.url:C+a.url,typeof d=="function"){l(a,d);return}return new Promise((p,A)=>{l(a,function(D,w){if(D)return D.message==="A valid login session was not found. Please log in and try again."?(0,E.confirm)("[[error:api.reauth-required]]",L=>{L&&ajaxify.go("login")}):A(D);p(w)})})}async function l(a,d){const{url:p}=a;delete a.url,a.data&&!(a.data instanceof FormData)&&(a.data=JSON.stringify(a.data||{}),a.headers["content-type"]="application/json; charset=utf-8"),{options:a}=await(0,P.fire)("filter:api.options",{options:a}),a.data&&(a.body=a.data,delete a.data);const A=await fetch(p,a),{headers:D}=A,w=D.get("content-type"),L=w&&w.startsWith("application/json");let I;if(L?I=await A.json():I=await A.text(),!A.ok)return d(new Error(L?I.status.message:I));d(null,L&&I.hasOwnProperty("status")&&I.hasOwnProperty("response")?I.response:I)}function u(a,d,p){return g({url:a+(d&&Object.keys(d).length?"?"+$.param(d):"")},p)}function s(a,d,p){return g({url:a+(d&&Object.keys(d).length?"?"+$.param(d):""),method:"head"},p)}function c(a,d,p){return g({url:a,method:"post",data:d,headers:{"x-csrf-token":config.csrf_token}},p)}function m(a,d,p){return g({url:a,method:"patch",data:d,headers:{"x-csrf-token":config.csrf_token}},p)}function n(a,d,p){return g({url:a,method:"put",data:d,headers:{"x-csrf-token":config.csrf_token}},p)}function o(a,d,p){return g({url:a,method:"delete",data:d,headers:{"x-csrf-token":config.csrf_token}},p)}},86193:(T,S,h)=>{var P,v;P=[h(74344),h(7927)],v=function(E,x){const C={},g={delay:200,appendTo:null};C.init=u=>{const s={...g,...u},{input:c,onSelect:m}=s;app.loadJQueryUI(function(){c.autocomplete({...s,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(n,o){l(c,m,n,o)}})})},C.user=function(u,s,c){typeof s=="function"&&(c=s,s={}),s=s||{},C.init({input:u,onSelect:c,source:(m,n)=>{s.query=m.term,E.get("/api/users",s,function(o,a){if(o)return x.error(o);if(a&&a.users){const d=a.users.map(function(p){const A=$("<div></div>").html(p.username).text();return p&&{label:A,value:A,user:{uid:p.uid,name:p.username,slug:p.userslug,username:p.username,userslug:p.userslug,picture:p.picture,banned:p.banned,"icon:text":p["icon:text"],"icon:bgColor":p["icon:bgColor"]}}});n(d)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},C.group=function(u,s){C.init({input:u,onSelect:s,source:(c,m)=>{socket.emit("groups.search",{query:c.term},function(n,o){if(n)return x.error(n);if(o&&o.length){const a=o.map(function(d){return d&&{label:d.name,value:d.name,group:d}});m(a)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},C.tag=function(u,s){C.init({input:u,onSelect:s,delay:100,source:(c,m)=>{socket.emit("topics.autocompleteTags",{query:c.term,cid:ajaxify.data.cid||0},function(n,o){if(n)return x.error(n);o&&m(o),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function l(u,s,c,m){s=s||function(){};const n=jQuery.Event("keypress");n.which=13,n.keyCode=13,setTimeout(function(){u.trigger(n)},100),s(c,m)}return C}.apply(S,P),v!==void 0&&(T.exports=v)},22905:(T,S,h)=>{var P,v;P=[h(7927),h(73138)],v=function(E,x){const C={};return C.init=function(g,l){let u=null;l=l||{},l.privilege=l.privilege||"topics:read",l.states=l.states||["watching","notwatching","ignoring"],l.cacheList=l.hasOwnProperty("cacheList")?l.cacheList:!0;let s=[];Array.isArray(l.localCategories)&&(s=l.localCategories.map(a=>({...a}))),l.selectedCids=l.selectedCids||ajaxify.data.selectedCids||[];const c=g.find('[component="category-selector-search"]');if(!c.length)return;const m=c.parent('[component="category/dropdown"]').length>0||c.parent('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){m&&(g.find(".dropdown-toggle").css({visibility:"hidden"}),c.removeClass("hidden"),c.css({"z-index":g.find(".dropdown-toggle").css("z-index")+1}));function a(){const d=c.find("input").val();d.length>1||!d&&!u?n(d,function(p){u=l.cacheList&&(u||p),o(p)}):!d&&u&&o(u)}c.on("click",function(d){d.preventDefault(),d.stopPropagation()}),c.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||c.find("input").focus()}),g.on("hide.bs.dropdown",function(){m&&(g.find(".dropdown-toggle").css({visibility:"inherit"}),c.addClass("hidden")),c.off("click"),c.find("input").off("keyup")});function n(a,d){socket.emit("categories.categorySearch",{search:a,query:utils.params(),parentCid:l.parentCid||0,selectedCids:l.selectedCids,privilege:l.privilege,states:l.states,showLinks:l.showLinks},function(p,A){if(p)return E.error(p);d(s.concat(A))})}function o(a){const d=l.selectedCids.map(String);a.forEach(function(p){p.selected=d.includes(String(p.cid))}),app.parseAndTranslate(l.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(p){g.find('[component="category/list"]').html(p.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const A=x.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));A&&A.update()})}},C}.apply(S,P),v!==void 0&&(T.exports=v)},50548:(T,S,h)=>{var P,v;P=[h(22905),h(63281),h(85233),h(32230)],v=function(E,x,C,g){const l={};return l.init=function(u,s){if(!u||!u.length)return;s=s||{};const c=s.onSelect||function(){};s.states=s.states||["watching","notwatching","ignoring"],s.template=s.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:u,options:s}),E.init(u,s);const m={el:u,selectedCategory:null};u.on("click","[data-cid]",function(){const o=$(this);return o.hasClass("disabled")?!1:(m.selectCategory(o.attr("data-cid")),c(m.selectedCategory))});let n=m.el.find('[component="category-selector-selected"]').html();return g.translate(n,o=>{n=o}),m.selectCategory=function(o){const a=m.el.find('[data-cid="'+o+'"]');m.selectedCategory={cid:o,name:a.attr("data-name")},a.length?m.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):m.el.find('[component="category-selector-selected"]').html(n)},m.getSelectedCategory=function(){return m.selectedCategory},m.getSelectedCid=function(){return m.selectedCategory?m.selectedCategory.cid:0},s.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(s.template,{selectedCategory:s.selectedCategory},function(o){m.el.find('[component="category-selector-selected"]').html(o.find('[component="category-selector-selected"]').html())}),m},l.modal=function(u){u=u||{},u.onSelect=u.onSelect||function(){},u.onSubmit=u.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:u.message},function(s){const c=x.dialog({title:u.title||"[[modules:composer.select_category]]",message:s,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:n}}}),m=l.init(c.find('[component="category-selector"]'),u);function n(o){return o.preventDefault(),m.selectedCategory&&(u.onSubmit(m.selectedCategory),c.modal("hide")),!1}u.openOnLoad&&c.on("shown.bs.modal",function(){c.find(".dropdown-toggle").dropdown("toggle")}),c.find("form").on("submit",n)})},l}.apply(S,P),v!==void 0&&(T.exports=v)}}]);
