"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[14507,70565,83014,99617,25655,74344],{6500:(x,P,l)=>{var k,A;k=[l(18340),l(42152),l(63281),l(59006),l(74344),l(7927)],A=function(R,D,f,p,h,d){const y={};y.init=function(){R.load("core.api",$(".core-api-settings")),$("#save").on("click",()=>{R.save("core.api",$(".core-api-settings"))});const e=document.querySelectorAll('[data-component="acp/tokens"] [data-action="copy"]');new D(e),$('[data-action="create"]').on("click",t),n()};function n(){const e=document.querySelector("#content form");e&&e.addEventListener("click",s=>{const r=s.target.closest("[data-action]");if(r)switch(r.getAttribute("data-action")){case"edit":a(r);break;case"delete":i(r);break;case"roll":o(r);break}})}async function t(){const e=await p.render("admin/partials/edit-token-modal",{}),s=async function(){const r=this,u=this.get(0).querySelector("form"),c=document.querySelector('[data-component="acp/tokens"] tbody'),g=u.reportValidity();if(u&&g){const m=new FormData(u),O=m.get("uid"),E=m.get("description");try{const v=await h.post("/admin/tokens",{uid:O,description:E});if(!c)return r.modal("hide"),ajaxify.refresh();ajaxify.data.tokens.push(v);const S=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[v]})).get(0);c.append(S),$(S).find(".timeago").timeago(),r.modal("hide")}catch(v){d.error(v)}}return!1};f.dialog({title:"[[admin/settings/api:create-token]]",message:e,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:s}}})}async function a(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token"),{uid:u,description:c}=await h.get(`/admin/tokens/${r}`),g=async function(){const O=this,E=this.get(0).querySelector("form"),v=E.reportValidity();if(E&&v){const S=new FormData(E),j=S.get("uid"),F=S.get("description");try{const T=await h.put(`/admin/tokens/${r}`,{uid:j,description:F}),C=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[T]})).get(0);s.replaceWith(C),$(C).find(".timeago").timeago(),O.modal("hide")}catch(T){d.error(T)}}return!1},m=await p.render("admin/partials/edit-token-modal",{uid:u,description:c});f.dialog({title:"[[admin/settings/api:update-token]]",message:m,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:g}}})}async function i(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token");f.confirm("[[admin/settings/api:delete-confirm]]",async u=>{if(u){try{await h.del(`/admin/tokens/${r}`)}catch(c){d.error(c)}s.remove()}})}async function o(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token");f.confirm("[[admin/settings/api:roll-confirm]]",async u=>{if(u)try{const c=await h.post(`/admin/tokens/${r}/roll`),g=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[c]})).get(0);s.replaceWith(g),$(g).find(".timeago").timeago()}catch(c){d.error(c)}})}return y}.apply(P,k),A!==void 0&&(x.exports=A)},74344:(x,P,l)=>{l.r(P),l.d(P,{del:()=>i,get:()=>d,head:()=>y,patch:()=>t,post:()=>n,put:()=>a});var k=l(85233),A=l.n(k),R=l(63281),D=l.n(R);const f=config.relative_path+"/api/v3";function p(o,e){if(o.url=o.url.startsWith("/api")?config.relative_path+o.url:f+o.url,typeof e=="function"){h(o,e);return}return new Promise((s,r)=>{h(o,function(u,c){if(u)return u.message==="A valid login session was not found. Please log in and try again."?(0,R.confirm)("[[error:api.reauth-required]]",g=>{g&&ajaxify.go("login")}):r(u);s(c)})})}async function h(o,e){const{url:s}=o;delete o.url,o.data&&!(o.data instanceof FormData)&&(o.data=JSON.stringify(o.data||{}),o.headers["content-type"]="application/json; charset=utf-8"),{options:o}=await(0,k.fire)("filter:api.options",{options:o}),o.data&&(o.body=o.data,delete o.data);const r=await fetch(s,o),{headers:u}=r,c=u.get("content-type"),g=c&&c.startsWith("application/json");let m;if(g?m=await r.json():m=await r.text(),!r.ok)return e(new Error(g?m.status.message:m));e(null,g&&m.hasOwnProperty("status")&&m.hasOwnProperty("response")?m.response:m)}function d(o,e,s){return p({url:o+(e&&Object.keys(e).length?"?"+$.param(e):"")},s)}function y(o,e,s){return p({url:o+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},s)}function n(o,e,s){return p({url:o,method:"post",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function t(o,e,s){return p({url:o,method:"patch",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function a(o,e,s){return p({url:o,method:"put",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function i(o,e,s){return p({url:o,method:"delete",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}},18340:(x,P,l)=>{var k,A;k=[l(85233),l(7927)],A=function(R,D){let f,p=[],h=0,d;function y(n,t){typeof n!="string"&&(n=$(n),n=n.data("type")||n.attr("type")||n.prop("tagName"));const a=f.plugins[n.toLowerCase()];if(a==null)return;const i=a[t];return typeof i=="function"?i:null}return d={deepClone:function(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n},createElement:function(n,t,a){const i=document.createElement(n);for(const o in t)t.hasOwnProperty(o)&&i.setAttribute(o,t[o]);return a&&i.appendChild(document.createTextNode(a)),i},initElement:function(n){const t=y(n,"init");t?.call(f,$(n))},destructElement:function(n){const t=y(n,"destruct");t?.call(f,$(n))},createElementOfType:function(n,t,a){let i;const o=y(n,"create");return o!=null?i=$(o.call(f,n,t,a)):(a==null&&(a={}),n!=null&&(a.type=n),i=$(d.createElement(t||"input",a))),i.data("type",n),d.initElement(i),i},cleanArray:function(n,t,a){const i=[];if(!t&&a)return n;for(let o=0;o<n.length;o+=1){let e=n[o];t&&(e===!!e?e=+e:e&&typeof e.trim=="function"&&(e=e.trim())),(a||e!=null&&e.length)&&i.push(e)}return i},isTrue:function(n){return n==="true"||+n==1},isFalse:function(n){return n==="false"||+n==0},readValue:function(n){let t=!d.isFalse(n.data("empty"));const a=!d.isFalse(n.data("trim")),i=n.data("split"),o=y(n,"get");let e;if(o!=null)return o.call(f,n,a,t);if(i!=null){t=d.isTrue(n.data("empty")),e=n.val();const s=e!=null&&e.split(i||",")||[];return d.cleanArray(s,a,t)}if(e=n.val(),a&&e!=null&&typeof e.trim=="function"&&(e=e.trim()),t||e!==void 0&&(e==null||e.length!==0))return e},fillField:function(n,t){const a=y(n,"set");let i=n.data("trim");if(i=i!=="false"&&+i!=0,a!=null)return a.call(f,n,t,i);t instanceof Array&&(t=t.join(n.data("split")||(i?", ":","))),i&&t&&typeof t.trim=="function"?(t=t.trim(),typeof t.toString=="function"&&(t=t.toString())):t!=null?(typeof t.toString=="function"&&(t=t.toString()),i&&(t=t.trim())):t="",t!==void 0&&n.val(t)},initFields:function(n){$("[data-key]",n).each(function(t,a){a=$(a);const i=y(a,"init"),o=a.data("key").split(".");let e=f.get();i?.call(f,a);for(let s=0;s<o.length;s+=1){const r=o[s];r&&e!=null&&(e=e[r])}d.fillField(a,e)})},registerReadyJobs:function(n){return h+=n,h},beforeReadyJobsDecreased:function(n){if(n==null&&(n=1),h>0&&(h-=n,h<=0)){for(let t=0;t<p.length;t+=1)p[t]();p=[]}},whenReady:function(n){h<=0?n():p.push(n)},serializeForm:function(n){const t=n.serializeObject();return n.find('input[type="checkbox"]').each(function(a,i){i=$(i),i.is(":checked")||(t[i.attr("name")]="off")}),n.find("select[multiple]").each(function(a,i){i=$(i),t[i.attr("name")]=JSON.stringify(i.val())}),t},persistSettings:function(n,t,a,i){t!=null&&t._!=null&&typeof t._!="string"&&(t=d.deepClone(t),t._=JSON.stringify(t._)),socket.emit("admin.settings.set",{hash:n,values:t},function(o){a&&(o?D.alert({title:"[[admin/admin:changes-not-saved]]",type:"danger",message:`[[admin/admin/changes-not-saved-message, ${o.message}]]`,timeout:5e3}):D.alert({title:"[[admin/admin:changes-saved]]",type:"success",message:"[[admin/admin:changes-saved-message]]",timeout:2500})),typeof i=="function"&&i(o)})},use:function(n){try{n._=JSON.parse(n._)}catch{}f.cfg=n}},f={helper:d,plugins:{},cfg:{},get:function(){return f.cfg!=null&&f.cfg._!==void 0?f.cfg._:f.cfg},registerPlugin:function(n,t){t==null?t=n.types:n.types=t,typeof n.use=="function"&&n.use.call(f);for(let a=0;a<t.length;a+=1){const i=t[a].toLowerCase();f.plugins[i]==null&&(f.plugins[i]=n)}},set:function(n,t,a,i,o){o==null&&(o=!0),d.whenReady(function(){d.use(t),d.initFields(a||"form"),d.persistSettings(n,t,o,i)})},sync:function(n,t,a){socket.emit("admin.settings.get",{hash:n},function(i,o){i?typeof a=="function"&&a(i):d.whenReady(function(){d.use(o),d.initFields(t||"form"),typeof a=="function"&&a()})})},persist:function(n,t,a,i){const o=[],e=$("[data-key]",t||"form").toArray();i==null&&(i=!0);for(let s=0;s<e.length;s+=1){const r=$(e[s]),u=d.readValue(r);let c=f.get();const g=r.data("key").split("."),m=g[g.length-1];if(g.length>1)for(let O=0;O<g.length-1;O+=1){const E=g[O];E&&c!=null&&(c=c[E])}c!=null?u!=null?c[m]=u:delete c[m]:o.push(r.data("key"))}o.length&&D.alert({title:"Attributes Not Saved",message:"'"+o.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3}),d.persistSettings(n,f.cfg,i,a)},load:function(n,t,a){a=a||function(){};const i=t.attr("data-socket-get");socket.emit(i||"admin.settings.get",{hash:n},function(o,e){if(o)return a(o);$(t).find("select[multiple]").each(function(r,u){const c=$(u).attr("name");if(c&&e.hasOwnProperty(c))try{e[c]=JSON.parse(e[c])}catch{}}),ajaxify.data[i?n:"settings"]=e,d.whenReady(function(){$(t).find("[data-sorted-list]").each(function(r,u){y(u,"get").call(f,$(u),n)})}),$(t).deserialize(e),R.fire("action:admin.settingsLoaded"),$(t).on("change","input, select, textarea",function(){app.flags=app.flags||{},app.flags._unsaved=!0});const s=document.getElementById("save");s&&l.e(42441).then(function(){var r=[l(42441)];(function(u){u.bind("ctrl+s",function(c){s.click(),c.preventDefault()})}).apply(null,r)}).catch(l.oe),a(null,e)})},save:function(n,t,a){t=$(t);const i=t.get(0).elements;if(f.check(i)&&t.length){const e=d.serializeForm(t);d.whenReady(function(){const r=t.find("[data-sorted-list]");r.length&&r.each((u,c)=>{y(c,"set").call(f,$(c),e)})});const s=t.attr("data-socket-set");socket.emit(s||"admin.settings.set",{hash:n,values:e},function(r){if(app.flags._unsaved=!1,ajaxify.data[s?n:"settings"]=e,typeof a=="function")a(r);else if(r)D.alert({title:"[[admin/admin:changes-not-saved]]",message:`[[admin/admin:changes-not-saved-message, ${r.message}]]`,type:"error",timeout:2500});else{const u=document.getElementById("save");u.classList.toggle("saved",!0),setTimeout(()=>{u.classList.toggle("saved",!1)},1500)}})}},check:function(n){const t=a=>{const i=a.target.closest(".form-group");i&&i.classList.add("has-error"),a.target.removeEventListener("invalid",t)};return Array.prototype.map.call(n,a=>{const i=a.closest(".form-group");return i&&i.classList.remove("has-error"),a.addEventListener("invalid",t),a.reportValidity()}).every(Boolean)}},d.registerReadyJobs(1),Promise.all([l.e(66177),l.e(62526),l.e(26069)]).then(function(){var n=[l(16631),l(73143),l(7448),l(15101),l(846),l(88839),l(53411),l(66370)];(function(){for(let t=0;t<arguments.length;t+=1)f.registerPlugin(arguments[t]);d.beforeReadyJobsDecreased()}).apply(null,n)}).catch(l.oe),f}.apply(P,k),A!==void 0&&(x.exports=A)}}]);
