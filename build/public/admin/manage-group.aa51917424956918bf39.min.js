"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[59078,70565,61762,83014,66623,49286,99617,71986,10999,74344],{22009:(w,A,c)=>{var h,y;h=[c(24987),c(18487),c(32230),c(50548),c(7350),c(22568),c(74344),c(63281),c(7927),c(99764)],y=function(g,p,b,u,n,a,d,l,i,E){const v={};v.init=function(){const t=$("#group-icon"),r=$("#change-group-user-title"),s=$("#change-group-label-color"),m=$("#change-group-text-color"),f=$("#group-label-preview"),C=$("#group-label-preview-text"),k=ajaxify.data.group.name;$("#group-selector").on("change",function(){ajaxify.go("admin/manage/groups/"+$(this).val()+window.location.hash)}),g.init("admin/manage/group"),r.on("keyup",function(){C.translateText(r.val())}),s.on("keyup input",function(){f.css("background-color",s.val()||"#000000")}),m.on("keyup input",function(){f.css("color",m.val()||"#ffffff")}),e(),$("#group-icon-container").on("click",function(){const x=t.attr("value");p.init(t,function(){let D=t.attr("value");D!==x&&(D==="fa-nbb-none"&&(D="hidden"),$("#group-icon-preview").attr("class","fa fa-fw "+(D||"hidden")),app.flags=app.flags||{},app.flags._unsaved=!0)})}),u.init($('.edit-privileges-selector [component="category-selector"]'),{onSelect:function(x){o(x.cid)},showLinks:!0});const P=u.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(x){let D=($("#memberPostCids").val()||"").split(",").map(L=>parseInt(L,10));return D.push(x.cid),D=D.filter((L,S,M)=>M.indexOf(L)===S),$("#memberPostCids").val(D.join(",")),P.selectCategory(0),!1}});n.init($('[component="group-selector"]')),$("form [data-property]").on("change",function(){app.flags=app.flags||{},app.flags._unsaved=!0}),$('[data-action="delete"]').on("click",function(){l.confirm("[[admin/manage/groups:alerts.confirm-delete]]",function(x){x&&d.del(`/groups/${a(ajaxify.data.group.name)}`,{}).then(()=>{ajaxify.go("/admin/managegroups")}).catch(i.error)})}),$("#save").on("click",function(){return d.put(`/groups/${a(k)}`,{name:$("#change-group-name").val(),userTitle:r.val(),description:$("#change-group-desc").val(),icon:t.attr("value"),labelColor:s.val(),textColor:m.val(),userTitleEnabled:$("#group-userTitleEnabled").is(":checked"),private:$("#group-private").is(":checked"),hidden:$("#group-hidden").is(":checked"),memberPostCids:$("#memberPostCids").val(),disableJoinRequests:$("#group-disableJoinRequests").is(":checked"),disableLeave:$("#group-disableLeave").is(":checked")}).then(()=>{const x=$("#change-group-name").val();k!==x&&ajaxify.go("admin/manage/groups/"+encodeURIComponent(x),void 0,!0),E.toggleSaveSuccess($("#save"))}).catch(i.error),!1})};function e(){$('[component="groups/members"]').on("click","[data-action]",function(){const t=$(this),r=t.parents("[data-uid]"),s=r.find(".member-name .user-owner-icon"),m=!s.hasClass("invisible"),f=r.attr("data-uid");switch(t.attr("data-action")){case"toggleOwnership":d[m?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${f}`,{}).then(()=>{s.toggleClass("invisible")}).catch(i.error);break;case"kick":l.confirm("[[admin/manage/groups:edit.confirm-remove-user]]",function(k){k&&d.del("/groups/"+ajaxify.data.group.slug+"/membership/"+f).then(()=>{r.slideUp().remove()}).catch(i.error)});break;default:break}})}function o(t){if(t){const r="admin/manage/privileges/"+t+"?group="+ajaxify.data.group.nameEncoded;if(app.flags&&app.flags._unsaved===!0){b.translate("[[global:unsaved-changes]]",function(s){l.confirm(s,function(m){m&&(app.flags._unsaved=!1,ajaxify.go(r))})});return}ajaxify.go(r)}}return v}.apply(A,h),y!==void 0&&(w.exports=y)},24987:(w,A,c)=>{var h,y;h=[c(74344),c(63281),c(7927)],y=function(g,p,b){const u={};let n,a;u.init=function(t){a=t||"groups/details",n=ajaxify.data.group.name,d(),i(),E()};function d(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(t){const r=[],s=p.dialog({title:"[[groups:details.add-member]]",message:t,buttons:{OK:{label:"[[groups:details.add-member]]",callback:function(){const m=[];s.find("[data-uid][data-selected]").each(function(f,C){m.push(r[$(C).attr("data-uid")])}),l(m,function(){s.modal("hide")})}}}});s.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),s.find("input").on("keyup",function(){g.get("/api/users",{query:$(this).val(),paginate:!1},function(m,f){if(m)return b.error(m);f.users.forEach(function(C){r[C.uid]=C}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:f.users},function(C){s.find("#search-result").html(C)})})})})})}function l(t,r){function s(){t=t.filter(function(f){return!$('[component="groups/members"] [data-uid="'+f.uid+'"]').length}),o(t,function(f){$('[component="groups/members"] tbody').prepend(f)}),r()}const m=t.map(function(f){return f.uid});n==="administrators"?socket.emit("admin.user.makeAdmins",m,function(f){if(f)return b.error(f);s()}):Promise.all(m.map(f=>g.put("/groups/"+ajaxify.data.group.slug+"/membership/"+f))).then(s).catch(b.error)}function i(){const t=$('[component="groups/members/search"]');t.on("keyup",utils.debounce(function(){const r=t.val();socket.emit("groups.searchMembers",{groupName:n,query:r},function(s,m){if(s)return b.error(s);o(m.users,function(f){$('[component="groups/members"] tbody').html(f),$('[component="groups/members"]').attr("data-nextstart",20)})})},250))}function E(){$('[component="groups/members"]').on("scroll",function(){const t=$(this),r=(t[0].scrollHeight-t.innerHeight())*.9;t.scrollTop()>r&&!$('[component="groups/members/search"]').val()&&v()})}function v(){const t=$('[component="groups/members"]');t.attr("loading")||(t.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:n,after:t.attr("data-nextstart")},function(r,s){if(r)return b.error(r);s&&s.users.length?e(s.users,function(){t.removeAttr("loading"),t.attr("data-nextstart",s.nextStart)}):t.removeAttr("loading")}))}function e(t,r){t=t.filter(function(s){return!$('[component="groups/members"] [data-uid="'+s.uid+'"]').length}),o(t,function(s){$('[component="groups/members"] tbody').append(s),r()})}function o(t,r){app.parseAndTranslate(a,"group.members",{group:{members:t,isOwner:ajaxify.data.group.isOwner}},r)}return u}.apply(A,h),y!==void 0&&(w.exports=y)},74344:(w,A,c)=>{c.r(A),c.d(A,{del:()=>v,get:()=>a,head:()=>d,patch:()=>i,post:()=>l,put:()=>E});var h=c(85233),y=c.n(h),g=c(63281),p=c.n(g);const b=config.relative_path+"/api/v3";function u(e,o){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:b+e.url,typeof o=="function"){n(e,o);return}return new Promise((t,r)=>{n(e,function(s,m){if(s)return s.message==="A valid login session was not found. Please log in and try again."?(0,g.confirm)("[[error:api.reauth-required]]",f=>{f&&ajaxify.go("login")}):r(s);t(m)})})}async function n(e,o){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,h.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const r=await fetch(t,e),{headers:s}=r,m=s.get("content-type"),f=m&&m.startsWith("application/json");let C;if(f?C=await r.json():C=await r.text(),!r.ok)return o(new Error(f?C.status.message:C));o(null,f&&C.hasOwnProperty("status")&&C.hasOwnProperty("response")?C.response:C)}function a(e,o,t){return u({url:e+(o&&Object.keys(o).length?"?"+$.param(o):"")},t)}function d(e,o,t){return u({url:e+(o&&Object.keys(o).length?"?"+$.param(o):""),method:"head"},t)}function l(e,o,t){return u({url:e,method:"post",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}function i(e,o,t){return u({url:e,method:"patch",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}function E(e,o,t){return u({url:e,method:"put",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}function v(e,o,t){return u({url:e,method:"delete",data:o,headers:{"x-csrf-token":config.csrf_token}},t)}},22905:(w,A,c)=>{var h,y;h=[c(7927),c(73138)],y=function(g,p){const b={};return b.init=function(u,n){let a=null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let d=[];Array.isArray(n.localCategories)&&(d=n.localCategories.map(e=>({...e}))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const l=u.find('[component="category-selector-search"]');if(!l.length)return;const i=l.parent('[component="category/dropdown"]').length>0||l.parent('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){i&&(u.find(".dropdown-toggle").css({visibility:"hidden"}),l.removeClass("hidden"),l.css({"z-index":u.find(".dropdown-toggle").css("z-index")+1}));function e(){const o=l.find("input").val();o.length>1||!o&&!a?E(o,function(t){a=n.cacheList&&(a||t),v(t)}):!o&&a&&v(a)}l.on("click",function(o){o.preventDefault(),o.stopPropagation()}),l.find("input").val("").on("keyup",utils.debounce(e,300)),e()}),u.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||l.find("input").focus()}),u.on("hide.bs.dropdown",function(){i&&(u.find(".dropdown-toggle").css({visibility:"inherit"}),l.addClass("hidden")),l.off("click"),l.find("input").off("keyup")});function E(e,o){socket.emit("categories.categorySearch",{search:e,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(t,r){if(t)return g.error(t);o(d.concat(r))})}function v(e){const o=n.selectedCids.map(String);e.forEach(function(t){t.selected=o.includes(String(t.cid))}),app.parseAndTranslate(n.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){u.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length);const r=p.Dropdown.getInstance(u.find(".dropdown-toggle").get(0));r&&r.update()})}},b}.apply(A,h),y!==void 0&&(w.exports=y)},50548:(w,A,c)=>{var h,y;h=[c(22905),c(63281),c(85233),c(32230)],y=function(g,p,b,u){const n={};return n.init=function(a,d){if(!a||!a.length)return;d=d||{};const l=d.onSelect||function(){};d.states=d.states||["watching","notwatching","ignoring"],d.template=d.template||"partials/category/selector-dropdown-left",b.fire("action:category.selector.options",{el:a,options:d}),g.init(a,d);const i={el:a,selectedCategory:null};a.on("click","[data-cid]",function(){const v=$(this);return v.hasClass("disabled")?!1:(i.selectCategory(v.attr("data-cid")),l(i.selectedCategory))});let E=i.el.find('[component="category-selector-selected"]').html();return u.translate(E,v=>{E=v}),i.selectCategory=function(v){const e=i.el.find('[data-cid="'+v+'"]');i.selectedCategory={cid:v,name:e.attr("data-name")},e.length?i.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(E)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},d.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(d.template,{selectedCategory:d.selectedCategory},function(v){i.el.find('[component="category-selector-selected"]').html(v.find('[component="category-selector-selected"]').html())}),i},n.modal=function(a){a=a||{},a.onSelect=a.onSelect||function(){},a.onSubmit=a.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:a.message},function(d){const l=p.dialog({title:a.title||"[[modules:composer.select_category]]",message:d,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:E}}}),i=n.init(l.find('[component="category-selector"]'),a);function E(v){return v.preventDefault(),i.selectedCategory&&(a.onSubmit(i.selectedCategory),l.modal("hide")),!1}a.openOnLoad&&l.on("shown.bs.modal",function(){l.find(".dropdown-toggle").dropdown("toggle")}),l.find("form").on("submit",E)})},n}.apply(A,h),y!==void 0&&(w.exports=y)},7350:(w,A,c)=>{var h;h=function(){const y={};return y.init=function(g){if(utils.isTouchDevice())return;const p=g.find('[component="group-selector-search"]');if(!p.length)return;const b=p.parent('[component="group-selector"]').length>0,u=g.find('[component="group-list"] [data-name]');g.on("show.bs.dropdown",function(){function n(){const a=p.find("input").val().toLowerCase();let d=!0;u.each(function(){const l=$(this),i=l.attr("data-name").toLowerCase().indexOf(a)!==-1;d&&i&&(d=!1),l.toggleClass("hidden",!i)}),g.find('[component="group-list"] [component="group-no-matches"]').toggleClass("hidden",!d)}b&&(g.find(".dropdown-toggle").css({visibility:"hidden"}),p.removeClass("hidden"),p.css({"z-index":g.find(".dropdown-toggle").css("z-index")+1})),p.on("click",function(a){a.preventDefault(),a.stopPropagation()}),p.find("input").val("").on("keyup",n),n()}),g.on("shown.bs.dropdown",function(){p.find("input").focus()}),g.on("hide.bs.dropdown",function(){b&&(g.find(".dropdown-toggle").css({visibility:"inherit"}),p.addClass("hidden")),p.off("click").find("input").off("keyup")})},y}.call(A,c,A,w),h!==void 0&&(w.exports=h)},22568:(w,A,c)=>{var h,y,g;(function(p){y=[c(20648)],h=p,g=typeof h=="function"?h.apply(A,y):h,g!==void 0&&(w.exports=g)})(function(p){const b=p("[^\\p{L}\\s\\d\\-_]","g"),u=/[^\w\s\d\-_]/g,n=/^\s+|\s+$/g,a=/\s+/g,d=/-+/g,l=/-$/g,i=/^-/g,E=/^[\w\d\s.,\-@]+$/;return function(e,o){return e?(e=String(e).replace(n,""),E.test(e)?e=e.replace(u,"-"):e=p.replace(e,b,"-"),e=o?e:e.toLocaleLowerCase(),e=e.replace(a,"-"),e=e.replace(d,"-"),e=e.replace(l,""),e=e.replace(i,""),e):""}})}}]);
