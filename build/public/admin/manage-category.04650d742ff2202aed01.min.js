"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[77884,70565,83014,66623,49286,99617,74344],{15260:(k,b,g)=>{var C,p;C=[g(50431),g(18487),g(50548),g(59006),g(74344),g(63281),g(7927),g(99764)],p=function(E,w,v,f,o,i,r,d){const s={};let y={};s.init=function(){const t=$("#category-settings"),c=$('[component="category/preview"]');t.find("select").each(function(){const a=$(this);a.val(a.attr("data-value"))}),v.init($('[component="settings/main/header"] [component="category-selector"]'),{onSelect:function(a){ajaxify.go("admin/manage/categories/"+a.cid)},cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),v.init($('#parent-category-selector [component="category-selector"]'),{onSelect:function(a){const n=$("#parent-cid");n.val(a.cid),l(n[0])},selectedCategory:ajaxify.data.category.parent,localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-list"}],cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),e(),t.find("input, select, textarea").on("change",function(a){l(a.target)}),$('[type="checkbox"]').on("change",function(){l($(this))}),$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())}),$('[data-name="bgColor"], [data-name="color"]').on("input",function(){const a=$(this);a.attr("data-name")==="bgColor"?c.css("background-color",a.val()):a.attr("data-name")==="color"&&c.css("color",a.val()),l(a[0])}),$("#save").on("click",function(){const a=$("#tag-whitelist").val()?$("#tag-whitelist").val().split(","):[];if(a.length&&a.length<parseInt($("#cid-min-tags").val(),10))return r.error("[[admin/manage/categories:alert.not-enough-whitelisted-tags]]");const n=ajaxify.data.category.cid;return o.put("/categories/"+n,y).then(()=>{app.flags._unsaved=!1,d.toggleSaveSuccess($("#save")),y={}}).catch(r.error),!1}),$(".purge").on("click",function(a){a.preventDefault(),f.render("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count}).then(function(n){const u=i.dialog({title:"[[admin/manage/categories:purge]]",message:n,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){u.find(".modal-footer button").prop("disabled",!0);const m=setInterval(function(){socket.emit("categories.getTopicCount",ajaxify.data.category.cid,function(h,A){if(h)return r.error(h);let x=0;ajaxify.data.category.topic_count>0&&(x=Math.max(0,1-A/ajaxify.data.category.topic_count)*100),u.find(".progress-bar").css({width:x+"%"})})},1e3);return o.del("/categories/"+ajaxify.data.category.cid).then(()=>{m&&clearInterval(m),u.modal("hide"),r.success("[[admin/manage/categories:alert.purge-success]]"),ajaxify.go("admin/manage/categories")}).catch(r.error),!1}}}})})}),$(".copy-settings").on("click",function(){return f.render("admin/partials/categories/copy-settings",{}).then(function(a){let n;const u=i.dialog({title:"[[modules:composer.select_category]]",message:a,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!(!n||parseInt(n,10)===parseInt(ajaxify.data.category.cid,10)))return socket.emit("admin.categories.copySettingsFrom",{fromCid:n,toCid:ajaxify.data.category.cid,copyParent:u.find("#copyParent").prop("checked")},function(m){if(m)return r.error(m);u.modal("hide"),alert.success("[[admin/manage/categories:alert.copy-success]]"),ajaxify.refresh()}),!1}}}});u.find(".modal-footer button").prop("disabled",!0),v.init(u.find('[component="category-selector"]'),{onSelect:function(m){n=m&&m.cid,n&&u.find(".modal-footer button").prop("disabled",!1)},showLinks:!0})}),!1}),$(".upload-button").on("click",function(){const n=$(this).attr("data-cid");E.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:n}},function(u){$("#category-image").val(u),c.css("background-image","url("+u+"?"+new Date().getTime()+")"),l($("#category-image"))})}),$("#category-image").on("change",function(){c.css("background-image",$(this).val()?'url("'+$(this).val()+'")':""),l($("#category-image"))}),$(".delete-image").on("click",function(a){a.preventDefault();const n=$("#category-image");n.val(""),c.css("background-image",""),l(n[0])}),c.on("click",function(){w.init($(this).find("i"),l)}),$('button[data-action="toggle"]').on("click",function(){const a=$(this),n=a.attr("data-disabled")==="1";o.put("/categories/"+ajaxify.data.category.cid,{disabled:n?0:1}).then(()=>{a.find(".label").translateText(n?"[[admin/manage/categories:disable]]":"[[admin/manage/categories:enable]]"),a.find("i").toggleClass(["fa-check","text-success"],!n).toggleClass(["fa-ban","text-danger"],n),a.attr("data-disabled",n?0:1)}).catch(r.error)})};function l(t){let c;$(t).is(":checkbox")?c=$(t).is(":checked")?1:0:c=$(t).val();const n=$(t).attr("data-name").match(/[^\][.]+/g);function u(m,h){h!==n.length&&(m[n[h]]=m[n[h]]||{},h===n.length-1&&(m[n[h]]=c),u(m[n[h]],h+1))}n&&n.length&&(n.length===1?y[n[0]]=c:n.length>1&&u(y,0)),app.flags=app.flags||{},app.flags._unsaved=!0}function e(){const t=$("#tag-whitelist");t.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),ajaxify.data.category.tagWhitelist.forEach(function(c){t.tagsinput("add",c)}),t.on("itemAdded itemRemoved",function(){l(t)})}return s}.apply(b,C),p!==void 0&&(k.exports=p)},74344:(k,b,g)=>{g.r(b),g.d(b,{del:()=>l,get:()=>i,head:()=>r,patch:()=>s,post:()=>d,put:()=>y});var C=g(85233),p=g.n(C),E=g(63281),w=g.n(E);const v=config.relative_path+"/api/v3";function f(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:v+e.url,typeof t=="function"){o(e,t);return}return new Promise((c,a)=>{o(e,function(n,u){if(n)return n.message==="A valid login session was not found. Please log in and try again."?(0,E.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go("login")}):a(n);c(u)})})}async function o(e,t){const{url:c}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,C.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const a=await fetch(c,e),{headers:n}=a,u=n.get("content-type"),m=u&&u.startsWith("application/json");let h;if(m?h=await a.json():h=await a.text(),!a.ok)return t(new Error(m?h.status.message:h));t(null,m&&h.hasOwnProperty("status")&&h.hasOwnProperty("response")?h.response:h)}function i(e,t,c){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},c)}function r(e,t,c){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},c)}function d(e,t,c){return f({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},c)}function s(e,t,c){return f({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},c)}function y(e,t,c){return f({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},c)}function l(e,t,c){return f({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},c)}},22905:(k,b,g)=>{var C,p;C=[g(7927),g(73138)],p=function(E,w){const v={};return v.init=function(f,o){let i=null;o=o||{},o.privilege=o.privilege||"topics:read",o.states=o.states||["watching","notwatching","ignoring"],o.cacheList=o.hasOwnProperty("cacheList")?o.cacheList:!0;let r=[];Array.isArray(o.localCategories)&&(r=o.localCategories.map(e=>({...e}))),o.selectedCids=o.selectedCids||ajaxify.data.selectedCids||[];const d=f.find('[component="category-selector-search"]');if(!d.length)return;const s=d.parent('[component="category/dropdown"]').length>0||d.parent('[component="category-selector"]').length>0;f.on("show.bs.dropdown",function(){s&&(f.find(".dropdown-toggle").css({visibility:"hidden"}),d.removeClass("hidden"),d.css({"z-index":f.find(".dropdown-toggle").css("z-index")+1}));function e(){const t=d.find("input").val();t.length>1||!t&&!i?y(t,function(c){i=o.cacheList&&(i||c),l(c)}):!t&&i&&l(i)}d.on("click",function(t){t.preventDefault(),t.stopPropagation()}),d.find("input").val("").on("keyup",utils.debounce(e,300)),e()}),f.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||d.find("input").focus()}),f.on("hide.bs.dropdown",function(){s&&(f.find(".dropdown-toggle").css({visibility:"inherit"}),d.addClass("hidden")),d.off("click"),d.find("input").off("keyup")});function y(e,t){socket.emit("categories.categorySearch",{search:e,query:utils.params(),parentCid:o.parentCid||0,selectedCids:o.selectedCids,privilege:o.privilege,states:o.states,showLinks:o.showLinks},function(c,a){if(c)return E.error(c);t(r.concat(a))})}function l(e){const t=o.selectedCids.map(String);e.forEach(function(c){c.selected=t.includes(String(c.cid))}),app.parseAndTranslate(o.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(c){f.find('[component="category/list"]').html(c.find('[component="category/list"]').html()),f.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length);const a=w.Dropdown.getInstance(f.find(".dropdown-toggle").get(0));a&&a.update()})}},v}.apply(b,C),p!==void 0&&(k.exports=p)},50548:(k,b,g)=>{var C,p;C=[g(22905),g(63281),g(85233),g(32230)],p=function(E,w,v,f){const o={};return o.init=function(i,r){if(!i||!i.length)return;r=r||{};const d=r.onSelect||function(){};r.states=r.states||["watching","notwatching","ignoring"],r.template=r.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:i,options:r}),E.init(i,r);const s={el:i,selectedCategory:null};i.on("click","[data-cid]",function(){const l=$(this);return l.hasClass("disabled")?!1:(s.selectCategory(l.attr("data-cid")),d(s.selectedCategory))});let y=s.el.find('[component="category-selector-selected"]').html();return f.translate(y,l=>{y=l}),s.selectCategory=function(l){const e=s.el.find('[data-cid="'+l+'"]');s.selectedCategory={cid:l,name:e.attr("data-name")},e.length?s.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):s.el.find('[component="category-selector-selected"]').html(y)},s.getSelectedCategory=function(){return s.selectedCategory},s.getSelectedCid=function(){return s.selectedCategory?s.selectedCategory.cid:0},r.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(r.template,{selectedCategory:r.selectedCategory},function(l){s.el.find('[component="category-selector-selected"]').html(l.find('[component="category-selector-selected"]').html())}),s},o.modal=function(i){i=i||{},i.onSelect=i.onSelect||function(){},i.onSubmit=i.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:i.message},function(r){const d=w.dialog({title:i.title||"[[modules:composer.select_category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:y}}}),s=o.init(d.find('[component="category-selector"]'),i);function y(l){return l.preventDefault(),s.selectedCategory&&(i.onSubmit(s.selectedCategory),d.modal("hide")),!1}i.openOnLoad&&d.on("shown.bs.modal",function(){d.find(".dropdown-toggle").dropdown("toggle")}),d.find("form").on("submit",y)})},o}.apply(b,C),p!==void 0&&(k.exports=p)}}]);
