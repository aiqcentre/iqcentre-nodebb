"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[13130,70565,83014,66623,49286,99617,10999,74344],{31433:(E,C,d)=>{var g,h;g=[d(50548),d(22568),d(74344),d(63281),d(7927)],h=function(m,p,y,i,a){const c={};c.init=function(){l(),r(),$(".groups-list").on("click","[data-action]",function(){const n=$(this),u=n.attr("data-action"),s=n.parents("tr[data-groupname]").attr("data-groupname");switch(u){case"delete":i.confirm("[[admin/manage/groups:alerts.confirm-delete]]",function(e){e&&y.del(`/groups/${p(s)}`,{}).then(ajaxify.refresh).catch(a.error)});break}})};function l(){$("#create").on("click",function(){app.parseAndTranslate("admin/partials/create_group_modal",{}).then(n=>{n.modal("show"),n.on("shown.bs.modal",function(){const u=$("#create-modal"),s=$("#create-group-name"),e=$("#create-modal-go"),t=$("#create-modal-error");s.trigger("focus"),u.on("keypress",function(o){o.key==="Enter"&&e.trigger("click")}),n.on("hidden.bs.modal",function(){n.modal("hide"),u.remove()}),e.on("click",function(){const o={name:s.val(),description:$("#create-group-desc").val(),private:$("#create-group-private").is(":checked")?1:0,hidden:$("#create-group-hidden").is(":checked")?1:0};y.post("/groups",o).then(f=>{t.addClass("hide"),s.val(""),u.on("hidden.bs.modal",function(){ajaxify.go("admin/manage/groups/"+f.name)}),u.modal("hide")}).catch(f=>{utils.hasLanguageKey(f.status.message)||(f.status.message="[[admin/manage/groups:alerts.create-failure]]"),t.translateHtml(f.status.message).removeClass("hide")})})})})})}function r(){const n=$("#group-search");function u(){if(!n.val())return ajaxify.refresh();$(".pagination").addClass("hide");const s=$(".groups-list");socket.emit("groups.search",{query:n.val(),options:{sort:"date"}},function(e,t){if(e)return a.error(e);app.parseAndTranslate("admin/manage/groups","groups",{groups:t,categories:ajaxify.data.categories},function(o){s.find("[data-groupname]").remove(),s.find("tbody").append(o)})})}n.on("keyup",utils.debounce(u,200))}return c}.apply(C,g),h!==void 0&&(E.exports=h)},74344:(E,C,d)=>{d.r(C),d.d(C,{del:()=>s,get:()=>c,head:()=>l,patch:()=>n,post:()=>r,put:()=>u});var g=d(85233),h=d.n(g),m=d(63281),p=d.n(m);const y=config.relative_path+"/api/v3";function i(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:y+e.url,typeof t=="function"){a(e,t);return}return new Promise((o,f)=>{a(e,function(_,D){if(_)return _.message==="A valid login session was not found. Please log in and try again."?(0,m.confirm)("[[error:api.reauth-required]]",v=>{v&&ajaxify.go("login")}):f(_);o(D)})})}async function a(e,t){const{url:o}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,g.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const f=await fetch(o,e),{headers:_}=f,D=_.get("content-type"),v=D&&D.startsWith("application/json");let A;if(v?A=await f.json():A=await f.text(),!f.ok)return t(new Error(v?A.status.message:A));t(null,v&&A.hasOwnProperty("status")&&A.hasOwnProperty("response")?A.response:A)}function c(e,t,o){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},o)}function l(e,t,o){return i({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},o)}function r(e,t,o){return i({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},o)}function n(e,t,o){return i({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},o)}function u(e,t,o){return i({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},o)}function s(e,t,o){return i({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},o)}},22905:(E,C,d)=>{var g,h;g=[d(7927),d(73138)],h=function(m,p){const y={};return y.init=function(i,a){let c=null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let l=[];Array.isArray(a.localCategories)&&(l=a.localCategories.map(e=>({...e}))),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const r=i.find('[component="category-selector-search"]');if(!r.length)return;const n=r.parent('[component="category/dropdown"]').length>0||r.parent('[component="category-selector"]').length>0;i.on("show.bs.dropdown",function(){n&&(i.find(".dropdown-toggle").css({visibility:"hidden"}),r.removeClass("hidden"),r.css({"z-index":i.find(".dropdown-toggle").css("z-index")+1}));function e(){const t=r.find("input").val();t.length>1||!t&&!c?u(t,function(o){c=a.cacheList&&(c||o),s(o)}):!t&&c&&s(c)}r.on("click",function(t){t.preventDefault(),t.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(e,300)),e()}),i.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||r.find("input").focus()}),i.on("hide.bs.dropdown",function(){n&&(i.find(".dropdown-toggle").css({visibility:"inherit"}),r.addClass("hidden")),r.off("click"),r.find("input").off("keyup")});function u(e,t){socket.emit("categories.categorySearch",{search:e,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(o,f){if(o)return m.error(o);t(l.concat(f))})}function s(e){const t=a.selectedCids.map(String);e.forEach(function(o){o.selected=t.includes(String(o.cid))}),app.parseAndTranslate(a.template,{categoryItems:e.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(o){i.find('[component="category/list"]').html(o.find('[component="category/list"]').html()),i.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!e.length);const f=p.Dropdown.getInstance(i.find(".dropdown-toggle").get(0));f&&f.update()})}},y}.apply(C,g),h!==void 0&&(E.exports=h)},50548:(E,C,d)=>{var g,h;g=[d(22905),d(63281),d(85233),d(32230)],h=function(m,p,y,i){const a={};return a.init=function(c,l){if(!c||!c.length)return;l=l||{};const r=l.onSelect||function(){};l.states=l.states||["watching","notwatching","ignoring"],l.template=l.template||"partials/category/selector-dropdown-left",y.fire("action:category.selector.options",{el:c,options:l}),m.init(c,l);const n={el:c,selectedCategory:null};c.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(n.selectCategory(s.attr("data-cid")),r(n.selectedCategory))});let u=n.el.find('[component="category-selector-selected"]').html();return i.translate(u,s=>{u=s}),n.selectCategory=function(s){const e=n.el.find('[data-cid="'+s+'"]');n.selectedCategory={cid:s,name:e.attr("data-name")},e.length?n.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(u)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},l.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(l.template,{selectedCategory:l.selectedCategory},function(s){n.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),n},a.modal=function(c){c=c||{},c.onSelect=c.onSelect||function(){},c.onSubmit=c.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:c.message},function(l){const r=p.dialog({title:c.title||"[[modules:composer.select_category]]",message:l,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),n=a.init(r.find('[component="category-selector"]'),c);function u(s){return s.preventDefault(),n.selectedCategory&&(c.onSubmit(n.selectedCategory),r.modal("hide")),!1}c.openOnLoad&&r.on("shown.bs.modal",function(){r.find(".dropdown-toggle").dropdown("toggle")}),r.find("form").on("submit",u)})},a}.apply(C,g),h!==void 0&&(E.exports=h)},22568:(E,C,d)=>{var g,h,m;(function(p){h=[d(20648)],g=p,m=typeof g=="function"?g.apply(C,h):g,m!==void 0&&(E.exports=m)})(function(p){const y=p("[^\\p{L}\\s\\d\\-_]","g"),i=/[^\w\s\d\-_]/g,a=/^\s+|\s+$/g,c=/\s+/g,l=/-+/g,r=/-$/g,n=/^-/g,u=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(a,""),u.test(e)?e=e.replace(i,"-"):e=p.replace(e,y,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(c,"-"),e=e.replace(l,"-"),e=e.replace(r,""),e=e.replace(n,""),e):""}})}}]);
