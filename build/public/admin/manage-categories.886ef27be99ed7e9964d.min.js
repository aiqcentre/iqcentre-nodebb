"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[78996,70565,83014,66623,49286,99617,74344],{60286:(w,A,g)=>{var b,E;b=[g(32230),g(59006),g(50548),g(74344),g(51474),g(63281),g(7927)],E=function(x,D,v,d,c,r,l){c=c.default;const i={};let s=-1,y;i.init=function(){v.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(t){ajaxify.go("/admin/manage/categories"+(t.cid?"?cid="+t.cid:""))},cacheList:!1,localCategories:[],template:"admin/partials/category/selector-dropdown-right"}),i.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",i.throwCreateModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const t=$(this),o=t.attr("data-disable-cid"),f=t.parents('li[data-cid="'+o+'"]'),h=f.hasClass("disabled"),m=f.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();i.toggle([o].concat(m),!h)}),$(".categories").on("click",".toggle",function(){const t=$(this);t.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),t.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const t=$(this).attr("data-cid"),o=$(this).attr("data-order"),f=r.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+o+' /><p class="form-text">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const h=f.find("input").val();if(h&&t){const u={};u[t]={order:Math.max(1,parseInt(h,10))},d.put("/categories/"+t,u[t]).then(function(){ajaxify.refresh()}).catch(l.error)}else return!1}}}})}),$("#toggle-collapse-all").on("click",function(){const t=$(this),o=parseInt(t.attr("data-collapsed"),10)===1;e(o),t.attr("data-collapsed",o?0:1).translateText(o?"[[admin/manage/categories:collapse-all]]":"[[admin/manage/categories:expand-all]]")});function e(t){const o=$(".categories .toggle");o.find("i").toggleClass("fa-chevron-down",t).toggleClass("fa-chevron-right",!t),o.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!t)}},i.throwCreateModal=function(){D.render("admin/partials/categories/create",{}).then(function(e){const t=r.dialog({title:"[[admin/manage/categories:alert.create]]",message:e,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:u}}}),o={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}],template:"admin/partials/category/selector-dropdown-left"},f=v.init(t.find('#parentCidGroup [component="category-selector"]'),o),h=v.init(t.find('#cloneFromCidGroup [component="category-selector"]'),o);function u(){const m=t.find("form").serializeObject();return m.description="",m.icon="fa-comments",m.uid=app.user.uid,m.parentCid=f.getSelectedCid(),m.cloneFromCid=h.getSelectedCid(),i.create(m),t.modal("hide"),!1}$("#cloneChildren").on("change",function(){const m=$(this),C=t.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');m.prop("checked")?(C.attr("disabled","disabled"),f.selectCategory(0)):C.removeAttr("disabled")}),t.find("form").on("submit",u)})},i.create=function(e){d.post("/categories",e,function(t,o){if(t)return l.error(t);l.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+o.cid)})},i.render=function(e){const t=$(".categories");!e||!e.length?x.translate("[[admin/manage/categories:alert.none-active]]",function(o){$("<div></div>").addClass("alert alert-info text-center").text(o).appendTo(t)}):(y={},n(e,t,{cid:0}))},i.toggle=function(e,t){const o=document.querySelector('.categories [data-cid="0"]');Promise.all(e.map(f=>d.put("/categories/"+f,{disabled:t?1:0}).then(()=>{const h=o.querySelector(`li[data-cid="${f}"]`);h.classList[t?"add":"remove"]("disabled"),$(h).find('li a[data-action="toggle"]').first().translateText(t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(l.error)))};function p(e){s=e.to.dataset.cid}function a(e){const t=parseInt(s,10)!==-1;if(e.newIndex!=null&&parseInt(e.oldIndex,10)!==parseInt(e.newIndex,10)||t){const o=e.item.dataset.cid,f={},h=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(f[o]={order:h+e.newIndex+1},t){f[o].parentCid=s;const u=parseInt(e.from.getAttribute("data-cid"),10),m=parseInt(e.to.getAttribute("data-cid"),10);if(u!==m){const C=document.querySelector(`.categories li[data-cid="${m}"] .toggle`);if(C&&C.classList.toggle("invisible",!1),!document.querySelectorAll(`.categories li[data-cid="${u}"] ul[data-cid] li[data-cid]`).length){const S=document.querySelector(`.categories li[data-cid="${u}"] .toggle`);S&&S.classList.toggle("invisible",!0)}e.item.dataset.parentCid=m}}s=-1,d.put("/categories/"+o,f[o]).catch(l.error)}}function n(e,t,o){let f=0;const h=o.cid;e.forEach(function(m,C,I){x.translate(m.name,function(S){m.name!==S&&(m.name=S),f+=1,f===I.length&&u()})}),e.length||u();function u(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:o.cid,categories:e,parentCategory:o},function(m){t.find(".category-row").length?t.find(".category-row").after(m):t.append(m),e.length||t.get(0).querySelector(".toggle").classList.toggle("invisible",!0);for(let C=0,I=e.length;C<I;C+=1)n(e[C].children,$('li[data-cid="'+e[C].cid+'"]'),e[C]);y[h]=c.create($('ul[data-cid="'+h+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:p,onEnd:a})})}}return i}.apply(A,b),E!==void 0&&(w.exports=E)},74344:(w,A,g)=>{g.r(A),g.d(A,{del:()=>p,get:()=>r,head:()=>l,patch:()=>s,post:()=>i,put:()=>y});var b=g(85233),E=g.n(b),x=g(63281),D=g.n(x);const v=config.relative_path+"/api/v3";function d(a,n){if(a.url=a.url.startsWith("/api")?config.relative_path+a.url:v+a.url,typeof n=="function"){c(a,n);return}return new Promise((e,t)=>{c(a,function(o,f){if(o)return o.message==="A valid login session was not found. Please log in and try again."?(0,x.confirm)("[[error:api.reauth-required]]",h=>{h&&ajaxify.go("login")}):t(o);e(f)})})}async function c(a,n){const{url:e}=a;delete a.url,a.data&&!(a.data instanceof FormData)&&(a.data=JSON.stringify(a.data||{}),a.headers["content-type"]="application/json; charset=utf-8"),{options:a}=await(0,b.fire)("filter:api.options",{options:a}),a.data&&(a.body=a.data,delete a.data);const t=await fetch(e,a),{headers:o}=t,f=o.get("content-type"),h=f&&f.startsWith("application/json");let u;if(h?u=await t.json():u=await t.text(),!t.ok)return n(new Error(h?u.status.message:u));n(null,h&&u.hasOwnProperty("status")&&u.hasOwnProperty("response")?u.response:u)}function r(a,n,e){return d({url:a+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function l(a,n,e){return d({url:a+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},e)}function i(a,n,e){return d({url:a,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function s(a,n,e){return d({url:a,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function y(a,n,e){return d({url:a,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function p(a,n,e){return d({url:a,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},22905:(w,A,g)=>{var b,E;b=[g(7927),g(73138)],E=function(x,D){const v={};return v.init=function(d,c){let r=null;c=c||{},c.privilege=c.privilege||"topics:read",c.states=c.states||["watching","notwatching","ignoring"],c.cacheList=c.hasOwnProperty("cacheList")?c.cacheList:!0;let l=[];Array.isArray(c.localCategories)&&(l=c.localCategories.map(a=>({...a}))),c.selectedCids=c.selectedCids||ajaxify.data.selectedCids||[];const i=d.find('[component="category-selector-search"]');if(!i.length)return;const s=i.parent('[component="category/dropdown"]').length>0||i.parent('[component="category-selector"]').length>0;d.on("show.bs.dropdown",function(){s&&(d.find(".dropdown-toggle").css({visibility:"hidden"}),i.removeClass("hidden"),i.css({"z-index":d.find(".dropdown-toggle").css("z-index")+1}));function a(){const n=i.find("input").val();n.length>1||!n&&!r?y(n,function(e){r=c.cacheList&&(r||e),p(e)}):!n&&r&&p(r)}i.on("click",function(n){n.preventDefault(),n.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),d.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),d.on("hide.bs.dropdown",function(){s&&(d.find(".dropdown-toggle").css({visibility:"inherit"}),i.addClass("hidden")),i.off("click"),i.find("input").off("keyup")});function y(a,n){socket.emit("categories.categorySearch",{search:a,query:utils.params(),parentCid:c.parentCid||0,selectedCids:c.selectedCids,privilege:c.privilege,states:c.states,showLinks:c.showLinks},function(e,t){if(e)return x.error(e);n(l.concat(t))})}function p(a){const n=c.selectedCids.map(String);a.forEach(function(e){e.selected=n.includes(String(e.cid))}),app.parseAndTranslate(c.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(e){d.find('[component="category/list"]').html(e.find('[component="category/list"]').html()),d.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const t=D.Dropdown.getInstance(d.find(".dropdown-toggle").get(0));t&&t.update()})}},v}.apply(A,b),E!==void 0&&(w.exports=E)},50548:(w,A,g)=>{var b,E;b=[g(22905),g(63281),g(85233),g(32230)],E=function(x,D,v,d){const c={};return c.init=function(r,l){if(!r||!r.length)return;l=l||{};const i=l.onSelect||function(){};l.states=l.states||["watching","notwatching","ignoring"],l.template=l.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:r,options:l}),x.init(r,l);const s={el:r,selectedCategory:null};r.on("click","[data-cid]",function(){const p=$(this);return p.hasClass("disabled")?!1:(s.selectCategory(p.attr("data-cid")),i(s.selectedCategory))});let y=s.el.find('[component="category-selector-selected"]').html();return d.translate(y,p=>{y=p}),s.selectCategory=function(p){const a=s.el.find('[data-cid="'+p+'"]');s.selectedCategory={cid:p,name:a.attr("data-name")},a.length?s.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):s.el.find('[component="category-selector-selected"]').html(y)},s.getSelectedCategory=function(){return s.selectedCategory},s.getSelectedCid=function(){return s.selectedCategory?s.selectedCategory.cid:0},l.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(l.template,{selectedCategory:l.selectedCategory},function(p){s.el.find('[component="category-selector-selected"]').html(p.find('[component="category-selector-selected"]').html())}),s},c.modal=function(r){r=r||{},r.onSelect=r.onSelect||function(){},r.onSubmit=r.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:r.message},function(l){const i=D.dialog({title:r.title||"[[modules:composer.select_category]]",message:l,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:y}}}),s=c.init(i.find('[component="category-selector"]'),r);function y(p){return p.preventDefault(),s.selectedCategory&&(r.onSubmit(s.selectedCategory),i.modal("hide")),!1}r.openOnLoad&&i.on("shown.bs.modal",function(){i.find(".dropdown-toggle").dropdown("toggle")}),i.find("form").on("submit",y)})},c}.apply(A,b),E!==void 0&&(w.exports=E)}}]);
