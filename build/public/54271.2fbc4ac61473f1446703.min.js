(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[54271,48894,62735,54625,86193],{30524:(b,k,p)=>{"use strict";var C,y;C=[p(7237),p(42441),p(81018),p(98900),p(20363),p(46862),p(75208),p(14406),p(2585),p(85233),p(63281),p(7927),p(93216),p(74344),p(33371)],y=function(x,v,c,h,m,a,o,l,u,i,r,d,g,E,A){const n={initialised:!1,activeAutocomplete:{}};let D=!1,S=null;return $(window).on("action:ajaxify.start",function(){n.destroyAutoComplete(ajaxify.data.roomId),ajaxify.data.template.chats&&(ajaxify.data.roomId&&socket.emit("modules.chats.leave",ajaxify.data.roomId),ajaxify.data.publicRooms&&socket.emit("modules.chats.leavePublic",ajaxify.data.publicRooms.map(t=>t.roomId)))}),n.init=function(){$('.chats-full [data-bs-toggle="tooltip"]').tooltip(),socket.emit("modules.chats.enterPublic",ajaxify.data.publicRooms.map(s=>s.roomId));const t=utils.findBootstrapEnvironment();S=$('[component="chat/nav-wrapper"]'),n.initialised||(n.addSocketListeners(),n.addGlobalEventListeners()),c.init(),n.addEventListeners(),n.setActive(ajaxify.data.roomId),(t==="md"||t==="lg"||t==="xl"||t==="xxl")&&n.addHotkeys(),n.initialised=!0;const e=$('[component="chat/message/content"]');a.wrapImagesInLinks(e),a.scrollToBottomAfterImageLoad(e),h.init(),i.fire("action:chat.loaded",$(".chats-full"))},n.addEventListeners=function(){const{roomId:t}=ajaxify.data,e=$('[component="chat/main-wrapper"]'),s=$('[component="chat/message/content"]'),f=x.get("chat/controls");n.addSendHandlers(t,$(".chat-input"),$('.expanded-chat button[data-action="send"]')),n.addPopoutHandler(),n.addActionHandlers(x.get("chat/messages"),t),n.addManageHandler(t,f.find('[data-action="manage"]')),n.addRenameHandler(t,f.find('[data-action="rename"]')),n.addLeaveHandler(t,f.find('[data-action="leave"]')),n.addDeleteHandler(t,f.find('[data-action="delete"]')),n.addScrollHandler(t,ajaxify.data.uid,s),n.addScrollBottomHandler(s),n.addParentHandler(s),n.addCharactersLeftHandler(e),n.addTextareaResizeHandler(e),n.addIPHandler(e),n.createAutoComplete(t,$('[component="chat/input"]')),n.addUploadHandler({dragDropAreaEl:$(".chats-full"),pasteEl:$('[component="chat/input"]'),uploadFormEl:$('[component="chat/upload"]'),uploadBtnEl:$('[component="chat/upload/button"]'),inputEl:$('[component="chat/input"]')}),$('[data-action="close"]').on("click",function(){n.switchChat()}),o.init(t,e),n.addNotificationSettingHandler(t,e),l.init(t,e),n.addPublicRoomSortHandler(),n.addTooltipHandler()},n.addPublicRoomSortHandler=function(){app.user.isAdmin&&!utils.isMobile()&&app.loadJQueryUI(()=>{const t=$('[component="chat/public"]');t.sortable({handle:'[component="chat/public/room/sort/handle"]',items:'[component="chat/public/room"]',axis:"y",update:async function(){const e={roomIds:[],scores:[]};t.find("[data-roomid]").each((s,f)=>{e.roomIds.push($(f).attr("data-roomid")),e.scores.push(s)}),await socket.emit("modules.chats.sortPublicRooms",e)}})})},n.addTooltipHandler=function(){$("[data-manual-tooltip]").tooltip({trigger:"manual",animation:!1,placement:"bottom"}).on("mouseenter",function(t){const e=$(t.target);e.hasClass("dropdown-menu")||!!e.parents(".dropdown-menu").length||$(this).tooltip("show")}).on("click mouseleave",function(){$(this).tooltip("hide")})},n.addNotificationSettingHandler=function(t,e){const s=e.find('[component="chat/notification/setting"]');s.find("[data-value]").on("click",async function(){s.find("i.fa-check").addClass("hidden");const f=$(this);f.find("i.fa-check").removeClass("hidden"),s.find('[component="chat/notification/setting/icon"]').attr("class",`fa ${f.attr("data-icon")}`),await socket.emit("modules.chats.setNotificationSetting",{roomId:t,value:f.attr("data-value")})})},n.addParentHandler=function(t){t.on("click",'[component="chat/message/parent"]',function(){const e=$(this);e.find('[component="chat/message/parent/content"]').toggleClass("line-clamp-1"),e.find(".chat-timestamp").toggleClass("hidden"),e.toggleClass("flex-column").toggleClass("flex-row"),t.length&&a.isAtBottom(t)&&a.scrollToBottom(t)})},n.addUploadHandler=function(t){A.init({dragDropAreaEl:t.dragDropAreaEl,pasteEl:t.pasteEl,uploadFormEl:t.uploadFormEl,uploadBtnEl:t.uploadBtnEl,route:"/api/post/upload",callback:function(e){const s=t.inputEl;let f=s.val();e.forEach(w=>{f=f+(f.endsWith(`
`)?"":`
`)+(w.isImage?"!":"")+`[${w.filename}](${w.url})
`}),s.val(f).trigger("input")}})},n.addIPHandler=function(t){t.on("click",".chat-ip-button",async function(){const e=$(this);let s=e.attr("data-ip");if(s){navigator.clipboard.writeText(s),e.translateText("[[global:copied]]"),setTimeout(()=>e.text(s),2e3);return}const f=e.parents("[data-mid]").attr("data-mid");s=await socket.emit("modules.chats.getIP",f),e.text(s).attr("data-ip",s)})},n.addPopoutHandler=function(){$('[data-action="pop-out"]').on("click",function(){const t=x.get("chat/input").val(),e=ajaxify.data.roomId;app.previousUrl&&app.previousUrl.match(/chats/)?ajaxify.go("user/"+ajaxify.data.userslug+"/chats",function(){g.openChat(e,ajaxify.data.uid)},!0):(window.history.go(-1),g.openChat(e,ajaxify.data.uid)),$(window).one("action:chat.loaded",function(){x.get("chat/input").val(t)})})},n.addScrollHandler=function(t,e,s){let f=!1;s.off("scroll").on("scroll",utils.debounce(function(){if(a.toggleScrollUpAlert(s),f)return;const w=(s[0].scrollHeight-s.height())*.1;if(s.scrollTop()>=w)return;f=!0;const j=parseInt(s.children("[data-mid]").length,10);E.get(`/chats/${t}/messages`,{uid:e,start:j}).then(T=>{if(T=T.messages,!T){f=!1;return}if(T=T.filter(function(I){return!$('[component="chat/message"][data-mid="'+I.messageId+'"]').length}),!T.length){f=!1;return}a.parseMessage(T,function(I){const R=s.scrollTop(),H=s[0].scrollHeight;s.prepend(I),a.onMessagesAddedToDom(I),s.scrollTop(s[0].scrollHeight-H+R),f=!1})}).catch(d.error)},100))},n.addScrollBottomHandler=function(t){t.parent().find('[component="chat/messages/scroll-up-alert"]').off("click").on("click",function(){a.scrollToBottom(t)})},n.addCharactersLeftHandler=function(t){t.find('[component="chat/input"]').on("change keyup paste",function(){a.updateRemainingLength(t)})},n.addTextareaResizeHandler=function(t){const e=t.find('[component="chat/input"]');e.on("input",function(){const s=t.find('[component="chat/message/content"]'),f=a.isAtBottom(s);e.css({height:0}),e.css({height:a.calcAutoTextAreaHeight(e)+"px"}),f&&a.scrollToBottom(s)})},n.addActionHandlers=function(t,e){t.on("click","[data-mid] [data-action]",function(){const s=$(this).parents("[data-mid]"),f=s.attr("data-mid");switch(this.getAttribute("data-action")){case"reply":a.prepReplyTo(s,e);break;case"edit":a.prepEdit(s,f,e);break;case"delete":a.delete(f,e);break;case"restore":a.restore(f,e);break}})},n.addHotkeys=function(){v.bind("ctrl+up",function(){const e=$(".chats-list .active").prevAll("[data-roomid]").first();e.length&&e.attr("data-roomid")&&n.switchChat(e.attr("data-roomid"))}),v.bind("ctrl+down",function(){const e=$(".chats-list .active").nextAll("[data-roomid]").first();e.length&&e.attr("data-roomid")&&n.switchChat(e.attr("data-roomid"))}),v.bind("up",function(t){const e=x.get("chat/input");if(t.target===e.get(0)&&!e.val()){const s=x.get("chat/messages").find('.chat-message[data-self="1"]').last();if(!s.length)return;const f=s.attr("data-mid");a.prepEdit(e,f,ajaxify.data.roomId)}})},n.addManageHandler=function(t,e){m.init(t,e)},n.addLeaveHandler=function(t,e){e.on("click",function(){r.confirm({size:"small",title:"[[modules:chat.leave]]",message:'<p>[[modules:chat.leave-prompt]]</p><p class="form-text">[[modules:chat.leave-help]]</p>',callback:function(s){s&&E.del(`/chats/${t}/users/${app.user.uid}`,{}).then(()=>{const f=e.parents(".chat-modal");f.length?g.close(f):(n.destroyAutoComplete(t),ajaxify.go("chats"))}).catch(d.error)}})})},n.addDeleteHandler=function(t,e){e.on("click",function(){r.confirm({size:"small",title:"[[modules:chat.delete]]",message:"<p>[[modules:chat.delete-prompt]]</p>",callback:function(s){s&&E.del(`/admin/chats/${t}`,{}).then(()=>{const f=e.parents(".chat-modal");f.length?g.close(f):(n.destroyAutoComplete(t),ajaxify.go("chats"))}).catch(d.error)}})})},n.addRenameHandler=function(t,e){e.on("click",async function(){const{roomName:s}=await E.get(`/chats/${t}`),f=await app.parseAndTranslate("modals/rename-room",{name:s}),w=r.dialog({title:"[[modules:chat.rename-room]]",message:f,onEscape:!0,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:function(){return E.put(`/chats/${t}`,{name:w.find("#roomName").val()}).then(()=>{w.modal("hide")}).catch(d.error),!1}}}})})},n.addSendHandlers=function(t,e,s){utils.isMobile()||e.off("keypress").on("keypress",function(f){if(f.which===13&&!f.shiftKey)return a.sendMessage(t,e),!1}),s.off("click").on("click",function(){return a.sendMessage(t,e),e.focus(),!1})},n.createAutoComplete=function(t,e,s={}){if(!e.length)return;const f={element:e,strategies:[],options:{style:{"z-index":2e4,flex:0,top:"inherit"},placement:"top",className:`chat-autocomplete-dropdown-${t} dropdown-menu textcomplete-dropdown`,...s}};if($(window).trigger("chat:autocomplete:init",f),f.strategies.length){const w=u.setup(f);return t&&(n.activeAutocomplete[t]=w),w}},n.destroyAutoComplete=function(t){n.activeAutocomplete[t]&&(n.activeAutocomplete[t].destroy(),delete n.activeAutocomplete[t])},n.leave=function(t){const e=t.attr("data-roomid");E.del(`/chats/${e}/users/${app.user.uid}`,{}).then(()=>{parseInt(e,10)===parseInt(ajaxify.data.roomId,10)?ajaxify.go("user/"+ajaxify.data.userslug+"/chats"):t.remove(),n.destroyAutoComplete(e);const s=g.getModal(e);s.length&&g.close(s)}).catch(d.error)},n.switchChat=function(t){t||(t=""),n.destroyAutoComplete(ajaxify.data.roomId),socket.emit("modules.chats.leave",ajaxify.data.roomId);const e="user/"+ajaxify.data.userslug+"/chats/"+t+window.location.search;if(!self.fetch)return ajaxify.go(e);const s=new URL(document.location).searchParams;s.set("switch",1);const f=`${config.relative_path}/api/user/${ajaxify.data.userslug}/chats/${t}?${s.toString()}`;fetch(f,{credentials:"include"}).then(async function(w){if(!w.ok)return console.warn("[search] Received "+w.status);const j=await w.json(),T=await app.parseAndTranslate("partials/chats/message-window",j),I=x.get("chat/main-wrapper");I.html(T),S=$('[component="chat/nav-wrapper"]'),T.find(".timeago").timeago(),ajaxify.data={...ajaxify.data,...j,roomId:t},ajaxify.updateTitle(ajaxify.data.title),$("body").toggleClass("chat-loaded",!!t),I.find('[data-bs-toggle="tooltip"]').tooltip(),n.setActive(t),n.addEventListeners(),i.fire("action:chat.loaded",$(".chats-full")),a.scrollToBottomAfterImageLoad(I.find('[component="chat/message/content"]')),history.pushState&&history.pushState({url:e},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+e)}).catch(function(w){console.warn("[search] "+w.message)})},n.addGlobalEventListeners=function(){$(window).on("mousemove keypress click",function(){D&&ajaxify.data.roomId&&(E.del(`/chats/${ajaxify.data.roomId}/state`,{}),D=!1)})},n.addSocketListeners=function(){socket.on("event:chats.receive",function(t){g.isFromBlockedUser(t.fromUid)||parseInt(t.roomId,10)===parseInt(ajaxify.data.roomId,10)&&(t.self=parseInt(app.user.uid,10)===parseInt(t.fromUid,10)?1:0,D||(D=t.self===0),t.message.self=t.self,t.message.timestamp=Math.min(Date.now(),t.message.timestamp),t.message.timestampISO=utils.toISOString(t.message.timestamp),a.appendChatMessage($('[component="chat/message/content"]'),t.message))}),socket.on("event:chats.public.unread",function(t){g.isFromBlockedUser(t.fromUid)||g.isLookingAtRoom(t.roomId)||app.user.uid===parseInt(t.fromUid,10)||(n.markChatPageElUnread(t),n.increasePublicRoomUnreadCount(S.find("[data-roomid="+t.roomId+"]")))}),socket.on("event:user_status_change",function(t){app.updateUserStatus($('.chats-list [data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}),a.addSocketListeners(),socket.on("event:chats.roomRename",function(t){const e=x.get("chat/recent/room",t.roomId);if(e.length){const f=e.find('[component="chat/room/title"]');ajaxify.data.roomName=t.newName,f.translateText(t.newName?t.newName:ajaxify.data.usernames)}const s=$(`[component="chat/main-wrapper"][data-roomid="${t.roomId}"] [component="chat/header/title"]`);s.length&&s.html(t.newName?`<i class="fa ${ajaxify.data.icon} text-muted"></i> ${t.newName}`:ajaxify.data.chatWithMessage)}),socket.on("event:chats.mark",({roomId:t,state:e})=>{$(`[component="chat/recent"] [data-roomid="${t}"], [component="chat/list"] [data-roomid="${t}"], [component="chat/public"] [data-roomid="${t}"]`).each((f,w)=>{const j=$(w);g.markChatElUnread(j,e===1),e===0&&n.updatePublicRoomUnreadCount(j,0)})})},n.markChatPageElUnread=function(t){if(!ajaxify.data.template.chats)return;const e=S.find("[data-roomid="+t.roomId+"]");g.markChatElUnread(e,!0)},n.increasePublicRoomUnreadCount=function(t){const e=t.find('[component="chat/public/room/unread/count"]'),s=(parseInt(e.attr("data-count"),10)||0)+1;n.updatePublicRoomUnreadCount(t,s)},n.updatePublicRoomUnreadCount=function(t,e){const s=t.find('[component="chat/public/room/unread/count"]'),f=e>50?"50+":e;s.toggleClass("hidden",e<=0).text(f).attr("data-count",e)},n.setActive=function(t){if(S.find("[data-roomid]").removeClass("active"),t){socket.emit("modules.chats.enter",t);const e=S.find(`[data-roomid="${t}"]`);e.addClass("active"),e.hasClass("unread")&&(E.del(`/chats/${t}/state`,{}),e.removeClass("unread")),utils.isMobile()||$('.expanded-chat [component="chat/input"]').focus(),a.updateTextAreaHeight($(`[component="chat/messages"][data-roomid="${t}"]`))}S.attr("data-loaded",t?"1":"0")},n}.apply(k,C),y!==void 0&&(b.exports=y)},98900:(b,k,p)=>{"use strict";var C,y;C=[p(7237),p(74344),p(7927),p(85925)],y=function(x,v,c,h){const m={};m.init=function(){x.get("chat/create").on("click",a)};async function a(){let o=[];app.user.isAdmin&&(o=await socket.emit("groups.getChatGroups",{}));const l=await app.parseAndTranslate("modals/create-room",{user:app.user,groups:o}),u=bootbox.dialog({title:"[[modules:chat.create-room]]",message:l,onEscape:!0,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:function(){const r=u.find('[component="chat/room/name"]').val(),d=u.find('[component="chat/room/users"] [component="chat/user"]').find("[data-uid]").map((A,n)=>$(n).attr("data-uid")).get(),g=u.find('[component="chat/room/type"]').val(),E=u.find('[component="chat/room/groups"]').val();return g==="private"&&!d.length?(c.error("[[error:no-users-selected]]"),!1):g==="public"&&!E.length?(c.error("[[error:no-groups-selected]]"),!1):app.user.uid?(v.post("/chats",{roomName:r,uids:d,type:g,groups:E}).then(({roomId:A})=>{ajaxify.go("chats/"+A),u.modal("hide")}).catch(c.error),!1):(c.error("[[error:not-logged-in]]"),!1)}}}}),i=u.find('[component="chat/room/users"]');h.init({onSelect:async function(r){const d=await app.parseAndTranslate("modals/create-room","selectedUsers",{selectedUsers:[r]});i.append(d)}}),i.on("click",'[component="chat/room/users/remove"]',function(){$(this).parents("[data-uid]").remove()}),u.find('[component="chat/room/type"]').on("change",function(){const r=$(this).val();u.find('[component="chat/room/public/options"]').toggleClass("hidden",r==="private")})}return m}.apply(k,C),y!==void 0&&(b.exports=y)},20363:(b,k,p)=>{"use strict";var C,y;C=[p(74344),p(7927),p(32230),p(86193),p(75208)],y=function(x,v,c,h,m){const a={};a.init=function(i,r){let d;r.on("click",async function(){let g=[];app.user.isAdmin&&(g=await socket.emit("groups.getChatGroups",{}),Array.isArray(ajaxify.data.groups)&&g.forEach(t=>{t.selected=ajaxify.data.groups.includes(t.name)}));const E=await app.parseAndTranslate("modals/manage-room",{groups:g,user:app.user,room:ajaxify.data});d=bootbox.dialog({title:"[[modules:chat.manage-room]]",message:E,onEscape:!0}),d.attr("component","chat/manage-modal"),u(i,d),o(i,d),l(i,d);const A=d.find('[component="chat/manage/user/list"]'),n=d.find('[component="chat/manage/user/list/search"]');m.addSearchHandler(i,n,async t=>{n.val()?A.html(await app.parseAndTranslate("partials/chats/manage-room-users",t)):u(i,d)}),m.addInfiniteScrollHandler(i,A,async(t,e)=>{t.append(await app.parseAndTranslate("partials/chats/manage-room-users",e))});const D=d.find('[component="chat/manage/user/add/search"]'),S=d.find(".text-danger");h.user(D,function(t,e){S.text(""),x.post(`/chats/${i}/users`,{uids:[e.item.user.uid]}).then(s=>{u(i,d,s),D.val("")}).catch(s=>{c.translate(s.message,function(f){S.text(f)})})}),d.find('[component="chat/manage/save"]').on("click",()=>{const t=d.find('[component="chat/room/notification/setting"]');x.put(`/chats/${i}`,{groups:d.find('[component="chat/room/groups"]').val(),notificationSetting:t.val()}).then(e=>{ajaxify.data.groups=e.groups,ajaxify.data.notificationSetting=e.notificationSetting;const s=e.notificationOptions[0];$('[component="chat/notification/setting"] [data-icon]').first().attr("data-icon",s.icon),$('[component="chat/notification/setting/sub-label"]').translateText(s.subLabel),s.selected&&$('[component="chat/notification/setting/icon"]').attr("class",`fa ${s.icon}`),d.modal("hide")}).catch(v.error)})})};function o(i,r){r.on("click",'[data-action="kick"]',function(){const d=parseInt(this.getAttribute("data-uid"),10);x.del(`/chats/${i}/users/${d}`,{}).then(g=>{u(i,r,g)}).catch(v.error)})}function l(i,r){r.on("click",'[data-action="toggleOwner"]',async function(){const d=parseInt(this.getAttribute("data-uid"),10),g=$(this);await socket.emit("modules.chats.toggleOwner",{roomId:i,uid:d}),g.parents("[data-uid]").find('[component="chat/manage/user/owner/icon"]').toggleClass("hidden")})}async function u(i,r,d){const g=r.find('[component="chat/manage/user/list"]');if(!d)try{d=await x.get(`/chats/${i}/users`,{})}catch{g.find("li").text(await c.translate("[[error:invalid-data]]"))}g.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),g.html(await app.parseAndTranslate("partials/chats/manage-room-users",d)),g.find('[data-bs-toggle="tooltip"]').tooltip()}return a}.apply(k,C),y!==void 0&&(b.exports=y)},14406:(b,k,p)=>{"use strict";var C,y;C=[p(7237),p(7927),p(46862)],y=function(x,v,c){const h={};let m=0,a,o,l,u,i,r;h.init=function(n,D){m=n,o=D.find('[component="chat/message/search/results"]'),l=D.find('[component="chat/message/content"]'),u=D.find('[component="chat/room/search/clear"]'),r=D.find('[component="chat/room/search/container"]'),i=D.find('[component="chat/room/search/toggle"'),a=D.find('[component="chat/room/search"]'),a.on("keyup",utils.debounce(g,250)).on("focus",()=>{a.val()&&g()}),D.find('[component="chat/input"]').on("focus",()=>{o.addClass("hidden"),l.removeClass("hidden")}),u.on("click",d),i.on("click",()=>{r.removeClass("hidden"),i.addClass("hidden"),a.trigger("focus")}),a.on("blur",()=>{a.val()||d()})};function d(){a.val(""),E(),o.addClass("hidden"),u.addClass("hidden"),r.addClass("hidden"),l.removeClass("hidden"),i.removeClass("hidden")}async function g(){const n=a.val();!n||n.length<=2||(u.removeClass("hidden"),socket.emit("modules.chats.searchMessages",{content:n,roomId:m}).then(A).catch(v.error))}function E(){o.children("[data-mid]").remove()}async function A(n){if(E(),!n.length)return o.removeClass("hidden"),l.addClass("hidden"),o.find('[component="chat/message/search/no-results"]').removeClass("hidden");o.find('[component="chat/message/search/no-results"]').addClass("hidden");const D=await app.parseAndTranslate("partials/chats/messages",{messages:n,isAdminOrGlobalMod:app.user.isAdmin||app.user.isGlobalMod});o.append(D),c.onMessagesAddedToDom(o.find('[component="chat/message"]')),l.addClass("hidden"),o.removeClass("hidden")}return h}.apply(k,C),y!==void 0&&(b.exports=y)},75208:(b,k,p)=>{"use strict";var C,y;C=[p(74344)],y=function(x){const v={};let c=0;v.init=function(o,l){const u=l.find('[component="chat/user/list"]');u.length&&(l.find('[component="chat/user/list/btn"]').on("click",()=>{u.toggleClass("hidden"),u.hasClass("hidden")?m():h(o,u)}),$(window).off("action:ajaxify.start",m).one("action:ajaxify.start",m),v.addInfiniteScrollHandler(o,u,async(i,r)=>{i.append(await app.parseAndTranslate("partials/chats/user-list","users",r))}))};function h(o,l){c=setInterval(()=>{a(o,l)},5e3)}function m(){c&&(clearInterval(c),c=0)}async function a(o,l){if(ajaxify.data.template.chats&&app.isFocused&&l.scrollTop()===0&&!l.hasClass("hidden")){const u=await x.get(`/chats/${o}/users`,{start:0});l.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),l.html(await app.parseAndTranslate("partials/chats/user-list","users",u)),l.find('[data-bs-toggle="tooltip"]').tooltip()}}return v.addInfiniteScrollHandler=function(o,l,u){l.on("scroll",utils.debounce(async()=>{const i=(l[0].scrollHeight-l.height())*.85;if(l.scrollTop()>i){const r=l.find("[data-index]").last().attr("data-index"),d=await x.get(`/chats/${o}/users`,{start:parseInt(r,10)+1});d&&d.users.length&&u(l,d)}},200))},v.addSearchHandler=function(o,l,u){l.on("keyup",utils.debounce(async()=>{const i=l.val(),r=await socket.emit("modules.chats.searchMembers",{username:i,roomId:o});u(r)},200))},v}.apply(k,C),y!==void 0&&(b.exports=y)},85925:(b,k,p)=>{"use strict";var C,y;C=[p(7237),p(74344),p(7927)],y=function(x,v,c){const h={};let m=[];h.init=function(i){i=i||{},m.length=0,x.get("chat/search").on("keyup",utils.debounce(o,250));const r=$('[component="chat/search/list"]');r.on("click","[data-uid]",function(){i.onSelect&&i.onSelect(m.find(d=>parseInt(d.uid,10)===parseInt($(this).attr("data-uid"),10))),a(r)})};function a(i){x.get("chat/search").val(""),l(i),i.find('[component="chat/search/no-users"]').addClass("hidden"),i.find('[component="chat/search/start-typing"]').removeClass("hidden")}function o(){const i=$('[component="chat/search/list"]'),r=x.get("chat/search").val();if(!r)return a(i);i.find('[component="chat/search/start-typing"]').addClass("hidden"),v.get("/api/users",{query:r,searchBy:"username",paginate:!1}).then(u).catch(c.error)}function l(i){m.length=0,i.find("[data-uid]").remove()}async function u(i){const r=$('[component="chat/search/list"]');if(l(r),i.users=i.users.filter(function(g){return parseInt(g.uid,10)!==parseInt(app.user.uid,10)}),m=i.users,!i.users.length)return r.find('[component="chat/search/no-users"]').removeClass("hidden");r.find('[component="chat/search/no-users"]').addClass("hidden");const d=await app.parseAndTranslate("modals/create-room","searchUsers",{searchUsers:i.users});r.append(d),r.parent().toggleClass("show",!0)}return h}.apply(k,C),y!==void 0&&(b.exports=y)},86193:(b,k,p)=>{"use strict";var C,y;C=[p(74344),p(7927)],y=function(x,v){const c={},h={delay:200,appendTo:null};c.init=a=>{const o={...h,...a},{input:l,onSelect:u}=o;app.loadJQueryUI(function(){l.autocomplete({...o,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(i,r){m(l,u,i,r)}})})},c.user=function(a,o,l){typeof o=="function"&&(l=o,o={}),o=o||{},c.init({input:a,onSelect:l,source:(u,i)=>{o.query=u.term,x.get("/api/users",o,function(r,d){if(r)return v.error(r);if(d&&d.users){const g=d.users.map(function(E){const A=$("<div></div>").html(E.username).text();return E&&{label:A,value:A,user:{uid:E.uid,name:E.username,slug:E.userslug,username:E.username,userslug:E.userslug,picture:E.picture,banned:E.banned,"icon:text":E["icon:text"],"icon:bgColor":E["icon:bgColor"]}}});i(g)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},c.group=function(a,o){c.init({input:a,onSelect:o,source:(l,u)=>{socket.emit("groups.search",{query:l.term},function(i,r){if(i)return v.error(i);if(r&&r.length){const d=r.map(function(g){return g&&{label:g.name,value:g.name,group:g}});u(d)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},c.tag=function(a,o){c.init({input:a,onSelect:o,delay:100,source:(l,u)=>{socket.emit("topics.autocompleteTags",{query:l.term,cid:ajaxify.data.cid||0},function(i,r){if(i)return v.error(i);r&&u(r),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function m(a,o,l,u){o=o||function(){};const i=jQuery.Event("keypress");i.which=13,i.keyCode=13,setTimeout(function(){a.trigger(i)},100),o(l,u)}return c}.apply(k,C),y!==void 0&&(b.exports=y)},2585:(b,k,p)=>{b.exports=p(61006)},83713:(b,k,p)=>{b.exports=p(51077)},33371:(b,k,p)=>{"use strict";var C,y;C=[p(7927)],y=function(x){const v={};return v.init=function(c){const h=c.uploadFormEl;if(h.length&&(h.attr("action",config.relative_path+c.route),c.dragDropAreaEl&&v.handleDragDrop({container:c.dragDropAreaEl,callback:function(m){v.ajaxSubmit({uploadForm:h,upload:m,callback:c.callback})}}),c.pasteEl&&v.handlePaste({container:c.pasteEl,callback:function(m){v.ajaxSubmit({uploadForm:h,upload:m,callback:c.callback})}}),c.uploadBtnEl)){const m=h.find('input[name="files[]"]');c.uploadBtnEl.on("click",function(){m.trigger("click")}),m.on("change",function(a){const o=(a.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);o&&v.ajaxSubmit({uploadForm:h,upload:{files:o,fileNames:Array.from(o).map(l=>l.name)},callback:c.callback})})}},v.handleDragDrop=function(c){let h=!1;const m=c.container,a=c.container.find(".imagedrop");m.on("dragenter",function(){h||(a.css("top","0px"),a.css("height",m.height()+"px"),a.css("line-height",m.height()+"px"),a.show(),a.on("dragleave",function(){a.hide(),a.off("dragleave")}))}),a.on("drop",function(u){u.preventDefault();const i=u.originalEvent.dataTransfer.files;if(i.length){let d;if(window.FormData){d=new FormData;for(var r=0;r<i.length;++r)d.append("files[]",i[r],i[r].name)}c.callback({files:i,formData:d})}return a.hide(),!1});function o(l){return l.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){h=!0}).off("dragend").on("dragend, mouseup",function(){h=!1}),a.on("dragover",o),a.on("dragenter",o)},v.handlePaste=function(c){c.container.on("paste",function(m){const a=(m.clipboardData||m.originalEvent.clipboardData||{}).items,o=[],l=[];let u=null;window.FormData&&(u=new FormData),[].forEach.call(a,function(i){const r=i.getAsFile();if(r){const d=utils.generateUUID()+"-"+r.name;u&&u.append("files[]",r,d),o.push(r),l.push(d)}}),o.length&&c.callback({files:o,fileNames:l,formData:u})})},v.ajaxSubmit=function(c){const h=[...c.upload.files];for(let a=0;a<h.length;++a){const o=h[a].type.match(/image./);if(o&&!app.user.privileges["upload:post:image"]||!o&&!app.user.privileges["upload:post:file"])return x.error("[[error:no-privileges]]");if(!app.user.isAdmin&&h[a].size>parseInt(config.maximumFileSize,10)*1024)return c.uploadForm[0].reset(),x.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const m=Date.now();c.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:c.upload.formData,error:function(a){let o=a.responseJSON&&(a.responseJSON.error||a.responseJSON.status&&a.responseJSON.status.message)||"[[error:parse-error]]";a&&a.status===413&&(o=a.statusText||"Request Entity Too Large"),x.error(o),x.remove(m)},uploadProgress:function(a,o,l,u){x.alert({alert_id:m,message:"[[modules:composer.uploading, "+u+"%]]"})},success:function(a){const o=a.response.images;if(o&&o.length)for(var l=0;l<o.length;++l)o[l].filename=h[l].name,o[l].isImage=/image./.test(h[l].type);c.callback(o)},complete:function(){c.uploadForm[0].reset(),setTimeout(x.remove,100,m)}}),!1}),c.uploadForm.submit()},v}.apply(k,C),y!==void 0&&(b.exports=y)},51077:(b,k,p)=>{"use strict";var C,y;C=[p(85233)],y=function(x){var v={};return v.render=function(c,h){if(h=h||function(){},!c.find(".preview-container").is(":visible"))return h();var m=c.find("textarea");socket.emit("plugins.composer.renderPreview",m.val(),function(a,o){a||(o=$("<div>"+o+"</div>"),o.find("img:not(.not-responsive)").addClass("img-fluid"),c.find(".preview").html(o),x.fire("action:composer.preview",{postContainer:c,preview:o}),h())})},v.matchScroll=function(c){if(c.find(".preview-container").is(":visible")){var h=c.find("textarea"),m=c.find(".preview");if(h.length&&m.length){var a=h[0].scrollHeight-h.height();if(a===0)return;var o=h.scrollTop()/a;m.scrollTop(Math.max(m[0].scrollHeight-m.height(),0)*o)}}},v.handleToggler=function(c){const h=c.get(0);v.env=utils.findBootstrapEnvironment();const m=["xs","sm"].includes(v.env),a=h.querySelector('.formatting-bar [data-action="preview"]'),o=a.querySelector(".show-text"),l=a.querySelector(".hide-text"),u=localStorage.getItem("composer:previewToggled"),i=config["composer-default"].hidePreviewOnOpen==="on";let r=!m&&(u===null&&!i||u);const d=h.querySelector(".preview-container"),g=h.querySelector(".write-container");if(!a)return;function E(A){m?(d.classList.toggle("hide",!1),g.classList.toggle("maximized",!1),d.classList.toggle("d-none",!A),d.classList.toggle("d-flex",A),d.classList.toggle("w-100",A),g.classList.toggle("d-flex",!A),g.classList.toggle("d-none",A),g.classList.toggle("w-100",!A)):(d.classList.toggle("hide",!A),g.classList.toggle("w-50",A),g.classList.toggle("w-100",!A),localStorage.setItem("composer:previewToggled",A)),o.classList.toggle("hide",A),l.classList.toggle("hide",!A),A&&v.render(c),v.matchScroll(c)}v.toggle=E,a.addEventListener("click",A=>{A.button===0&&(r=!r,E(r))}),E(r)},v}.apply(k,C),y!==void 0&&(b.exports=y)}}]);
